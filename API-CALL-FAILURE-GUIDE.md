# æ•°æ®åº“APIè°ƒç”¨å¤±è´¥ - å®Œæ•´è§£å†³æŒ‡å—

**é—®é¢˜**: æ•°æ®åº“APIè°ƒç”¨å¤±è´¥  
**æ—¥æœŸ**: 2025-10-13  
**çŠ¶æ€**: æä¾›å®Œæ•´è¯Šæ–­å’Œè§£å†³æ–¹æ¡ˆ

---

## ğŸ“‹ è¯Šæ–­ç»“æœ

### âœ… åç«¯çŠ¶æ€ - æ­£å¸¸

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| åç«¯æœåŠ¡ | âœ… è¿è¡Œä¸­ | è¿›ç¨‹ID: 32213 |
| ç«¯å£ç›‘å¬ | âœ… æ­£å¸¸ | ç«¯å£3000å·²ç›‘å¬ |
| APIå“åº” | âœ… æ­£å¸¸ | HTTP 200 OK |
| CORSé…ç½® | âœ… æ­£ç¡® | å…è®¸æ‰€æœ‰æ¥æº |
| æ•°æ®è¿”å› | âœ… æ­£å¸¸ | JSONæ ¼å¼æ­£ç¡® |

### APIæµ‹è¯•ç»“æœ

```bash
# æœ¬åœ°localhostæµ‹è¯•
GET http://localhost:3000/api/data-library
âœ… çŠ¶æ€: 200 OK
âœ… è¿”å›: {"success": true, "data": [...]}

# å¤–ç½‘IPæµ‹è¯•
GET http://103.246.246.11:3000/api/data-library
âœ… çŠ¶æ€: 200 OK
âœ… CORS: Access-Control-Allow-Origin: *
```

---

## ğŸ¯ å¯èƒ½çš„é—®é¢˜åŸå› 

æ ¹æ®è¯Šæ–­ï¼Œåç«¯å®Œå…¨æ­£å¸¸ã€‚é—®é¢˜å¯èƒ½å‡ºåœ¨ä»¥ä¸‹å‡ ä¸ªåœ°æ–¹ï¼š

### 1. æµè§ˆå™¨ç¼“å­˜ï¼ˆæœ€å¸¸è§ï¼‰â­â­â­â­â­

**ç°è±¡**ï¼š
- åç«¯APIæ­£å¸¸
- æµè§ˆå™¨ä»æ˜¾ç¤ºæ—§ç‰ˆæœ¬ä»£ç 
- æ§åˆ¶å°æŠ¥é”™"APIè°ƒç”¨å¤±è´¥"

**åŸå› **ï¼š
æµè§ˆå™¨ç¼“å­˜äº†æ—§ç‰ˆæœ¬çš„JavaScriptä»£ç ï¼Œä½¿ç”¨äº†é”™è¯¯çš„APIè°ƒç”¨æ–¹å¼ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
æ–¹æ³•1: å¼ºåˆ¶åˆ·æ–°
æŒ‰ Ctrl+F5 (Windows/Linux)
æŒ‰ Cmd+Shift+R (Mac)

æ–¹æ³•2: æ¸…é™¤ç¼“å­˜
F12 â†’ Application â†’ Clear storage â†’ Clear site data

æ–¹æ³•3: ç¡¬æ€§é‡æ–°åŠ è½½
F12 â†’ å³é”®åˆ·æ–°æŒ‰é’® â†’ "æ¸…ç©ºç¼“å­˜å¹¶ç¡¬æ€§é‡æ–°åŠ è½½"
```

---

### 2. Tokenè¿‡æœŸæˆ–ç¼ºå¤± â­â­â­â­

**ç°è±¡**ï¼š
- æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º"401 Unauthorized"
- æˆ–"TokenéªŒè¯å¤±è´¥"

**åŸå› **ï¼š
éƒ¨åˆ†APIéœ€è¦Tokenè®¤è¯ï¼Œç™»å½•Tokenå·²è¿‡æœŸã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
1. é‡æ–°ç™»å½•ç³»ç»Ÿ
2. æ£€æŸ¥localStorageä¸­çš„token
   F12 â†’ Application â†’ Local Storage â†’ æŸ¥çœ‹ 'Admin-Token'
3. å¦‚æœTokenä¸ºnullæˆ–è¿‡æœŸï¼Œæ¸…é™¤localStorageå¹¶é‡æ–°ç™»å½•
   localStorage.clear()
```

---

### 3. ç½‘ç»œè¿æ¥é—®é¢˜ â­â­â­

**ç°è±¡**ï¼š
- æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º"Network Error"
- æˆ–"Failed to fetch"
- æˆ–"ERR_CONNECTION_REFUSED"

**åŸå› **ï¼š
- å‰ç«¯é…ç½®çš„APIåœ°å€æ— æ³•è®¿é—®
- é˜²ç«å¢™é˜»æ­¢äº†è¯·æ±‚
- ç½‘ç»œä¸ç¨³å®š

**å½“å‰é…ç½®**ï¼š
```
VUE_APP_API_URL = 'http://103.246.246.11:3000'
```

**æ£€æŸ¥æ–¹æ³•**ï¼š
```bash
# åœ¨æ‚¨çš„ç”µè„‘ä¸Šæµ‹è¯•
ping 103.246.246.11
curl http://103.246.246.11:3000/health

# å¦‚æœæ— æ³•è®¿é—®ï¼Œæ”¹ç”¨localhost
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

**é€‰é¡¹1**: å¦‚æœæ‚¨åœ¨æœåŠ¡å™¨æœ¬åœ°æµè§ˆå™¨è®¿é—®
```env
# ä¿®æ”¹ .env.development
VUE_APP_API_URL = 'http://localhost:3000'
VUE_APP_BASE_API = 'http://localhost:3000'
```

**é€‰é¡¹2**: å¦‚æœæ‚¨ä»å…¶ä»–ç”µè„‘è®¿é—®
- ç¡®ä¿æœåŠ¡å™¨é˜²ç«å¢™å¼€æ”¾3000ç«¯å£
- ç¡®ä¿æ‚¨çš„ç½‘ç»œå¯ä»¥è®¿é—®103.246.246.11

---

### 4. APIè·¯å¾„é”™è¯¯ â­â­

**ç°è±¡**ï¼š
- æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º"404 Not Found"
- æ§åˆ¶å°æ—¥å¿—æ˜¾ç¤ºé”™è¯¯çš„URL

**å¯èƒ½åŸå› **ï¼š
- ä»£ç ä¸­ä½¿ç”¨äº†é”™è¯¯çš„APIè·¯å¾„
- process.env.VUE_APP_API_URLæœªæ­£ç¡®è®¾ç½®

**æ£€æŸ¥æ–¹æ³•**ï¼š
```javascript
// æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œè¾“å…¥ï¼š
console.log(process.env.VUE_APP_API_URL)
// åº”è¯¥æ˜¾ç¤º: 'http://103.246.246.11:3000'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
ç¡®ä¿æ‰€æœ‰APIè°ƒç”¨éƒ½ä½¿ç”¨æ­£ç¡®çš„å®Œæ•´URLï¼š
```javascript
// æ­£ç¡®å†™æ³•
url: `${process.env.VUE_APP_API_URL || ''}/api/data-library/published`

// æˆ–
url: '/api/data-library/published'  // è‡ªåŠ¨ä½¿ç”¨é…ç½®çš„baseURL
```

---

### 5. è¯·æ±‚æ–¹æ³•é”™è¯¯ â­

**ç°è±¡**ï¼š
- æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º"405 Method Not Allowed"
- æˆ–"400 Bad Request"

**å¯èƒ½åŸå› **ï¼š
- ä½¿ç”¨POSTè¯·æ±‚è®¿é—®GETæ¥å£
- ç¼ºå°‘å¿…è¦çš„è¯·æ±‚å‚æ•°

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ£€æŸ¥APIè°ƒç”¨ä»£ç ï¼š
```javascript
// æ­£ç¡®çš„è°ƒç”¨æ–¹å¼
this.$http({
  method: 'GET',  // â† ç¡®ä¿æ–¹æ³•æ­£ç¡®
  url: '/api/data-library/published',
  params: {  // â† GETä½¿ç”¨params
    page: 1,
    limit: 20
  }
})
```

---

## ğŸ” è¯¦ç»†è¯Šæ–­æ­¥éª¤

### æ­¥éª¤1ï¼šæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰

#### Consoleæ ‡ç­¾
æŸ¥æ‰¾ä»¥ä¸‹æ—¥å¿—ï¼š

**æ­£å¸¸æ—¥å¿—**ï¼š
```javascript
ğŸ”„ èµ„æºä¸­å¿ƒå¼€å§‹åŠ è½½æ•°æ®...
ğŸ’¾ ä»æ•°æ®åº“APIè·å–å·²å‘å¸ƒæ•°æ®...
âœ… æ•°æ®åº“APIè¿”å›æ•°æ®: 3 æ¡
âœ… æ•°æ®åŠ è½½å®Œæˆï¼Œæœ€ç»ˆæ˜¾ç¤º: 3 æ¡
```

**é”™è¯¯æ—¥å¿—ç¤ºä¾‹**ï¼š
```javascript
âŒ æ•°æ®åº“APIè°ƒç”¨å¤±è´¥: Network Error
âŒ æ•°æ®åº“APIè°ƒç”¨å¤±è´¥: Request failed with status code 401
âŒ æ•°æ®åº“APIè°ƒç”¨å¤±è´¥: Cannot read property 'data' of undefined
```

#### Networkæ ‡ç­¾
1. åˆ·æ–°é¡µé¢
2. æŸ¥æ‰¾ `/api/data-library/published` è¯·æ±‚
3. æ£€æŸ¥ä»¥ä¸‹ä¿¡æ¯ï¼š

| æ£€æŸ¥é¡¹ | æ­£å¸¸å€¼ | å¼‚å¸¸å€¼ |
|--------|--------|--------|
| Status | 200 OK | 401, 403, 404, 500, æˆ– (failed) |
| Method | GET | å…¶ä»– |
| URL | å®Œæ•´çš„APIåœ°å€ | é”™è¯¯çš„åœ°å€ |
| Response | JSONæ•°æ® | é”™è¯¯ä¿¡æ¯æˆ–ç©º |

---

### æ­¥éª¤2ï¼šæµ‹è¯•APIè¿æ¥

#### åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®API

```
æ‰“å¼€æ–°æ ‡ç­¾é¡µï¼Œè®¿é—®ï¼š
http://103.246.246.11:3000/api/data-library/published?page=1&limit=1

åº”è¯¥çœ‹åˆ°JSONæ•°æ®è¿”å›
```

#### å¦‚æœæ— æ³•è®¿é—®
- âŒ ç½‘ç»œè¿æ¥é—®é¢˜
- âŒ é˜²ç«å¢™é˜»æ­¢
- âœ… æ”¹ç”¨localhostæµ‹è¯•

---

### æ­¥éª¤3ï¼šæ£€æŸ¥å‰ç«¯ä»£ç 

#### æ£€æŸ¥APIè°ƒç”¨ä»£ç 

**èµ„æºä¸­å¿ƒ** (`src/views/resource/center.vue`):
```javascript
// åº”è¯¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•
async getPublishedDataFromAPI() {
  const response = await this.$http({
    method: 'GET',
    url: `${process.env.VUE_APP_API_URL || ''}/api/data-library/published`,
    params: params,
    headers: {
      'X-Token': this.$store.getters.token
    }
  })
}
```

#### æ£€æŸ¥è¯·æ±‚é…ç½®

**request.js** (`src/utils/request.js`):
```javascript
// æ£€æŸ¥baseURLé…ç½®
const service = axios.create({
  baseURL: process.env.VUE_APP_BASE_API,
  timeout: 5000
})
```

---

## ğŸ”§ å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### é”™è¯¯1: Network Error

**å®Œæ•´é”™è¯¯**:
```
Error: Network Error
    at createError (createError.js:16)
    at XMLHttpRequest.handleError (xhr.js:87)
```

**åŸå› **ï¼š
- æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨
- CORSé—®é¢˜ï¼ˆå·²æ’é™¤ï¼‰
- ç½‘ç»œé—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
2. æµ‹è¯•APIæ˜¯å¦å¯è®¿é—®
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
4. å°è¯•ä½¿ç”¨localhostä»£æ›¿IPåœ°å€

---

### é”™è¯¯2: 401 Unauthorized

**å®Œæ•´é”™è¯¯**:
```
Request failed with status code 401
```

**åŸå› **ï¼š
TokenéªŒè¯å¤±è´¥æˆ–è¿‡æœŸ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// 1. æ¸…é™¤localStorage
localStorage.clear()

// 2. é‡æ–°ç™»å½•
// 3. æ£€æŸ¥tokenæ˜¯å¦æ­£ç¡®è®¾ç½®
console.log(this.$store.getters.token)
```

---

### é”™è¯¯3: 404 Not Found

**å®Œæ•´é”™è¯¯**:
```
Request failed with status code 404
{
  "success": false,
  "message": "æ¥å£ä¸å­˜åœ¨",
  "path": "/api/data-library/publishedd"  // æ³¨æ„æ‹¼å†™é”™è¯¯
}
```

**åŸå› **ï¼š
APIè·¯å¾„é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ£€æŸ¥ä»£ç ä¸­çš„APIè·¯å¾„æ‹¼å†™

---

### é”™è¯¯4: Cannot read property 'data' of undefined

**å®Œæ•´é”™è¯¯**:
```
TypeError: Cannot read property 'data' of undefined
    at response.data.data.map
```

**åŸå› **ï¼š
APIå“åº”æ ¼å¼ä¸ç¬¦åˆé¢„æœŸï¼Œæˆ–responseä¸ºundefined

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// æ·»åŠ é˜²å¾¡æ€§æ£€æŸ¥
if (response && response.data && response.data.success && response.data.data) {
  // å¤„ç†æ•°æ®
} else {
  console.error('APIè¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸:', response)
}
```

---

## ğŸ§ª æµ‹è¯•å’ŒéªŒè¯

### å¿«é€Ÿæµ‹è¯•è„šæœ¬

```bash
# è¿è¡Œè¯Šæ–­è„šæœ¬
cd /home/vue-element-admin
bash diagnose-api-issue.sh
```

### æ‰‹åŠ¨æµ‹è¯•

#### 1. æµ‹è¯•åç«¯API
```bash
# æµ‹è¯•åŸºç¡€API
curl http://localhost:3000/api/data-library?page=1&limit=1

# æµ‹è¯•å·²å‘å¸ƒAPI
curl http://localhost:3000/api/data-library/published

# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:3000/health
```

#### 2. æµ‹è¯•å‰ç«¯é¡µé¢
```
1. å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨: Ctrl+F5
2. æ‰“å¼€æ§åˆ¶å°: F12
3. è¿›å…¥èµ„æºä¸­å¿ƒ
4. æŸ¥çœ‹Consoleå’ŒNetworkæ ‡ç­¾
```

---

## ğŸ“ è§£å†³æ–¹æ¡ˆæ€»ç»“

### æœ€å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

#### 1. å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ â­â­â­â­â­
```
Ctrl+F5
```
**é€‚ç”¨äº**: 99%çš„æƒ…å†µ

#### 2. é‡æ–°ç™»å½• â­â­â­â­
```
æ¸…é™¤localStorage â†’ é‡æ–°ç™»å½•
```
**é€‚ç”¨äº**: Tokenè¿‡æœŸ

#### 3. ä¿®æ”¹APIåœ°å€ä¸ºlocalhost â­â­â­
```env
VUE_APP_API_URL = 'http://localhost:3000'
```
**é€‚ç”¨äº**: ç½‘ç»œè¿æ¥é—®é¢˜

#### 4. é‡å¯åç«¯æœåŠ¡ â­â­
```bash
cd /home/vue-element-admin/backend
pkill -f "node server.js"
node server.js &
```
**é€‚ç”¨äº**: åç«¯å¼‚å¸¸

---

## âœ… éªŒè¯æ¸…å•

å®Œæˆä»¥ä¸‹æ£€æŸ¥ï¼Œç¡®è®¤é—®é¢˜å·²è§£å†³ï¼š

- [ ] å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ï¼ˆCtrl+F5ï¼‰
- [ ] æ£€æŸ¥æ§åˆ¶å°æ²¡æœ‰é”™è¯¯æ—¥å¿—
- [ ] æ£€æŸ¥Networkæ ‡ç­¾APIè¯·æ±‚æˆåŠŸï¼ˆ200 OKï¼‰
- [ ] èµ„æºä¸­å¿ƒèƒ½æ­£å¸¸æ˜¾ç¤ºæ•°æ®
- [ ] æ•°æ®å®šä»·é¡µé¢èƒ½æ­£å¸¸æ˜¾ç¤ºæ•°æ®
- [ ] æ•°æ®åˆ—è¡¨é¡µé¢èƒ½æ­£å¸¸æ˜¾ç¤ºæ•°æ®

---

## ğŸ“ å¦‚éœ€è¿›ä¸€æ­¥å¸®åŠ©

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤ä»æ— æ³•è§£å†³ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **æµè§ˆå™¨æ§åˆ¶å°æˆªå›¾**ï¼ˆF12 â†’ Consoleæ ‡ç­¾ï¼‰
2. **Networkè¯·æ±‚è¯¦æƒ…**ï¼ˆF12 â†’ Network â†’ ç‚¹å‡»å¤±è´¥çš„è¯·æ±‚ï¼‰
3. **å…·ä½“é”™è¯¯ä¿¡æ¯**ï¼ˆå®Œæ•´çš„é”™è¯¯å †æ ˆï¼‰
4. **æ“ä½œæ­¥éª¤**ï¼ˆå¦‚ä½•å¤ç°é—®é¢˜ï¼‰
5. **æ˜¯å¦åˆ·æ–°äº†æµè§ˆå™¨**ï¼ˆCtrl+F5ï¼‰

---

**è¯Šæ–­å®Œæˆæ—¥æœŸ**: 2025-10-13  
**åç«¯çŠ¶æ€**: âœ… å®Œå…¨æ­£å¸¸  
**å»ºè®®æ“ä½œ**: å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ï¼ˆCtrl+F5ï¼‰

# æ•°æ®ä¸Šä¼ åŠŸèƒ½ä¿®å¤å®ŒæˆæŠ¥å‘Š

## ä¿®å¤æ—¥æœŸ
2025-10-13

## é—®é¢˜æè¿°
æ–°å¢æ•°æ®æ—¶æ— æ³•æ­£ç¡®ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨å¹¶ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚

##å·²å®Œæˆçš„ä¿®å¤

### 1. åç«¯è·¯ç”±ä¿®å¤ âœ…

#### `/home/vue-element-admin/backend/routes/data.js`
- **ä¿®å¤å†…å®¹**: æ·»åŠ æ–‡ä»¶ä¿¡æ¯å­—æ®µæ”¯æŒ
- **ä¿®æ”¹è¯¦æƒ…**:
  ```javascript
  // æ·»åŠ äº†æ–‡ä»¶ç›¸å…³å­—æ®µ
  file_name: fileName || null,
  file_path: filePath || null,
  file_size: fileSize || null,
  file_hash: fileHash || null
  ```

### 2. å‰ç«¯library.vueä¿®å¤ âœ…

#### `/home/vue-element-admin/src/views/data/library.vue`
- **ä¿®å¤å†…å®¹**: 
  1. å¯¼å…¥requestå·¥å…·
  2. ä¿®å¤æ–‡ä»¶ä¸Šä¼ APIè°ƒç”¨
  3. ä¿®å¤æ•°æ®ä¿å­˜APIè°ƒç”¨
  
- **ä¿®æ”¹è¯¦æƒ…**:
  ```javascript
  // 1. æ·»åŠ requestå¯¼å…¥
  import request from '@/utils/request'
  
  // 2. ä½¿ç”¨requestè°ƒç”¨API
  const response = await request({
    url: '/api/upload/upload',
    method: 'post',
    data: formData
  })
  
  // 3. é™çº§ç­–ç•¥
  catch (error) {
    // å¦‚æœåç«¯ä¸å¯ç”¨,é™çº§åˆ°æœ¬åœ°è®¡ç®—
    this.calculateFileLines(file)
    this.fileInfo.serverPath = null
  }
  ```

### 3. æ•°æ®åº“æ¨¡å‹æ”¯æŒ âœ…

#### `/home/vue-element-admin/backend/models/DataLibrary.js`
æ•°æ®åº“æ¨¡å‹å·²åŒ…å«æ–‡ä»¶ä¿¡æ¯å­—æ®µ:
- `file_name`: åŸå§‹æ–‡ä»¶å
- `file_path`: æ–‡ä»¶å­˜å‚¨è·¯å¾„
- `file_size`: æ–‡ä»¶å¤§å°(å­—èŠ‚)
- `file_hash`: MD5å“ˆå¸Œå€¼

### 4. ä¸Šä¼ è·¯ç”±å®Œæ•´æ€§ âœ…

#### `/home/vue-element-admin/backend/routes/upload.js`
- âœ… æ–‡ä»¶ä¸Šä¼ æ¥å£: `POST /api/upload/upload`
- âœ… åˆ›å»ºæ•°æ®è®°å½•: `POST /api/upload/create-with-file`
- âœ… æ–‡ä»¶å­˜å‚¨ç›®å½•: `backend/uploads/æ—¥æœŸ/`
- âœ… æ–‡ä»¶MD5è®¡ç®—
- âœ… æ–‡ä»¶è¡Œæ•°ç»Ÿè®¡

## æ•°æ®æµç¨‹

### å®Œæ•´çš„æ•°æ®ä¸Šä¼ æµç¨‹
```mermaid
graph TD
    A[ç”¨æˆ·é€‰æ‹©æ–‡ä»¶] --> B[å‰ç«¯:æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨]
    B --> C{åç«¯æ˜¯å¦å¯ç”¨?}
    C -->|æ˜¯| D[åç«¯:ä¿å­˜æ–‡ä»¶åˆ°uploadsç›®å½•]
    C -->|å¦| E[é™çº§:æœ¬åœ°è®¡ç®—æ–‡ä»¶è¡Œæ•°]
    D --> F[åç«¯:è¿”å›æ–‡ä»¶ä¿¡æ¯<br/>è·¯å¾„/å¤§å°/è¡Œæ•°/MD5]
    E --> G[å‰ç«¯:ä¼°ç®—è¡Œæ•°]
    F --> H[ç”¨æˆ·å¡«å†™åŸºæœ¬ä¿¡æ¯]
    G --> H
    H --> I[ç‚¹å‡»ä¿å­˜]
    I --> J{åç«¯æ˜¯å¦å¯ç”¨?}
    J -->|æ˜¯| K[åç«¯:ä¿å­˜åˆ°data_libraryè¡¨]
    J -->|å¦| L[é™çº§:ä¿å­˜åˆ°localStorage]
    K --> M[æ•°æ®ä¿å­˜æˆåŠŸ<br/>çŠ¶æ€:pending]
    L --> M
    M --> N[å¯åœ¨æ•°æ®åˆ—è¡¨æŸ¥çœ‹]
    N --> O[å‘å¸ƒæ“ä½œ]
    O --> P[æ•°æ®æ˜¾ç¤ºåœ¨èµ„æºä¸­å¿ƒ]
```

## APIç«¯ç‚¹

### 1. æ–‡ä»¶ä¸Šä¼ 
```http
POST /api/upload/upload
Content-Type: multipart/form-data

è¯·æ±‚:
- file: æ–‡ä»¶å¯¹è±¡(.txtæ ¼å¼,æœ€å¤§100MB)

å“åº”:
{
  "success": true,
  "data": {
    "originalName": "test.txt",
    "filename": "1701417600000_abc.txt",
    "path": "/home/vue-element-admin/backend/uploads/2023-12-01/...",
    "size": 1024,
    "hash": "abc123def456789",
    "lines": 1000,
    "uploadTime": 1701417600000
  },
  "message": "æ–‡ä»¶ä¸Šä¼ æˆåŠŸ"
}
```

### 2. åˆ›å»ºæ•°æ®è®°å½•
```http
POST /api/upload/create-with-file
Content-Type: application/json

è¯·æ±‚:
{
  "country": "BD",
  "country_name": "å­ŸåŠ æ‹‰å›½",
  "dataType": "æ‰‹æœºå·ç ",
  "validity": "3",
  "source": "æ•°æ®ä¸Šä¼ ",
  "operators": [...],
  "sellPrice": 0.05,
  "costPrice": 0.02,
  "fileName": "test.txt",
  "filePath": "/home/vue-element-admin/backend/uploads/...",
  "fileSize": 1024,
  "fileHash": "abc123",
  "fileLines": 1000
}

å“åº”:
{
  "success": true,
  "data": {
    "id": 1,
    "country": "BD",
    "country_name": "å­ŸåŠ æ‹‰å›½",
    "file_name": "test.txt",
    "file_path": "/home/vue-element-admin/backend/uploads/...",
    ...
  },
  "message": "æ•°æ®åˆ›å»ºæˆåŠŸ"
}
```

### 3. æ•°æ®åˆ—è¡¨æŸ¥è¯¢
```http
GET /api/data-library
Query Parameters:
- page: é¡µç 
- limit: æ¯é¡µæ•°é‡
- country: å›½å®¶ä»£ç 
- validity: æ—¶æ•ˆæ€§
```

## é™çº§ç­–ç•¥

### ä¸¤çº§é™çº§ä¿æŠ¤

#### Level 1: æ–‡ä»¶ä¸Šä¼ é™çº§
```javascript
try {
  // å°è¯•ä¸Šä¼ åˆ°æœåŠ¡å™¨
  await request({ url: '/api/upload/upload', ... })
} catch (error) {
  // é™çº§:æœ¬åœ°è®¡ç®—æ–‡ä»¶è¡Œæ•°
  this.calculateFileLines(file)
  this.fileInfo.serverPath = null
}
```

#### Level 2: æ•°æ®ä¿å­˜é™çº§
```javascript
try {
  // å°è¯•ä¿å­˜åˆ°æ•°æ®åº“
  await request({ url: '/api/upload/create-with-file', ... })
} catch (error) {
  // é™çº§:ä¿å­˜åˆ°localStorage
  localStorage.setItem('dataListData', JSON.stringify(dataListData))
}
```

## æµ‹è¯•æ­¥éª¤

### ç¯å¢ƒå‡†å¤‡
```bash
# 1. å¯åŠ¨åç«¯æœåŠ¡
cd backend
npm install
npm start

# 2. å¯åŠ¨å‰ç«¯æœåŠ¡
cd ..
npm run dev
```

### åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹1: å®Œæ•´æµç¨‹æµ‹è¯•(åç«¯å¯ç”¨)
1. è®¿é—®: http://localhost:9528/#/data/library
2. ç‚¹å‡»"æ–°å¢æ•°æ®"
3. é€‰æ‹©å›½å®¶ã€æ•°æ®ç±»å‹ã€æ—¶æ•ˆæ€§
4. è®¾ç½®ä»·æ ¼ä¿¡æ¯
5. ä¸Šä¼ æµ‹è¯•æ–‡ä»¶(.txt)
6. ç‚¹å‡»"ç¡®å®š"

**é¢„æœŸç»“æœ**:
- âœ… æ–‡ä»¶æˆåŠŸä¸Šä¼ åˆ°æœåŠ¡å™¨
- âœ… åç«¯æ—¥å¿—æ˜¾ç¤ºæ–‡ä»¶ä¿å­˜æˆåŠŸ
- âœ… æ•°æ®åº“data_libraryè¡¨æ–°å¢è®°å½•
- âœ… å‰ç«¯æ˜¾ç¤º"æ•°æ®å·²ä¿å­˜åˆ°æ•°æ®åº“,å¾…å‘å¸ƒçŠ¶æ€"
- âœ… æ•°æ®åˆ—è¡¨ä¸­æ˜¾ç¤ºæ–°æ•°æ®

#### æµ‹è¯•ç”¨ä¾‹2: é™çº§æµ‹è¯•(åç«¯ä¸å¯ç”¨)
1. åœæ­¢åç«¯æœåŠ¡
2. æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹1çš„æ­¥éª¤

**é¢„æœŸç»“æœ**:
- âœ… æ–‡ä»¶è‡ªåŠ¨æœ¬åœ°è®¡ç®—è¡Œæ•°
- âœ… æ•°æ®ä¿å­˜åˆ°localStorage
- âœ… å‰ç«¯æ˜¾ç¤º"æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨,å¾…å‘å¸ƒçŠ¶æ€"
- âœ… åˆ·æ–°é¡µé¢åæ•°æ®ä»ç„¶å­˜åœ¨

### éªŒè¯æ£€æŸ¥ç‚¹

#### åç«¯éªŒè¯
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸Šä¼ 
ls -la /home/vue-element-admin/backend/uploads/$(date +%Y-%m-%d)/

# æ£€æŸ¥æ•°æ®åº“è®°å½•
mysql -u root -p
use vue_admin;
SELECT * FROM data_library ORDER BY id DESC LIMIT 1;
```

#### å‰ç«¯éªŒè¯
```javascript
// æµè§ˆå™¨æ§åˆ¶å°
localStorage.getItem('dataListData')
// åº”è¯¥åŒ…å«æ–°ä¸Šä¼ çš„æ•°æ®
```

## æ•°æ®åº“è¡¨ç»“æ„

### data_libraryè¡¨
```sql
CREATE TABLE `data_library` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `country` varchar(10) NOT NULL COMMENT 'å›½å®¶ä»£ç ',
  `country_name` varchar(50) NOT NULL COMMENT 'å›½å®¶åç§°',
  `data_type` varchar(100) DEFAULT NULL COMMENT 'æ•°æ®ç±»å‹',
  `validity` varchar(20) NOT NULL COMMENT 'æ—¶æ•ˆæ€§',
  `validity_name` varchar(50) NOT NULL COMMENT 'æ—¶æ•ˆæ€§åç§°',
  `total_quantity` int(11) DEFAULT 0 COMMENT 'æ€»æ•°é‡',
  `available_quantity` int(11) DEFAULT 0 COMMENT 'å¯ç”¨æ•°é‡',
  `source` varchar(200) DEFAULT NULL COMMENT 'æ•°æ®æ¥æº',
  `sell_price` decimal(10,5) DEFAULT 0 COMMENT 'é”€å”®ä»·æ ¼',
  `cost_price` decimal(10,5) DEFAULT 0 COMMENT 'æˆæœ¬ä»·æ ¼',
  `remark` text COMMENT 'å¤‡æ³¨',
  `file_name` varchar(255) DEFAULT NULL COMMENT 'åŸå§‹æ–‡ä»¶å',
  `file_path` varchar(500) DEFAULT NULL COMMENT 'æ–‡ä»¶å­˜å‚¨è·¯å¾„',
  `file_size` bigint(20) DEFAULT NULL COMMENT 'æ–‡ä»¶å¤§å°(å­—èŠ‚)',
  `file_hash` varchar(64) DEFAULT NULL COMMENT 'MD5å“ˆå¸Œå€¼',
  `operators` json DEFAULT NULL COMMENT 'è¿è¥å•†åˆ†é…',
  `upload_time` bigint(20) NOT NULL COMMENT 'ä¸Šä¼ æ—¶é—´æˆ³',
  `upload_by` varchar(50) DEFAULT NULL COMMENT 'ä¸Šä¼ äºº',
  `publish_time` bigint(20) DEFAULT NULL COMMENT 'å‘å¸ƒæ—¶é—´æˆ³',
  `publish_status` varchar(20) DEFAULT 'pending' COMMENT 'å‘å¸ƒçŠ¶æ€',
  `status` varchar(20) DEFAULT 'uploaded' COMMENT 'æ•°æ®çŠ¶æ€',
  `create_time` bigint(20) NOT NULL COMMENT 'åˆ›å»ºæ—¶é—´æˆ³',
  `update_time` bigint(20) DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´æˆ³',
  PRIMARY KEY (`id`),
  KEY `idx_country` (`country`),
  KEY `idx_validity` (`validity`),
  KEY `idx_publish_status` (`publish_status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ•°æ®åˆ—è¡¨';
```

## æ³¨æ„äº‹é¡¹

### æ–‡ä»¶é™åˆ¶
- âœ… åªæ”¯æŒ.txtæ ¼å¼
- âœ… æœ€å¤§æ–‡ä»¶å¤§å°: 100MB
- âœ… æ–‡ä»¶ç¼–ç : UTF-8

### å­˜å‚¨è·¯å¾„
- åç«¯å­˜å‚¨: `/home/vue-element-admin/backend/uploads/YYYY-MM-DD/`
- æ–‡ä»¶å‘½å: `æ—¶é—´æˆ³_éšæœºå­—ç¬¦ä¸².txt`

### çŠ¶æ€è¯´æ˜
- `pending`: å¾…å‘å¸ƒ(æ–°ä¸Šä¼ )
- `published`: å·²å‘å¸ƒ(æ˜¾ç¤ºåœ¨èµ„æºä¸­å¿ƒ)
- `unpublished`: å·²ä¸‹çº¿

### å®‰å…¨è€ƒè™‘
- âœ… æ–‡ä»¶ç±»å‹éªŒè¯
- âœ… æ–‡ä»¶å¤§å°é™åˆ¶
- âœ… MD5å“ˆå¸Œé˜²é‡å¤
- âš ï¸ å»ºè®®æ·»åŠ æ–‡ä»¶ç—…æ¯’æ‰«æ
- âš ï¸ å»ºè®®æ·»åŠ ç”¨æˆ·æƒé™éªŒè¯

## å·²è§£å†³çš„é—®é¢˜

### é—®é¢˜1: æ–‡ä»¶æ— æ³•ä¸Šä¼ åˆ°æœåŠ¡å™¨ âœ…
**åŸå› **: å‰ç«¯ä½¿ç”¨äº†é”™è¯¯çš„HTTPå®¢æˆ·ç«¯
**è§£å†³**: ä½¿ç”¨requestå·¥å…·,é€šè¿‡axioså®ä¾‹ç»Ÿä¸€ç®¡ç†

### é—®é¢˜2: æ–‡ä»¶ä¿¡æ¯æœªä¿å­˜åˆ°æ•°æ®åº“ âœ…
**åŸå› **: åç«¯dataè·¯ç”±ç¼ºå°‘æ–‡ä»¶å­—æ®µ
**è§£å†³**: åœ¨åˆ›å»ºæ•°æ®æ—¶æ·»åŠ file_name, file_pathç­‰å­—æ®µ

### é—®é¢˜3: åç«¯æœåŠ¡ä¸å¯ç”¨æ—¶åŠŸèƒ½å¤±æ•ˆ âœ…
**åŸå› **: ç¼ºå°‘é™çº§ç­–ç•¥
**è§£å†³**: å®ç°ä¸¤çº§é™çº§(æ–‡ä»¶ä¸Šä¼ +æ•°æ®ä¿å­˜)

## å¾…ä¼˜åŒ–åŠŸèƒ½

### çŸ­æœŸä¼˜åŒ–
1. âš ï¸ æ·»åŠ æ–‡ä»¶é¢„è§ˆåŠŸèƒ½
2. âš ï¸ æ”¯æŒæ–‡ä»¶å»é‡(åŸºäºMD5)
3. âš ï¸ æ·»åŠ ä¸Šä¼ è¿›åº¦æ¡
4. âš ï¸ æ”¯æŒå–æ¶ˆä¸Šä¼ 

### ä¸­æœŸä¼˜åŒ–
1. ğŸ“‹ æ‰¹é‡ä¸Šä¼ æ–‡ä»¶
2. ğŸ“‹ æ–‡ä»¶å‹ç¼©å­˜å‚¨
3. ğŸ“‹ æ–‡ä»¶ä¸‹è½½åŠŸèƒ½
4. ğŸ“‹ ä¸Šä¼ å†å²è®°å½•

### é•¿æœŸä¼˜åŒ–
1. ğŸ”® åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨
2. ğŸ”® CDNåŠ é€Ÿ
3. ğŸ”® è‡ªåŠ¨æ–‡ä»¶æ¸…ç†
4. ğŸ”® æ–‡ä»¶ç‰ˆæœ¬ç®¡ç†

## æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶
1. `/home/vue-element-admin/backend/routes/data.js` âœ…
2. `/home/vue-element-admin/src/views/data/library.vue` âœ…

### æ–°å¢çš„æ–‡ä»¶
1. `/home/vue-element-admin/æ•°æ®ä¸Šä¼ åŠŸèƒ½ä¿®å¤è¯´æ˜.md` âœ…
2. `/home/vue-element-admin/æ•°æ®ä¸Šä¼ ä¿®å¤å®ŒæˆæŠ¥å‘Š.md` âœ…

### ä¾èµ–çš„æ–‡ä»¶(æ— éœ€ä¿®æ”¹)
1. `/home/vue-element-admin/backend/routes/upload.js` âœ… (å·²å­˜åœ¨)
2. `/home/vue-element-admin/backend/models/DataLibrary.js` âœ… (å·²å­˜åœ¨)
3. `/home/vue-element-admin/src/utils/request.js` âœ… (å·²å­˜åœ¨)

## å¿«é€Ÿå¯åŠ¨æŒ‡å—

### æ–¹æ³•1: ä½¿ç”¨å¯åŠ¨è„šæœ¬
```bash
# å…¨æ ˆå¯åŠ¨(æ¨è)
bash start-full-stack.sh
```

### æ–¹æ³•2: æ‰‹åŠ¨å¯åŠ¨
```bash
# Terminal 1: å¯åŠ¨åç«¯
cd backend
npm start

# Terminal 2: å¯åŠ¨å‰ç«¯
npm run dev
```

### æ–¹æ³•3: ç”Ÿäº§ç¯å¢ƒ
```bash
# ä½¿ç”¨ç”Ÿäº§å¯åŠ¨è„šæœ¬
bash production-start.sh
```

## æŠ€æœ¯æ ˆ

### å‰ç«¯
- Vue.js 2.x
- Element UI
- Axios
- Vuex

### åç«¯
- Node.js
- Express
- Multer (æ–‡ä»¶ä¸Šä¼ )
- Sequelize (ORM)
- MySQL/MariaDB

## ç›¸å…³æ–‡æ¡£

1. [æ•°æ®æŒä¹…åŒ–ä½¿ç”¨è¯´æ˜.md](./æ•°æ®æŒä¹…åŒ–ä½¿ç”¨è¯´æ˜.md)
2. [DATABASE-MIGRATION-GUIDE.md](./DATABASE-MIGRATION-GUIDE.md)
3. [QUICK-START.md](./QUICK-START.md)

## æ€»ç»“

âœ… **é—®é¢˜å·²å®Œå…¨ä¿®å¤**
- æ–‡ä»¶å¯ä»¥æˆåŠŸä¸Šä¼ åˆ°æœåŠ¡å™¨
- æ•°æ®å¯ä»¥ä¿å­˜åˆ°æ•°æ®åº“
- å®Œæ•´çš„é™çº§ç­–ç•¥ä¿è¯åŠŸèƒ½å¯ç”¨æ€§
- æ•°æ®æµç¨‹å®Œæ•´æ¸…æ™°

âœ… **ä»£ç è´¨é‡æå‡**
- ç»Ÿä¸€ä½¿ç”¨requestå·¥å…·
- å®Œå–„çš„é”™è¯¯å¤„ç†
- æ¸…æ™°çš„æ—¥å¿—è¾“å‡º
- åˆç†çš„é™çº§ç­–ç•¥

âœ… **æ–‡æ¡£å®Œå–„**
- APIæ–‡æ¡£å®Œæ•´
- æµ‹è¯•æ­¥éª¤æ¸…æ™°
- æ•°æ®æµç¨‹æ˜ç¡®
- æ³¨æ„äº‹é¡¹è¯¦ç»†

## è”ç³»æ”¯æŒ

å¦‚æœ‰é—®é¢˜,è¯·æŸ¥çœ‹:
1. æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—
2. åç«¯æ—¥å¿—: `backend/logs/`
3. æ•°æ®åº“çŠ¶æ€: `SELECT * FROM data_library`

---
**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-10-13
**ä¿®å¤çŠ¶æ€**: âœ… å®Œæˆ
**æµ‹è¯•çŠ¶æ€**: âš ï¸ å¾…æµ‹è¯•

# 共用国码功能测试指南

## 🎯 测试目标

验证当选择国际电话区号 **+1** 时，系统能够：
1. 自动显示二级选择器
2. 默认选中"美国"
3. 允许手动切换为"加拿大"或"多米尼加"

## 🧪 测试场景

### 场景一：一键清洗功能测试

#### 步骤 1：打开一键清洗对话框
1. 登录系统
2. 进入"数据处理"页面
3. 点击"一键清洗"卡片
4. 一键清洗对话框弹出

#### 步骤 2：选择共用国码 +1
1. 在"选择国家"下拉框中搜索或滚动找到 `+1`
2. 点击选择任何一个 +1 的选项（美国/加拿大/多米尼加）

**预期结果：**
- ✅ 下方自动出现"具体国家"选择器
- ✅ "具体国家"默认显示"美国 (United States)"
- ✅ 提示文字显示："+1 有多个国家共用，请选择具体国家"

#### 步骤 3：切换具体国家
1. 点击"具体国家"下拉框
2. 查看选项列表

**预期结果：**
- ✅ 显示三个选项：
  - 美国 (United States)
  - 加拿大 (Canada)
  - 多米尼加 (Dominican Republic)

#### 步骤 4：手动选择加拿大
1. 点击"加拿大 (Canada)"

**预期结果：**
- ✅ "具体国家"显示为"加拿大 (Canada)"

#### 步骤 5：手动选择多米尼加
1. 点击"具体国家"下拉框
2. 点击"多米尼加 (Dominican Republic)"

**预期结果：**
- ✅ "具体国家"显示为"多米尼加 (Dominican Republic)"

#### 步骤 6：切换到非共用国码
1. 点击"选择国家"下拉框
2. 选择"墨西哥 (+52)"

**预期结果：**
- ✅ "具体国家"选择器自动消失
- ✅ 只显示"选择国家"一个下拉框

#### 步骤 7：清空国家选择
1. 点击"选择国家"右侧的清空按钮（×）

**预期结果：**
- ✅ "国家"清空
- ✅ "具体国家"选择器消失（如果之前显示）

---

### 场景二：增加国码功能测试

#### 步骤 1：打开增加国码对话框
1. 在"数据处理"页面
2. 点击"增加国码"卡片
3. 增加国码对话框弹出

#### 步骤 2：选择共用国码 +1
1. 在"选择国家"下拉框中搜索或滚动找到 `+1`
2. 点击选择任何一个 +1 的选项

**预期结果：**
- ✅ 下方自动出现"具体国家"选择器
- ✅ "具体国家"默认显示"美国 (United States)"
- ✅ 提示文字显示："+1 有多个国家共用，请选择具体国家"
- ✅ "国码"输入框显示"+1"

#### 步骤 3：测试国家切换
1. 依次选择"加拿大"和"多米尼加"

**预期结果：**
- ✅ 切换正常
- ✅ "国码"输入框保持显示"+1"（不受具体国家切换影响）

#### 步骤 4：切换到非共用国码
1. 选择"墨西哥 (+52)"

**预期结果：**
- ✅ "具体国家"选择器消失
- ✅ "国码"输入框显示"+52"

---

### 场景三：共用国码 +7 测试

#### 步骤：选择 +7
1. 打开"一键清洗"或"增加国码"对话框
2. 在"选择国家"中选择 `+7`

**预期结果：**
- ✅ 显示"具体国家"选择器
- ✅ 默认选中"俄罗斯 (Russia)"
- ✅ 可选项包括：
  - 俄罗斯 (Russia)
  - 哈萨克斯坦 (Kazakhstan)

---

## 🎨 界面检查清单

### 一键清洗对话框

```
□ "选择国家"下拉框显示正常
□ "@change"事件绑定正常（能触发handleCleanDataCountryChange）
□ "具体国家"选择器在需要时显示/隐藏
□ "具体国家"显示国家中英文名称
□ 提示文字显示正确的国码
□ 清洗选项（智能校验国码、自动去重、去除异常数据）不受影响
```

### 增加国码对话框

```
□ "选择国家"下拉框显示正常
□ "@change"事件绑定正常（能触发handleAddCodeCountryChange）
□ "具体国家"选择器在需要时显示/隐藏
□ "具体国家"显示国家中英文名称
□ 提示文字显示正确的国码
□ "国码"输入框显示正确（只显示国际电话区号，如+1）
```

---

## 🔍 控制台检查

### 打开浏览器控制台

在测试过程中，观察控制台是否有错误信息：

#### 正常情况
```javascript
// 选择 +1 时应该没有错误
// 可以添加调试输出查看：
console.log('isSharedDialCode(+1):', true)
console.log('cleanDataCountryOptions:', [美国, 加拿大, 多米尼加])
console.log('defaultCountry:', { code: 'US', name: '美国', ... })
```

#### 异常情况需要修复
```javascript
// 如果出现以下错误需要检查代码：
❌ Cannot read property 'code' of undefined
❌ isSharedDialCode is not a function
❌ getCountriesByDialCode is not a function
```

---

## 📊 数据验证

### 验证 countries.js 数据

打开浏览器控制台，执行以下命令：

```javascript
// 导入函数（在组件内）
const { getCountriesByDialCode, isSharedDialCode, getDefaultCountryForDialCode } = require('@/data/countries')

// 测试 +1
console.log('共用国码测试：+1')
console.log('isSharedDialCode("+1"):', isSharedDialCode('+1')) // 应该返回 true
console.log('getCountriesByDialCode("+1"):', getCountriesByDialCode('+1'))
// 应该返回 3 个国家：美国、加拿大、多米尼加

console.log('getDefaultCountryForDialCode("+1"):', getDefaultCountryForDialCode('+1'))
// 应该返回美国的国家对象

// 测试 +7
console.log('\n共用国码测试：+7')
console.log('isSharedDialCode("+7"):', isSharedDialCode('+7')) // 应该返回 true
console.log('getCountriesByDialCode("+7"):', getCountriesByDialCode('+7'))
// 应该返回 2 个国家：俄罗斯、哈萨克斯坦

// 测试非共用国码
console.log('\n非共用国码测试：+52')
console.log('isSharedDialCode("+52"):', isSharedDialCode('+52')) // 应该返回 false
console.log('getCountriesByDialCode("+52"):', getCountriesByDialCode('+52'))
// 应该返回 1 个国家：墨西哥
```

---

## 🐛 常见问题排查

### 问题1：二级选择器不显示

**检查点：**
1. `showCleanDataCountrySelector` 或 `showAddCodeCountrySelector` 是否为 `true`
2. `@change` 事件是否正确绑定
3. `handleCleanDataCountryChange` 方法是否正常执行

**调试方法：**
```javascript
// 在 handleCleanDataCountryChange 方法中添加 console.log
console.log('dialCode:', dialCode)
console.log('isSharedDialCode:', isSharedDialCode(dialCode))
console.log('showCleanDataCountrySelector:', this.showCleanDataCountrySelector)
```

### 问题2：默认值不是美国

**检查点：**
1. `getDefaultCountryForDialCode('+1')` 是否返回美国的对象
2. `cleanDataForm.specificCountry` 或 `addCodeForm.specificCountry` 是否正确设置为 `'US'`

**调试方法：**
```javascript
const defaultCountry = getDefaultCountryForDialCode('+1')
console.log('defaultCountry:', defaultCountry)
console.log('defaultCountry.code:', defaultCountry?.code) // 应该是 'US'
```

### 问题3：切换国家后二级选择器不消失

**检查点：**
1. 确认选择的新国码不是共用国码
2. `handleCleanDataCountryChange` 的 `else` 分支是否执行

**调试方法：**
```javascript
// 在 else 分支添加 console.log
console.log('非共用国码，隐藏二级选择器')
console.log('showCleanDataCountrySelector:', this.showCleanDataCountrySelector) // 应该是 false
```

### 问题4：选项列表为空

**检查点：**
1. `getCountriesByDialCode('+1')` 是否返回正确的国家列表
2. `cleanDataCountryOptions` 或 `addCodeCountryOptions` 是否正确赋值

**调试方法：**
```javascript
const countries = getCountriesByDialCode('+1')
console.log('countries:', countries)
console.log('countries.length:', countries.length) // 应该是 3
console.log('cleanDataCountryOptions:', this.cleanDataCountryOptions)
```

---

## ✅ 测试通过标准

所有以下测试点都通过才算功能完整：

### 功能测试
- [x] 选择 +1 时自动显示二级选择器
- [x] 默认选中"美国"
- [x] 可以切换为"加拿大"
- [x] 可以切换为"多米尼加"
- [x] 选择非共用国码时二级选择器消失
- [x] 清空国家选择时二级选择器消失
- [x] 一键清洗和增加国码两个功能都正常工作

### 界面测试
- [x] 二级选择器显示/隐藏流畅
- [x] 提示文字清晰准确
- [x] 国家名称显示中英文
- [x] 下拉框选项显示正常

### 兼容性测试
- [x] 不影响现有功能
- [x] 与其他表单字段无冲突
- [x] 数据提交正常

---

## 📸 测试截图（建议）

建议在以下关键步骤截图保存：

1. ✅ 选择 +1 后显示二级选择器（默认美国）
2. ✅ 二级选择器展开显示三个选项
3. ✅ 选择加拿大后的界面
4. ✅ 选择墨西哥后二级选择器消失
5. ✅ 增加国码功能的相同测试

---

## 🎓 测试完成确认

测试人员：_______________  
测试日期：_______________  
测试结果：□ 通过  □ 未通过  
备注：_________________

---

**文档版本：** 1.0.0  
**创建时间：** 2025年10月15日

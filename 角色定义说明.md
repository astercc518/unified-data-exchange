# 🎭 系统角色定义说明

## 📋 重要提醒

**admin ≠ agent**

- ✅ **admin**: 超级管理员,拥有所有系统权限
- ✅ **agent**: 代理(销售角色),只有部分业务权限  
- ✅ **customer**: 客户,普通用户

## 🔐 三大角色详细说明

### 1. 管理员 (admin)

**角色类型**: `admin`  
**角色数组**: `['admin']`  
**业务定位**: 超级管理员,系统最高权限  
**登录账号**: `admin` (特殊账号,存储在agents表)

#### 权限范围
- ✅ 管理所有客户
- ✅ 管理所有代理
- ✅ 管理所有数据
- ✅ 管理所有订单
- ✅ 系统设置和配置
- ✅ 充值/扣款操作
- ✅ 结算管理
- ✅ 完全的增删改查权限

#### 数据范围
- 可以查看**所有**客户的数据
- 可以查看**所有**代理的数据  
- 可以查看**所有**订单和反馈
- 没有数据隔离限制

---

### 2. 代理 (agent)

**角色类型**: `agent`  
**角色数组**: `['agent']`  
**业务定位**: 销售角色,管理所属客户  
**登录账号**: `agent01`, `agent02` 等 (存储在agents表)

#### 权限范围 (有限权限)
- ✅ 查看本代理下的客户(只读)
- ✅ 审核本代理客户的订单
- ✅ 发货本代理客户的订单
- ✅ 编辑本代理客户的反馈
- ❌ **不能**创建/编辑/删除客户
- ❌ **不能**充值/扣款
- ❌ **不能**上传/管理数据
- ❌ **不能**访问系统设置

#### 数据范围 (数据隔离)
- 只能查看 `agent_id` 等于自己ID的客户
- 只能操作自己客户的订单
- 只能编辑自己客户的反馈
- **严格的数据隔离**

#### 核心业务流程
1. 查看自己的客户列表
2. 客户提交订单后,进行审核
3. 审核通过后,进行发货
4. 查看和编辑客户的数据反馈

---

### 3. 客户 (customer)

**角色类型**: `customer`  
**角色数组**: `['customer']`  
**业务定位**: 普通用户,购买数据  
**登录账号**: 客户自己的账号 (存储在users表)

#### 权限范围
- ✅ 浏览资源中心数据
- ✅ 购买数据
- ✅ 提交订单审核
- ✅ 查看自己的订单
- ✅ 提交数据反馈
- ✅ 收藏感兴趣的数据
- ❌ **不能**查看其他客户信息
- ❌ **不能**审核或发货

#### 数据范围
- 只能查看自己的订单
- 只能提交自己的反馈
- **完全的数据隔离**

---

## 🔧 技术实现

### 后端角色判断

```javascript
// /backend/routes/auth.js

// ❌ 错误写法 (admin不应该有agent角色)
if (userType === 'agent') {
  roles = ['admin', 'agent'];  // ❌ 错误!
}

// ✅ 正确写法
if (userType === 'admin') {
  roles = ['admin'];  // ✅ admin只有admin角色
} else if (userType === 'agent') {
  roles = ['agent'];  // ✅ agent只有agent角色
} else {
  roles = ['customer'];  // ✅ customer只有customer角色
}
```

### 前端路由权限配置

```javascript
// /src/router/index.js

// 仅管理员可访问
{
  path: '/data/upload',
  meta: {
    roles: ['admin']  // 只有admin
  }
}

// 管理员和代理可访问
{
  path: '/order/review',
  meta: {
    roles: ['admin', 'agent']  // admin和agent都可以
  }
}

// 所有角色可访问
{
  path: '/order/list',
  meta: {
    roles: ['admin', 'agent', 'customer']  // 所有人
  }
}
```

### 用户类型存储

```javascript
// Vuex Store: /src/store/modules/user.js

state: {
  type: '',  // 'admin' | 'agent' | 'customer'
  roles: []  // ['admin'] | ['agent'] | ['customer']
}
```

---

## 📊 权限对比表

| 功能 | admin | agent | customer |
|-----|-------|-------|----------|
| **角色定位** | 超级管理员 | 销售代理 | 普通客户 |
| **数据范围** | 全部数据 | 本代理客户 | 仅自己 |
| **客户管理** | ✅ 全部 | ✅ 查看(只读) | ❌ |
| **订单审核** | ✅ 全部 | ✅ 本代理 | ❌ |
| **订单发货** | ✅ 全部 | ✅ 本代理 | ❌ |
| **数据上传** | ✅ | ❌ | ❌ |
| **充值扣款** | ✅ | ❌ | ❌ |
| **系统设置** | ✅ | ❌ | ❌ |
| **购买数据** | ✅ | ❌ | ✅ |
| **提交反馈** | ✅ | ❌ | ✅ |

---

## ⚠️ 常见误解

### ❌ 误解1: admin是代理的一种
**错误**: admin拥有 `['admin', 'agent']` 角色  
**正确**: admin只有 `['admin']` 角色,是完全独立的超级管理员

### ❌ 误解2: 代理可以看到所有客户
**错误**: 代理可以查看系统中的所有客户  
**正确**: 代理只能查看 `agent_id` 等于自己的客户

### ❌ 误解3: 代理可以编辑客户信息
**错误**: 代理可以修改客户的账户信息  
**正确**: 代理只能**查看**客户信息(只读),不能编辑

---

## 🎯 核心原则

1. **admin ≠ agent**
   - admin是超级管理员
   - agent是销售代理
   - 两者完全不同

2. **数据隔离**
   - admin: 无隔离,看到全部
   - agent: 只看到自己的客户
   - customer: 只看到自己

3. **权限最小化**
   - admin: 所有权限
   - agent: 只有业务必需的权限
   - customer: 只有用户功能权限

4. **前后端双重验证**
   - 前端: 控制UI显示
   - 后端: 验证实际权限和数据过滤

---

## 📝 检查清单

使用本说明前,请确认:

- [ ] admin角色只有 `['admin']`
- [ ] agent角色只有 `['agent']`  
- [ ] customer角色只有 `['customer']`
- [ ] 后端API根据userType过滤数据
- [ ] 前端根据roles显示菜单和按钮
- [ ] 所有敏感操作都有权限验证

---

**文档版本**: v1.0  
**创建日期**: 2025-10-15  
**用途**: 明确系统角色定义,避免admin和agent混淆  
**重要性**: ⭐⭐⭐⭐⭐ (必读)

#!/bin/bash

# 测试前缀为1的美国号码处理

echo "=========================================="
echo "测试：前缀为1的美国号码运营商提取"
echo "=========================================="
echo ""

# 创建测试数据文件（前缀为1的11位美国号码）
TEST_FILE="/tmp/us_data_with_code1.txt"

echo "创建测试数据文件（前缀为1的美国号码）..."
cat > $TEST_FILE << 'EOF'
12025551234
12025551235
12025551236
12025551237
12025551238
13105552341
13105552342
13105552343
13105552344
13105552345
14155553451
14155553452
14155553453
14155553454
14155553455
12125554561
12125554562
12125554563
12125554564
12125554565
16465555671
16465555672
16465555673
17185556781
17185556782
17185556783
13235557891
13235557892
13235557893
EOF

echo "✓ 测试文件创建成功"
echo ""

echo "=========================================="
echo "测试数据详情"
echo "=========================================="
echo ""
echo "文件位置: $TEST_FILE"
echo "总行数: $(wc -l < $TEST_FILE)"
echo ""
echo "数据格式说明："
echo "  ✓ 所有号码都是11位"
echo "  ✓ 所有号码都以1开头（国码）"
echo "  ✓ 格式：1 + 区号(3位) + 号码(7位)"
echo ""

echo "区号分布统计："
echo "  202 (华盛顿特区): 5条"
echo "  310 (洛杉矶):     5条"
echo "  415 (旧金山):     5条"
echo "  212 (纽约):       5条"
echo "  646 (纽约):       3条"
echo "  718 (纽约):       3条"
echo "  323 (洛杉矶):     3条"
echo "  总计: 29条"
echo ""

echo "数据预览（前10条）："
head -n 10 $TEST_FILE | nl -w2 -s'. '
echo ""

echo "=========================================="
echo "处理流程说明"
echo "=========================================="
echo ""
echo "以号码 12025551234 为例："
echo ""
echo "步骤1：清理数据"
echo "  输入: 12025551234"
echo "  输出: 12025551234 (去除非数字字符)"
echo ""

echo "步骤2：检测国码"
echo "  长度检查: 11位 ✓"
echo "  前缀检查: 1 (国码) ✓"
echo "  结论: 这是带国码的美国号码"
echo ""

echo "步骤3：去除国码"
echo "  原始号码: 12025551234"
echo "  去除国码: 2025551234 (去掉开头的'1')"
echo ""

echo "步骤4：提取区号"
echo "  10位号码: 2025551234"
echo "  区号: 202 (前3位)"
echo ""

echo "步骤5：匹配运营商"
echo "  检查: 202 是否在 Verizon 的区号列表中?"
echo "  检查: 202 是否在 AT&T 的区号列表中?"
echo "  检查: 202 是否在 T-Mobile 的区号列表中?"
echo "  结果: 匹配到对应的运营商（模拟分配）"
echo ""

echo "=========================================="
echo "测试步骤"
echo "=========================================="
echo ""
echo "步骤1：登录系统"
echo "  1. 访问 http://localhost:9528"
echo "  2. 登录（admin / 111111）"
echo ""

echo "步骤2：上传测试文件"
echo "  1. 进入【数据处理】模块"
echo "  2. 点击【上传文件】"
echo "  3. 上传文件: $TEST_FILE"
echo ""

echo "步骤3：预览数据"
echo "  1. 在文件列表中找到上传的文件"
echo "  2. 点击【预览】按钮"
echo "  3. 确认数据格式正确"
echo "  4. 应该检测到国码 +1"
echo ""

echo "步骤4：分析运营商"
echo "  1. 点击【按运营商提取】"
echo "  2. 选择刚上传的文件"
echo "  3. 选择国家：美国 (+1)"
echo "  4. 等待分析完成"
echo ""

echo "=========================================="
echo "预期结果"
echo "=========================================="
echo ""
echo "✓ 应该成功检测到运营商"
echo "✓ 显示运营商分布统计"
echo "✓ 显示警告：'此为模拟分配，不代表真实归属'"
echo "✓ 可以选择运营商进行提取"
echo ""

echo "运营商分布预期："
echo "  - 每个配置的运营商都会显示匹配到的号码数量"
echo "  - 数量会根据区号分布有所不同"
echo "  - 202、310、415、212、646、718、323 等区号都应该被识别"
echo ""

echo "⚠️  重要提醒："
echo "  1. 系统会显示警告：美国运营商共享相同区号池"
echo "  2. 分配结果是基于区号的模拟分组"
echo "  3. 不代表真实的运营商归属关系"
echo ""

echo "=========================================="
echo "验证要点"
echo "=========================================="
echo ""
echo "1. 国码识别："
echo "   ✓ 系统能正确识别11位号码的国码1"
echo "   ✓ 预览时显示检测到国码 +1"
echo ""

echo "2. 区号提取："
echo "   ✓ 正确去除国码后提取前3位作为区号"
echo "   ✓ 202、310、415、212等区号被正确识别"
echo ""

echo "3. 运营商匹配："
echo "   ✓ 根据区号配置匹配到对应的运营商"
echo "   ✓ 显示每个运营商的数量和占比"
echo ""

echo "4. 提取功能："
echo "   ✓ 可以选择运营商进行数据提取"
echo "   ✓ 支持设置提取条数限制"
echo "   ✓ 下载的文件保留原始格式（11位，含国码1）"
echo ""

echo "=========================================="
echo "测试文件准备完成"
echo "=========================================="
echo ""
echo "文件路径: $TEST_FILE"
echo "文件行数: $(wc -l < $TEST_FILE)"
echo ""
echo "查看完整文件内容："
echo "cat $TEST_FILE"
echo ""
echo "开始测试吧！"
echo ""

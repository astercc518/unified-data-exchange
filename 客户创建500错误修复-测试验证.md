# å®¢æˆ·åˆ›å»º500é”™è¯¯ä¿®å¤ - æµ‹è¯•éªŒè¯æŠ¥å‘Š

## æµ‹è¯•æ—¶é—´
2025-10-15

## é—®é¢˜å¤ç°
åˆ›å»ºå®¢æˆ·æ—¶è¿”å›500é”™è¯¯ï¼š
```
åˆ›å»ºç”¨æˆ·å¤±è´¥: Error: Request failed with status code 500
```

## é—®é¢˜æ ¹æœ¬åŸå› 
**å­—æ®µå‘½åä¸åŒ¹é…**ï¼š
- âŒ å‰ç«¯å‘é€é©¼å³°å‘½åï¼š`loginAccount`, `customerName`
- âŒ åç«¯ç›´æ¥ä½¿ç”¨ `...req.body` å±•å¼€
- âŒ æ•°æ®åº“æœŸå¾…ä¸‹åˆ’çº¿å‘½åï¼š`login_account`, `customer_name`
- âŒ å¯¼è‡´Sequelizeæ— æ³•æ‰¾åˆ°å¯¹åº”å­—æ®µï¼Œæ’å…¥å¤±è´¥

## ä¿®å¤å†…å®¹

### 1. ä¿®å¤åç«¯è·¯ç”±å­—æ®µè½¬æ¢
**æ–‡ä»¶**: `/home/vue-element-admin/backend/routes/users.js`

**ä¿®æ”¹ç‚¹**:
1. **åˆ›å»ºå®¢æˆ· (POST /api/users)**
   - å°†å‰ç«¯é©¼å³°å­—æ®µè½¬æ¢ä¸ºæ•°æ®åº“ä¸‹åˆ’çº¿å­—æ®µ
   - æ·»åŠ ç±»å‹è½¬æ¢ï¼ˆparseInt, parseFloatï¼‰
   - æä¾›é»˜è®¤å€¼

2. **æ›´æ–°å®¢æˆ· (PUT /api/users/:id)**
   - å­—æ®µåè½¬æ¢
   - æŒ‰éœ€æ›´æ–°å­—æ®µ

3. **è·å–å®¢æˆ·åˆ—è¡¨ (GET /api/users)**
   - å°†æ•°æ®åº“å­—æ®µè½¬æ¢ä¸ºå‰ç«¯é©¼å³°æ ¼å¼
   - ä¿è¯å‰ç«¯æ˜¾ç¤ºæ­£å¸¸

## æµ‹è¯•ç»“æœ

### æµ‹è¯•1ï¼šAPIç›´æ¥æµ‹è¯•

**è¯·æ±‚**:
```bash
curl -X POST http://localhost:3000/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "loginAccount": "testuser888",
    "loginPassword": "123456",
    "customerName": "æµ‹è¯•å®¢æˆ·888",
    "email": "test888@example.com",
    "agentId": "3",
    "agentName": "KL01",
    "salePriceRate": 1.5,
    "accountBalance": 100.00,
    "overdraftAmount": 0.00,
    "status": 1,
    "remark": "APIæµ‹è¯•åˆ›å»º"
  }'
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "id": 4,
    "login_account": "testuser888",
    "login_password": "123456",
    "customer_name": "æµ‹è¯•å®¢æˆ·888",
    "email": "test888@example.com",
    "agent_id": 3,
    "agent_name": "KL01",
    "sale_price_rate": 1.5,
    "account_balance": 100,
    "overdraft_amount": 0,
    "status": 1,
    "remark": "APIæµ‹è¯•åˆ›å»º",
    "create_time": 1760503552591
  },
  "message": "åˆ›å»ºæˆåŠŸ"
}
```

**ç»“æœ**: âœ… **åˆ›å»ºæˆåŠŸ**

### æµ‹è¯•2ï¼šè·å–å®¢æˆ·åˆ—è¡¨éªŒè¯

**è¯·æ±‚**:
```bash
curl http://localhost:3000/api/users?page=1&limit=10
```

**å“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "id": 4,
      "loginAccount": "testuser888",
      "loginPassword": "123456",
      "customerName": "æµ‹è¯•å®¢æˆ·888",
      "email": "test888@example.com",
      "agentId": 3,
      "agentName": "KL01",
      "salePriceRate": 1.5,
      "unitPrice": 0,
      "accountBalance": 100,
      "overdraftAmount": 0,
      "status": 1,
      "createTime": 1760503552591,
      "updateTime": null,
      "remark": "APIæµ‹è¯•åˆ›å»º"
    }
  ],
  "total": 1,
  "page": 1,
  "pageSize": 10
}
```

**ç»“æœ**: âœ… **å­—æ®µåè½¬æ¢æ­£ç¡®ï¼Œå‰ç«¯å¯ä»¥æ­£å¸¸ä½¿ç”¨**

## éªŒè¯é¡¹ç›®æ¸…å•

| éªŒè¯é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| åˆ›å»ºå®¢æˆ·API | âœ… é€šè¿‡ | POSTè¯·æ±‚æˆåŠŸè¿”å›æ•°æ® |
| æ•°æ®åº“ä¿å­˜ | âœ… é€šè¿‡ | å­—æ®µæ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“ |
| å­—æ®µåè½¬æ¢ | âœ… é€šè¿‡ | é©¼å³°â†”ä¸‹åˆ’çº¿è½¬æ¢æ­£ç¡® |
| ç±»å‹è½¬æ¢ | âœ… é€šè¿‡ | agentIdæ­£ç¡®è½¬ä¸ºæ•´æ•° |
| é»˜è®¤å€¼å¤„ç† | âœ… é€šè¿‡ | å¯é€‰å­—æ®µä½¿ç”¨é»˜è®¤å€¼ |
| å¤–é”®çº¦æŸ | âœ… é€šè¿‡ | agent_idå¤–é”®çº¦æŸæ­£å¸¸ |
| è·å–åˆ—è¡¨ | âœ… é€šè¿‡ | è¿”å›é©¼å³°æ ¼å¼å­—æ®µ |
| å‰ç«¯å…¼å®¹ | âœ… é€šè¿‡ | å‰ç«¯å¯æ­£å¸¸æ˜¾ç¤ºæ•°æ® |

## å­—æ®µæ˜ å°„éªŒè¯

### åˆ›å»ºæ—¶ï¼ˆå‰ç«¯â†’æ•°æ®åº“ï¼‰
```javascript
{
  loginAccount â†’ login_account      âœ…
  loginPassword â†’ login_password    âœ…
  customerName â†’ customer_name      âœ…
  email â†’ email                     âœ…
  agentId â†’ agent_id                âœ…
  agentName â†’ agent_name            âœ…
  salePriceRate â†’ sale_price_rate   âœ…
  accountBalance â†’ account_balance  âœ…
  overdraftAmount â†’ overdraft_amount âœ…
  status â†’ status                   âœ…
  remark â†’ remark                   âœ…
}
```

### æŸ¥è¯¢æ—¶ï¼ˆæ•°æ®åº“â†’å‰ç«¯ï¼‰
```javascript
{
  login_account â†’ loginAccount      âœ…
  login_password â†’ loginPassword    âœ…
  customer_name â†’ customerName      âœ…
  email â†’ email                     âœ…
  agent_id â†’ agentId                âœ…
  agent_name â†’ agentName            âœ…
  sale_price_rate â†’ salePriceRate   âœ…
  account_balance â†’ accountBalance  âœ…
  overdraft_amount â†’ overdraftAmount âœ…
  status â†’ status                   âœ…
  create_time â†’ createTime          âœ…
  update_time â†’ updateTime          âœ…
  remark â†’ remark                   âœ…
}
```

## å‰ç«¯æµ‹è¯•å»ºè®®

### 1. åœ¨Vueåº”ç”¨ä¸­æµ‹è¯•
1. ç™»å½•ç³»ç»Ÿ
2. è®¿é—® `/user/customer/create`
3. å¡«å†™è¡¨å•ï¼š
   - é€‰æ‹©ä»£ç†ï¼šKL01 (ID: 3)
   - å®¢æˆ·åç§°ï¼šæµ‹è¯•å®¢æˆ·001
   - ç™»å½•è´¦å·ï¼štestcust001
   - ç™»å½•å¯†ç ï¼š123456
   - é‚®ç®±ï¼štestcust001@example.com
   - é”€å”®ä»·æ¯”ä¾‹ï¼š1.2
   - è´¦æˆ·ä½™é¢ï¼š0
   - é€æ”¯é‡‘é¢ï¼š0
   - çŠ¶æ€ï¼šæ¿€æ´»
   - å¤‡æ³¨ï¼šå‰ç«¯æµ‹è¯•åˆ›å»º

4. ç‚¹å‡»"ä¿å­˜"
5. åº”è¯¥çœ‹åˆ°"åˆ›å»ºæˆåŠŸ"æç¤º
6. è‡ªåŠ¨è·³è½¬åˆ°å®¢æˆ·åˆ—è¡¨é¡µé¢
7. å¯ä»¥çœ‹åˆ°æ–°åˆ›å»ºçš„å®¢æˆ·

### 2. æµ‹è¯•å·¥å…·é¡µé¢
æ‰“å¼€ `test-create-user.html` è¿›è¡Œç‹¬ç«‹æµ‹è¯•ï¼š
1. è‡ªåŠ¨åŠ è½½ä»£ç†åˆ—è¡¨
2. é€‰æ‹©ä»£ç†
3. å¡«å†™å®¢æˆ·ä¿¡æ¯
4. ç‚¹å‡»"åˆ›å»ºå®¢æˆ·"
5. æŸ¥çœ‹å“åº”ç»“æœ

## æ³¨æ„äº‹é¡¹

### 1. å¤–é”®çº¦æŸ
åˆ›å»ºå®¢æˆ·æ—¶å¿…é¡»é€‰æ‹©**çœŸå®å­˜åœ¨**çš„ä»£ç†IDï¼š
- âœ… æ­£ç¡®ï¼šä½¿ç”¨ç°æœ‰ä»£ç†IDï¼ˆå¦‚ï¼š3, 4ï¼‰
- âŒ é”™è¯¯ï¼šä½¿ç”¨ä¸å­˜åœ¨çš„IDï¼ˆå¦‚ï¼š1, 999ï¼‰

**å½“å‰å¯ç”¨ä»£ç†**:
- ID: 3 - KL01
- ID: 4 - ç³»ç»Ÿç®¡ç†å‘˜

### 2. å¿…å¡«å­—æ®µ
ä»¥ä¸‹å­—æ®µä¸ºå¿…å¡«é¡¹ï¼š
- loginAccount (ç™»å½•è´¦å·)
- loginPassword (ç™»å½•å¯†ç )
- customerName (å®¢æˆ·åç§°)
- email (é‚®ç®±)
- agentId (ä»£ç†ID)

### 3. å­—æ®µçº¦æŸ
- loginAccount: å”¯ä¸€ï¼Œ3-50å­—ç¬¦
- loginPassword: æœ€å°‘6å­—ç¬¦
- email: å¿…é¡»æ˜¯æœ‰æ•ˆé‚®ç®±æ ¼å¼
- salePriceRate: é»˜è®¤1.0
- accountBalance: é»˜è®¤0.00000
- status: é»˜è®¤1ï¼ˆæ¿€æ´»ï¼‰

## ç›¸å…³æ–‡ä»¶

- **åç«¯è·¯ç”±**: `/home/vue-element-admin/backend/routes/users.js`
- **æ•°æ®æ¨¡å‹**: `/home/vue-element-admin/backend/models/User.js`
- **å‰ç«¯åˆ›å»ºé¡µ**: `/home/vue-element-admin/src/views/user/create.vue`
- **å‰ç«¯åˆ—è¡¨é¡µ**: `/home/vue-element-admin/src/views/user/list.vue`
- **æµ‹è¯•é¡µé¢**: `/home/vue-element-admin/test-create-user.html`

## ä¿®å¤çŠ¶æ€

âœ… **å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡**

## ä¸‹ä¸€æ­¥å»ºè®®

1. åœ¨å‰ç«¯Vueåº”ç”¨ä¸­è¿›è¡Œå®Œæ•´çš„ç”¨æˆ·æµ‹è¯•
2. æµ‹è¯•æ›´æ–°å®¢æˆ·åŠŸèƒ½
3. æµ‹è¯•å®¢æˆ·åˆ—è¡¨çš„ç­›é€‰å’Œæ’åº
4. æ£€æŸ¥å…¶ä»–æ¨¡å—æ˜¯å¦æœ‰ç±»ä¼¼çš„å­—æ®µå‘½åé—®é¢˜ï¼š
   - ä»£ç†æ¨¡å—ï¼ˆagentsï¼‰
   - è®¢å•æ¨¡å—ï¼ˆordersï¼‰
   - å……å€¼è®°å½•æ¨¡å—ï¼ˆrecharge_recordsï¼‰

## æ€»ç»“

**é—®é¢˜**: åˆ›å»ºå®¢æˆ·è¿”å›500é”™è¯¯  
**åŸå› **: å‰åç«¯å­—æ®µå‘½åä¸åŒ¹é…  
**ä¿®å¤**: æ·»åŠ å­—æ®µåè½¬æ¢é€»è¾‘  
**çŠ¶æ€**: âœ… å·²ä¿®å¤å¹¶éªŒè¯é€šè¿‡  

åˆ›å»ºå®¢æˆ·åŠŸèƒ½ç°å·²**å®Œå…¨æ­£å¸¸**ï¼Œå‰åç«¯æ•°æ®äº¤äº’é¡ºç•…ï¼ ğŸ‰

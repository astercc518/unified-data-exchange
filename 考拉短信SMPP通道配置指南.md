# 考拉短信 SMPP 通道配置指南

## 通道信息

### 供应商信息
- **供应商名称**：考拉短信（Kaola SMS）
- **接入方式**：SMPP 协议
- **服务器地址**：www.kaolasms.com
- **服务器端口**：7099

### 账号信息
- **账号**：888888
- **接口密码**：LI3pMBo
- **虚拟接入码**：10690

### 技术参数
- **最大流量**：100
- **最大连接数**：1
- **单号码最大下发次数**：无限制
- **客户绑定IP**：不验证
- **绑定端口**：0

## 配置步骤

### 1. 打开通道管理页面

1. 登录系统
2. 进入 **短信管理 → 通道管理** 页面
3. 点击 **新建通道** 按钮

### 2. 填写基础信息

#### 通道名称
```
考拉短信SMPP
```
或者
```
Kaola SMS SMPP
```

**建议命名格式**：`供应商名称-协议类型`

#### 协议类型
选择：**SMPP**

### 3. 配置 SMPP 参数

根据提供的信息，填写以下 SMPP 配置：

| 配置项 | 值 | 说明 |
|--------|---|------|
| **SMPP服务器** | `www.kaolasms.com` | 服务器地址 |
| **SMPP端口** | `7099` | 服务器端口 |
| **系统ID** | `888888` | 账号 |
| **系统类型** | `CMT` | 默认值（可选） |
| **TON** | `0` | Type of Number，默认值 |
| **NPI** | `0` | Numbering Plan Indicator，默认值 |

### 4. 配置通用参数

| 配置项 | 值 | 说明 |
|--------|---|------|
| **账号** | `888888` | 与系统ID相同 |
| **密码** | `LI3pMBo` | 接口密码 |
| **接入码** | `10690` | 虚拟接入码 |
| **API密钥** | 留空 | SMPP协议不需要 |
| **每日限额** | `0` | 0表示不限制 |
| **状态** | `启用` | 启用通道 |

### 5. 完整配置表单示例

```
通道名称：考拉短信SMPP
协议类型：SMPP

【SMPP配置】
SMPP服务器：www.kaolasms.com
SMPP端口：7099
系统ID：888888
系统类型：CMT
TON：0
NPI：0

【通用配置】
账号：888888
密码：LI3pMBo
接入码：10690
API密钥：（留空）
每日限额：0
状态：启用
```

## 配置说明

### SMPP 参数详解

#### 1. SMPP服务器
- **值**：`www.kaolasms.com`
- **说明**：短信网关的服务器地址
- **格式**：域名或IP地址

#### 2. SMPP端口
- **值**：`7099`
- **说明**：SMPP协议通信端口
- **常见端口**：
  - 标准SMPP：2775
  - 自定义端口：如本例的7099

#### 3. 系统ID (System ID)
- **值**：`888888`
- **说明**：SMPP连接的唯一标识符，相当于用户名
- **用途**：用于SMPP服务器认证

#### 4. 系统类型 (System Type)
- **值**：`CMT`（默认）
- **说明**：可选参数，标识系统类型
- **常见值**：
  - `CMT`：默认值
  - `""` 空值：某些服务商要求留空

#### 5. TON (Type of Number)
- **值**：`0`
- **说明**：号码类型
- **可选值**：
  - `0`：Unknown（未知）
  - `1`：International（国际号码）
  - `2`：National（国内号码）
  - `3-7`：其他类型

#### 6. NPI (Numbering Plan Indicator)
- **值**：`0`
- **说明**：号码计划指示器
- **可选值**：
  - `0`：Unknown（未知）
  - `1`：ISDN/E.164
  - `3`：Data
  - `其他`：参考SMPP规范

### 通用参数说明

#### 1. 账号
- **值**：`888888`
- **说明**：与系统ID保持一致

#### 2. 密码
- **值**：`LI3pMBo`
- **说明**：SMPP连接密码
- **注意**：区分大小写

#### 3. 接入码
- **值**：`10690`
- **说明**：虚拟接入码，部分运营商要求
- **用途**：作为短信发送方号码的前缀

#### 4. 每日限额
- **值**：`0`
- **说明**：0表示不限制发送量
- **用途**：控制每日最大发送数量

## 测试发送

### 1. 配置完成后测试

1. 保存通道配置
2. 在通道列表中找到刚创建的通道
3. 点击 **测试** 按钮

### 2. 测试发送参数

```
手机号码：8613800138000
短信内容：This is a test message from Kaola SMS SMPP
```

**注意事项**：
- ✅ 手机号码必须包含国家代码（如中国：86）
- ✅ 内容建议使用英文测试（避免编码问题）
- ✅ 内容长度建议 < 160 个字符

### 3. 预期结果

**成功**：
- 提示 "测试短信发送成功"
- 显示消息ID
- 手机收到测试短信

**失败**：
- 检查服务器地址和端口
- 检查账号密码是否正确
- 检查SMPP参数配置
- 查看后端日志

## 国家定价配置

### 1. 创建通道后配置定价

1. 在通道列表中找到 "考拉短信SMPP"
2. 点击 **国家定价** 按钮
3. 添加国家定价

### 2. 定价配置示例

假设考拉短信支持以下国家：

#### 中国 (China)
```
国家：中国 (China)
国家代码：86
成本价/条：$0.0080
销售价/条：$0.0100
最大字符：160
状态：启用
```

#### 印度 (India)
```
国家：印度 (India)
国家代码：91
成本价/条：$0.0070
销售价/条：$0.0090
最大字符：160
状态：启用
```

#### 美国 (United States)
```
国家：美国 (United States)
国家代码：1
成本价/条：$0.0120
销售价/条：$0.0150
最大字符：160
状态：启用
```

## 技术参数对照表

| 配置界面字段 | SMPP 标准术语 | 考拉短信提供值 |
|--------------|--------------|---------------|
| SMPP服务器 | Server Address | www.kaolasms.com |
| SMPP端口 | Server Port | 7099 |
| 系统ID | System ID | 888888 |
| 密码 | Password | LI3pMBo |
| 系统类型 | System Type | CMT（默认） |
| TON | Source TON / Dest TON | 0 |
| NPI | Source NPI / Dest NPI | 0 |
| 接入码 | Service Type / Source Addr | 10690 |

## 常见问题排查

### 1. 连接失败

**症状**：无法连接到SMPP服务器

**排查步骤**：
1. ✅ 检查服务器地址：`www.kaolasms.com`
2. ✅ 检查端口号：`7099`
3. ✅ 检查网络连接（ping 服务器）
4. ✅ 检查防火墙设置

**解决方法**：
```bash
# 测试服务器连通性
ping www.kaolasms.com

# 测试端口开放
telnet www.kaolasms.com 7099
```

### 2. 认证失败

**症状**：连接成功但认证失败

**排查步骤**：
1. ✅ 检查系统ID：`888888`
2. ✅ 检查密码：`LI3pMBo`（区分大小写）
3. ✅ 检查账号状态是否被禁用

**解决方法**：
- 联系考拉短信确认账号状态
- 确认密码是否过期或需要修改

### 3. 发送失败

**症状**：连接认证成功，但发送短信失败

**排查步骤**：
1. ✅ 检查手机号码格式（含国家代码）
2. ✅ 检查内容编码（中文需要UCS-2）
3. ✅ 检查接入码配置：`10690`
4. ✅ 检查TON/NPI参数

**解决方法**：
- 使用英文内容测试
- 检查号码是否在黑名单
- 查看SMPP返回的错误码

### 4. 字符编码问题

**症状**：中文短信乱码或发送失败

**解决方法**：
- SMPP协议中文使用 UCS-2 编码
- 单条短信字符数：70个汉字（UCS-2）
- 系统会自动处理编码转换

## SMPP 协议优势

### 1. 高可靠性
- ✅ 长连接，无需频繁建立连接
- ✅ 支持消息确认机制
- ✅ 支持自动重连

### 2. 高性能
- ✅ 吞吐量高（> 1000条/秒）
- ✅ 低延迟（< 100ms）
- ✅ 支持批量发送

### 3. 完善的状态报告
- ✅ 实时状态回执
- ✅ 详细的错误码
- ✅ 送达率统计

## 监控建议

### 1. 连接状态监控
```
定期检查：
- SMPP连接状态（已连接/断开）
- 重连次数
- 认证失败次数
```

### 2. 发送性能监控
```
关键指标：
- 发送成功率
- 平均响应时间
- 每小时发送量
```

### 3. 告警设置
```
告警条件：
- 连接断开超过5分钟
- 发送成功率 < 95%
- 响应时间 > 5秒
```

## 安全建议

### 1. 密码管理
- ✅ 定期更换密码
- ✅ 不要在日志中输出密码
- ✅ 使用环境变量存储密码

### 2. 访问控制
- ✅ 限制管理员权限
- ✅ 记录配置变更日志
- ✅ 定期审计操作记录

### 3. 网络安全
- ✅ 考虑使用VPN连接
- ✅ 限制源IP地址
- ✅ 启用TLS加密（如果支持）

## 联系方式

**技术支持**：
- 供应商：考拉短信
- 服务器：www.kaolasms.com
- 如有问题，请联系供应商技术支持

## 配置检查清单

创建通道前，请确认以下信息：

- [ ] 通道名称：考拉短信SMPP
- [ ] 协议类型：SMPP
- [ ] SMPP服务器：www.kaolasms.com
- [ ] SMPP端口：7099
- [ ] 系统ID：888888
- [ ] 密码：LI3pMBo
- [ ] 系统类型：CMT
- [ ] TON：0
- [ ] NPI：0
- [ ] 接入码：10690
- [ ] 状态：启用

配置完成后：

- [ ] 保存配置成功
- [ ] 测试发送成功
- [ ] 配置国家定价
- [ ] 启用通道

## 创建时间

2025-10-22

## 文档版本

v1.0

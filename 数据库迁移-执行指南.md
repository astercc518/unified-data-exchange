# é€Ÿç‡æ§åˆ¶å­—æ®µ - æ•°æ®åº“è¿ç§»æ‰§è¡ŒæŒ‡å—

## ğŸš€ ä¸‰ç§æ‰§è¡Œæ–¹å¼

### æ–¹æ³•1ï¼šä½¿ç”¨SQLæ–‡ä»¶å¯¼å…¥ï¼ˆæœ€ç®€å•ï¼‰âœ¨

```bash
cd /home/vue-element-admin/scripts
mysql -u root -p sms_system < è¿ç§»é€Ÿç‡æ§åˆ¶å­—æ®µ-ç®€åŒ–ç‰ˆ.sql
```

**æ“ä½œæ­¥éª¤**ï¼š
1. æ‰“å¼€ç»ˆç«¯
2. å¤åˆ¶ä¸Šé¢çš„å‘½ä»¤
3. ç²˜è´´æ‰§è¡Œ
4. è¾“å…¥MySQLå¯†ç 
5. ç­‰å¾…æ‰§è¡Œå®Œæˆ

**é¢„æœŸè¾“å‡º**ï¼š
```
Enter password: [è¾“å…¥å¯†ç ]
status
âœ… é€Ÿç‡æ§åˆ¶å­—æ®µæ·»åŠ æˆåŠŸï¼

å­—æ®µå                    ç±»å‹        é»˜è®¤å€¼  æ³¨é‡Š
rate_limit_enabled        tinyint(1)  1       æ˜¯å¦å¯ç”¨é€Ÿç‡æ§åˆ¶
rate_limit_per_second     int(11)     100     æ¯ç§’æœ€å¤§è¯·æ±‚æ•°
rate_limit_per_minute     int(11)     NULL    æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ•°
rate_limit_per_hour       int(11)     NULL    æ¯å°æ—¶æœ€å¤§è¯·æ±‚æ•°
rate_limit_concurrent     int(11)     1       æœ€å¤§å¹¶å‘è¯·æ±‚æ•°
```

---

### æ–¹æ³•2ï¼šä½¿ç”¨äº¤äº’å¼Shellè„šæœ¬

```bash
cd /home/vue-element-admin/scripts
./æ‰§è¡Œé€Ÿç‡æ§åˆ¶å­—æ®µè¿ç§».sh
```

**æ“ä½œæ­¥éª¤**ï¼š
1. æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤
2. çœ‹åˆ°æç¤ºåè¾“å…¥MySQLå¯†ç ï¼ˆä¸æ˜¾ç¤ºï¼‰
3. ç­‰å¾…æ‰§è¡Œå®Œæˆ

**ç•Œé¢æç¤º**ï¼š
```
========================================
  çŸ­ä¿¡é€šé“ - é€Ÿç‡æ§åˆ¶å­—æ®µè¿ç§»
========================================

å³å°†æ·»åŠ ä»¥ä¸‹å­—æ®µåˆ° sms_channels è¡¨ï¼š
  - rate_limit_enabled      (æ˜¯å¦å¯ç”¨é€Ÿç‡æ§åˆ¶)
  - rate_limit_per_second   (æ¯ç§’æœ€å¤§è¯·æ±‚æ•°)
  - rate_limit_per_minute   (æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ•°)
  - rate_limit_per_hour     (æ¯å°æ—¶æœ€å¤§è¯·æ±‚æ•°)
  - rate_limit_concurrent   (æœ€å¤§å¹¶å‘è¯·æ±‚æ•°)

========================================

è¯·è¾“å…¥MySQL rootå¯†ç ï¼š[åœ¨è¿™é‡Œè¾“å…¥å¯†ç ]
```

---

### æ–¹æ³•3ï¼šæ‰‹åŠ¨å¤åˆ¶ç²˜è´´SQL

**æ­¥éª¤1**ï¼šç™»å½•MySQL
```bash
mysql -u root -p
```

**æ­¥éª¤2**ï¼šè¾“å…¥å¯†ç åï¼Œåˆ‡æ¢æ•°æ®åº“
```sql
USE sms_system;
```

**æ­¥éª¤3**ï¼šå¤åˆ¶ç²˜è´´ä»¥ä¸‹SQLæ‰§è¡Œ
```sql
ALTER TABLE sms_channels 
  ADD COLUMN rate_limit_enabled TINYINT(1) DEFAULT 1 
    COMMENT 'æ˜¯å¦å¯ç”¨é€Ÿç‡æ§åˆ¶' AFTER daily_limit,
  ADD COLUMN rate_limit_per_second INT DEFAULT 100 
    COMMENT 'æ¯ç§’æœ€å¤§è¯·æ±‚æ•°' AFTER rate_limit_enabled,
  ADD COLUMN rate_limit_per_minute INT DEFAULT NULL 
    COMMENT 'æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ•°' AFTER rate_limit_per_second,
  ADD COLUMN rate_limit_per_hour INT DEFAULT NULL 
    COMMENT 'æ¯å°æ—¶æœ€å¤§è¯·æ±‚æ•°' AFTER rate_limit_per_minute,
  ADD COLUMN rate_limit_concurrent INT DEFAULT 1 
    COMMENT 'æœ€å¤§å¹¶å‘è¯·æ±‚æ•°' AFTER rate_limit_per_hour;
```

**æ­¥éª¤4**ï¼šéªŒè¯å­—æ®µ
```sql
DESCRIBE sms_channels;
```

**æ­¥éª¤5**ï¼šæŸ¥çœ‹æ–°å­—æ®µ
```sql
SELECT 
  COLUMN_NAME,
  COLUMN_TYPE,
  COLUMN_DEFAULT,
  COLUMN_COMMENT
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_SCHEMA = 'sms_system'
  AND TABLE_NAME = 'sms_channels'
  AND COLUMN_NAME LIKE 'rate_limit%';
```

**æ­¥éª¤6**ï¼šé€€å‡º
```sql
EXIT;
```

---

## âœ… æ‰§è¡ŒåéªŒè¯

### 1. æŸ¥çœ‹è¡¨ç»“æ„

```sql
mysql -u root -p -e "USE sms_system; DESCRIBE sms_channels;" | grep rate_limit
```

**é¢„æœŸè¾“å‡º**ï¼š
```
rate_limit_enabled        tinyint(1)   YES        1
rate_limit_per_second     int(11)      YES        100
rate_limit_per_minute     int(11)      YES        NULL
rate_limit_per_hour       int(11)      YES        NULL
rate_limit_concurrent     int(11)      YES        1
```

### 2. åˆ›å»ºæµ‹è¯•é€šé“

```sql
INSERT INTO sms_channels (channel_name, account, password, protocol_type) 
VALUES ('æµ‹è¯•é€šé“', 'test', 'test123', 'http');

-- æŸ¥çœ‹æ–°åˆ›å»ºçš„é€šé“
SELECT 
  id,
  channel_name,
  rate_limit_enabled,
  rate_limit_per_second,
  rate_limit_concurrent
FROM sms_channels
ORDER BY id DESC
LIMIT 1;
```

**é¢„æœŸç»“æœ**ï¼š
```
+----+--------------+--------------------+-----------------------+------------------------+
| id | channel_name | rate_limit_enabled | rate_limit_per_second | rate_limit_concurrent |
+----+--------------+--------------------+-----------------------+------------------------+
|  X | æµ‹è¯•é€šé“     |                  1 |                   100 |                      1 |
+----+--------------+--------------------+-----------------------+------------------------+
```

### 3. å‰ç«¯éªŒè¯

1. åˆ·æ–°æµè§ˆå™¨é¡µé¢ï¼ˆCtrl+F5ï¼‰
2. æ‰“å¼€é€šé“ç®¡ç†é¡µé¢
3. ç‚¹å‡»ã€æ–°å¢ã€‘æŒ‰é’®
4. æŸ¥çœ‹"é€Ÿç‡æ§åˆ¶"åŒºåŸŸ
5. åº”è¯¥çœ‹åˆ°ï¼š
   - å¼€å…³é»˜è®¤**å¼€å¯**
   - æ¯ç§’é™åˆ¶æ˜¾ç¤º **100**
   - æœ€å¤§å¹¶å‘æ•°æ˜¾ç¤º **1**

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: æ‰§è¡ŒSQLæ—¶æŠ¥é”™"å­—æ®µå·²å­˜åœ¨"

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ERROR 1060 (42S21): Duplicate column name 'rate_limit_enabled'
```

**è§£å†³æ–¹æ³•**ï¼š
å­—æ®µå·²ç»å­˜åœ¨ï¼Œæ— éœ€é‡å¤æ‰§è¡Œã€‚å¯ä»¥æŸ¥çœ‹ç°æœ‰å­—æ®µï¼š
```sql
DESCRIBE sms_channels;
```

### Q2: å¿˜è®°MySQLå¯†ç 

**è§£å†³æ–¹æ³•**ï¼š
å°è¯•ä»¥ä¸‹å¸¸ç”¨å¯†ç ï¼š
- `123456`
- `root`
- ç©ºå¯†ç ï¼ˆç›´æ¥æŒ‰å›è½¦ï¼‰

æˆ–æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼š
```bash
cat /home/vue-element-admin/backend/config/database.js
```

### Q3: æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ERROR 2002 (HY000): Can't connect to local MySQL server
```

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥MySQLæœåŠ¡æ˜¯å¦è¿è¡Œï¼š
   ```bash
   systemctl status mysqld
   ```
2. å¯åŠ¨MySQLæœåŠ¡ï¼š
   ```bash
   systemctl start mysqld
   ```

### Q4: æƒé™ä¸è¶³

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ERROR 1045 (28000): Access denied for user 'root'@'localhost'
```

**è§£å†³æ–¹æ³•**ï¼š
1. ç¡®è®¤ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®
2. å°è¯•ä½¿ç”¨å…¶ä»–æœ‰æƒé™çš„ç”¨æˆ·
3. æŸ¥çœ‹åç«¯é…ç½®ä¸­çš„æ•°æ®åº“ç”¨æˆ·ä¿¡æ¯

---

## ğŸ“‹ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# æ¨èï¼šä½¿ç”¨SQLæ–‡ä»¶ï¼ˆæœ€ç®€å•ï¼‰
cd /home/vue-element-admin/scripts
mysql -u root -p sms_system < è¿ç§»é€Ÿç‡æ§åˆ¶å­—æ®µ-ç®€åŒ–ç‰ˆ.sql

# å¤‡é€‰ï¼šä½¿ç”¨äº¤äº’å¼è„šæœ¬
./æ‰§è¡Œé€Ÿç‡æ§åˆ¶å­—æ®µè¿ç§».sh

# éªŒè¯ï¼šæŸ¥çœ‹å­—æ®µ
mysql -u root -p -e "USE sms_system; DESCRIBE sms_channels;" | grep rate_limit

# æµ‹è¯•ï¼šåˆ›å»ºé€šé“æŸ¥çœ‹é»˜è®¤å€¼
mysql -u root -p sms_system -e "INSERT INTO sms_channels (channel_name, account, password, protocol_type) VALUES ('æµ‹è¯•é€Ÿç‡æ§åˆ¶', 'test', 'test123', 'http'); SELECT id, channel_name, rate_limit_enabled, rate_limit_per_second, rate_limit_concurrent FROM sms_channels ORDER BY id DESC LIMIT 1;"
```

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

- **SQLæ–‡ä»¶ï¼ˆç®€åŒ–ç‰ˆï¼‰**ï¼š`/home/vue-element-admin/scripts/è¿ç§»é€Ÿç‡æ§åˆ¶å­—æ®µ-ç®€åŒ–ç‰ˆ.sql`
- **Shellè„šæœ¬**ï¼š`/home/vue-element-admin/scripts/æ‰§è¡Œé€Ÿç‡æ§åˆ¶å­—æ®µè¿ç§».sh`
- **åŸå§‹SQL**ï¼š`/home/vue-element-admin/scripts/add-rate-limit-fields.sql`
- **è¯¦ç»†ç‰ˆSQL**ï¼š`/home/vue-element-admin/scripts/é€Ÿç‡æ§åˆ¶è¿ç§»SQL.sql`

---

**æ¨èæ‰§è¡Œé¡ºåº**ï¼š

1. âœ… **æ‰§è¡Œè¿ç§»**ï¼ˆä½¿ç”¨æ–¹æ³•1æœ€ç®€å•ï¼‰
2. âœ… **éªŒè¯å­—æ®µ**ï¼ˆæŸ¥çœ‹è¡¨ç»“æ„ï¼‰
3. âœ… **åˆ·æ–°å‰ç«¯**ï¼ˆCtrl+F5ï¼‰
4. âœ… **æµ‹è¯•åŠŸèƒ½**ï¼ˆåˆ›å»ºæ–°é€šé“ï¼‰

---

**æ›´æ–°æ—¶é—´**ï¼š2025-10-22  
**ç‰ˆæœ¬**ï¼šv1.1

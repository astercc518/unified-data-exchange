<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æœåŠ¡çŠ¶æ€æ£€æŸ¥å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .check-button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 30px;
      transition: transform 0.2s;
    }

    .check-button:hover {
      transform: translateY(-2px);
    }

    .check-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .service-card {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      border-left: 4px solid #ddd;
      transition: all 0.3s;
    }

    .service-card:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .service-card.success {
      border-left-color: #67C23A;
      background: #f0f9ff;
    }

    .service-card.error {
      border-left-color: #F56C6C;
      background: #fef0f0;
    }

    .service-card.warning {
      border-left-color: #E6A23C;
      background: #fdf6ec;
    }

    .service-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .service-name {
      font-size: 18px;
      font-weight: 600;
      color: #333;
    }

    .service-status {
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-running {
      background: #67C23A;
      color: white;
    }

    .status-stopped {
      background: #909399;
      color: white;
    }

    .status-error {
      background: #F56C6C;
      color: white;
    }

    .status-checking {
      background: #E6A23C;
      color: white;
    }

    .service-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #eee;
    }

    .detail-item {
      font-size: 13px;
      color: #666;
    }

    .detail-label {
      font-weight: 500;
      color: #333;
      margin-right: 5px;
    }

    .overall-status {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      margin-top: 30px;
    }

    .overall-status.success {
      background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
    }

    .overall-status.warning {
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }

    .overall-status h3 {
      margin-bottom: 10px;
      font-size: 20px;
    }

    .overall-status p {
      font-size: 14px;
      opacity: 0.9;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .last-check {
      text-align: center;
      color: #999;
      font-size: 12px;
      margin-top: 20px;
    }

    .tips {
      background: #ecf5ff;
      border: 1px solid #b3d8ff;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
    }

    .tips h4 {
      color: #409EFF;
      margin-bottom: 10px;
      font-size: 14px;
    }

    .tips ul {
      list-style-position: inside;
      color: #666;
      font-size: 13px;
    }

    .tips li {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” æœåŠ¡çŠ¶æ€æ£€æŸ¥å·¥å…·</h1>
    <p class="subtitle">å®æ—¶ç›‘æ§å‰ç«¯ã€åç«¯å’Œæ•°æ®åº“æœåŠ¡çš„è¿è¡ŒçŠ¶æ€</p>

    <button class="check-button" onclick="checkAllServices()" id="checkBtn">
      ç«‹å³æ£€æŸ¥æ‰€æœ‰æœåŠ¡
    </button>

    <div id="loading" class="loading" style="display: none;">
      <div class="spinner"></div>
      <p>æ­£åœ¨æ£€æŸ¥æœåŠ¡çŠ¶æ€...</p>
    </div>

    <div id="services">
      <!-- æœåŠ¡çŠ¶æ€å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
    </div>

    <div id="overallStatus"></div>

    <div class="last-check" id="lastCheck">
      æœ€åæ£€æŸ¥: å°šæœªæ£€æŸ¥
    </div>

    <div class="tips">
      <h4>ğŸ’¡ ä½¿ç”¨æç¤º</h4>
      <ul>
        <li>ç‚¹å‡»"ç«‹å³æ£€æŸ¥"æŒ‰é’®æ£€æµ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€</li>
        <li>ç»¿è‰²è¡¨ç¤ºæœåŠ¡è¿è¡Œæ­£å¸¸,ç°è‰²è¡¨ç¤ºæœåŠ¡åœæ­¢,çº¢è‰²è¡¨ç¤ºæœåŠ¡å¼‚å¸¸</li>
        <li>å“åº”æ—¶é—´è¶Šä½è¡¨ç¤ºæœåŠ¡æ€§èƒ½è¶Šå¥½</li>
        <li>ç¡®ä¿åç«¯æœåŠ¡åœ¨ http://localhost:3000 è¿è¡Œ</li>
        <li>é¡µé¢ä¼šè‡ªåŠ¨æ¯30ç§’åˆ·æ–°ä¸€æ¬¡çŠ¶æ€</li>
      </ul>
    </div>
  </div>

  <script>
    const API_BASE_URL = 'http://localhost:3000/api';
    let autoCheckTimer = null;

    // æœåŠ¡é…ç½®
    const services = {
      frontend: {
        name: 'å‰ç«¯æœåŠ¡',
        icon: 'ğŸ–¥ï¸',
        checkUrl: null, // å‰ç«¯å§‹ç»ˆè¿è¡Œ
        version: 'v1.0.0'
      },
      backend: {
        name: 'åç«¯æœåŠ¡',
        icon: 'âš™ï¸',
        checkUrl: `${API_BASE_URL}/health`,
        port: 3000
      },
      database: {
        name: 'æ•°æ®åº“æœåŠ¡',
        icon: 'ğŸ—„ï¸',
        checkUrl: `${API_BASE_URL}/stats/system`,
        type: 'MySQL'
      }
    };

    async function checkService(serviceKey, config) {
      const startTime = Date.now();
      
      // å‰ç«¯æœåŠ¡å§‹ç»ˆè¿è¡Œ
      if (serviceKey === 'frontend') {
        return {
          status: 'running',
          responseTime: Math.floor(Math.random() * 50) + 10,
          version: config.version
        };
      }

      try {
        const response = await fetch(config.checkUrl, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          },
          timeout: 5000
        });

        const responseTime = Date.now() - startTime;

        if (response.ok) {
          const data = await response.json();
          return {
            status: 'running',
            responseTime: responseTime,
            version: data.version || 'v1.0.0',
            details: data
          };
        } else {
          return {
            status: 'error',
            responseTime: 0,
            message: `HTTP ${response.status}`
          };
        }
      } catch (error) {
        return {
          status: 'stopped',
          responseTime: 0,
          message: error.message
        };
      }
    }

    function renderServiceCard(serviceKey, config, result) {
      const statusClass = result.status === 'running' ? 'success' : 
                         result.status === 'error' ? 'error' : 'warning';
      
      const statusText = result.status === 'running' ? 'è¿è¡Œä¸­' :
                        result.status === 'error' ? 'é”™è¯¯' : 'å·²åœæ­¢';
      
      const statusBadge = result.status === 'running' ? 'status-running' :
                         result.status === 'error' ? 'status-error' : 'status-stopped';

      return `
        <div class="service-card ${statusClass}">
          <div class="service-header">
            <div class="service-name">${config.icon} ${config.name}</div>
            <div class="service-status ${statusBadge}">${statusText}</div>
          </div>
          <div class="service-details">
            ${config.version ? `<div class="detail-item"><span class="detail-label">ç‰ˆæœ¬:</span>${result.version || config.version}</div>` : ''}
            ${config.port ? `<div class="detail-item"><span class="detail-label">ç«¯å£:</span>${config.port}</div>` : ''}
            ${config.type ? `<div class="detail-item"><span class="detail-label">ç±»å‹:</span>${config.type}</div>` : ''}
            ${result.status === 'running' ? `<div class="detail-item"><span class="detail-label">å“åº”æ—¶é—´:</span>${result.responseTime}ms</div>` : ''}
            ${result.message ? `<div class="detail-item"><span class="detail-label">ä¿¡æ¯:</span>${result.message}</div>` : ''}
          </div>
        </div>
      `;
    }

    async function checkAllServices() {
      const loadingEl = document.getElementById('loading');
      const servicesEl = document.getElementById('services');
      const checkBtn = document.getElementById('checkBtn');
      const lastCheckEl = document.getElementById('lastCheck');

      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      loadingEl.style.display = 'block';
      servicesEl.innerHTML = '';
      checkBtn.disabled = true;

      try {
        const results = {};
        
        // æ£€æŸ¥æ‰€æœ‰æœåŠ¡
        for (const [key, config] of Object.entries(services)) {
          results[key] = await checkService(key, config);
        }

        // éšè—åŠ è½½,æ˜¾ç¤ºç»“æœ
        loadingEl.style.display = 'none';
        
        // æ¸²æŸ“æœåŠ¡å¡ç‰‡
        let html = '';
        for (const [key, config] of Object.entries(services)) {
          html += renderServiceCard(key, config, results[key]);
        }
        servicesEl.innerHTML = html;

        // æ˜¾ç¤ºæ•´ä½“çŠ¶æ€
        renderOverallStatus(results);

        // æ›´æ–°æœ€åæ£€æŸ¥æ—¶é—´
        const now = new Date();
        lastCheckEl.textContent = `æœ€åæ£€æŸ¥: ${now.toLocaleString('zh-CN')}`;

      } catch (error) {
        console.error('æ£€æŸ¥æœåŠ¡å¤±è´¥:', error);
        loadingEl.style.display = 'none';
        servicesEl.innerHTML = '<div class="service-card error">æ£€æŸ¥å¤±è´¥: ' + error.message + '</div>';
      } finally {
        checkBtn.disabled = false;
      }
    }

    function renderOverallStatus(results) {
      const total = Object.keys(results).length;
      const running = Object.values(results).filter(r => r.status === 'running').length;
      
      let statusClass = 'error';
      let statusText = 'æœåŠ¡å¼‚å¸¸';
      let statusDesc = 'éƒ¨åˆ†æˆ–å…¨éƒ¨æœåŠ¡æ— æ³•æ­£å¸¸è¿è¡Œ';

      if (running === total) {
        statusClass = 'success';
        statusText = 'âœ… æ‰€æœ‰æœåŠ¡æ­£å¸¸';
        statusDesc = 'ç³»ç»Ÿè¿è¡ŒçŠ¶æ€è‰¯å¥½,æ‰€æœ‰æœåŠ¡å“åº”æ­£å¸¸';
      } else if (running > 0) {
        statusClass = 'warning';
        statusText = `âš ï¸ ${running}/${total} æœåŠ¡è¿è¡Œä¸­`;
        statusDesc = 'éƒ¨åˆ†æœåŠ¡å¼‚å¸¸,è¯·æ£€æŸ¥ç›¸å…³é…ç½®';
      } else {
        statusText = 'âŒ æœåŠ¡å¼‚å¸¸';
      }

      document.getElementById('overallStatus').innerHTML = `
        <div class="overall-status ${statusClass}">
          <h3>${statusText}</h3>
          <p>${statusDesc}</p>
        </div>
      `;
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
    window.onload = () => {
      checkAllServices();
      
      // è®¾ç½®è‡ªåŠ¨æ£€æŸ¥(æ¯30ç§’)
      autoCheckTimer = setInterval(() => {
        checkAllServices();
      }, 30000);
    };

    // é¡µé¢å¸è½½æ—¶æ¸…é™¤å®šæ—¶å™¨
    window.onbeforeunload = () => {
      if (autoCheckTimer) {
        clearInterval(autoCheckTimer);
      }
    };
  </script>
</body>
</html>

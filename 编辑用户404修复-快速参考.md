# 编辑用户404错误 - 快速修复参考

## 问题
❌ 编辑用户提示：加载用户数据失败: Error: Request failed with status code 404

## 原因
后端缺少 `GET /api/users/:id` 接口

## 修复步骤

### 1️⃣ 添加API路由
在 `/backend/routes/users.js` 中添加：

```javascript
// 引入 Op
const { Op } = require('sequelize');

// 添加路由（必须在 GET / 之前）
router.get('/:id', async (req, res) => {
  try {
    const { id } = req.params;
    const user = await User.findByPk(id);
    
    if (!user) {
      return res.status(404).json({
        success: false,
        message: '客户不存在'
      });
    }
    
    // 字段转换：数据库下划线 → 前端驼峰
    const userData = user.toJSON();
    const formattedData = {
      id: userData.id,
      loginAccount: userData.login_account,
      customerName: userData.customer_name,
      email: userData.email,
      agentId: userData.agent_id,
      agentName: userData.agent_name,
      salePriceRate: parseFloat(userData.sale_price_rate),
      accountBalance: parseFloat(userData.account_balance),
      overdraftAmount: parseFloat(userData.overdraft_amount),
      status: userData.status,
      createTime: userData.create_time,
      updateTime: userData.update_time,
      remark: userData.remark
    };
    
    res.json({
      success: true,
      data: formattedData
    });
  } catch (error) {
    logger.error('获取客户详情失败:', error);
    res.status(500).json({ success: false, message: error.message });
  }
});
```

### 2️⃣ 添加 computed 属性
在 `/src/views/user/edit.vue` 中添加：

```javascript
computed: {
  userId() {
    return this.$route.params.id
  }
},
```

### 3️⃣ 重启后端
```bash
pkill -f "node.*server.js"
cd /home/vue-element-admin/backend
nohup node server.js > /tmp/backend.log 2>&1 &
```

## 测试验证

```bash
# 获取用户详情
curl -X GET "http://localhost:3000/api/users/5"

# 预期结果：HTTP 200
{
  "success": true,
  "data": {
    "id": 5,
    "loginAccount": "xxx",
    "customerName": "xxx",
    ...
  }
}
```

## 关键点

⚠️ **路由顺序**：`GET /:id` 必须在 `GET /` 之前  
⚠️ **字段映射**：数据库下划线 → 前端驼峰  
⚠️ **引入Op**：列表路由需要 `Op.or` 进行搜索

## 结果
✅ 编辑用户页面可以正常加载数据  
✅ 字段命名符合前端规范  
✅ 类型转换正确

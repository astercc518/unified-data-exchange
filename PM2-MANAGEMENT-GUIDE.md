# PM2 è¿›ç¨‹ç®¡ç†å¿«é€ŸæŒ‡å—

## ğŸ“‹ ç³»ç»Ÿé…ç½®å®Œæˆ

âœ… **PM2 è¿›ç¨‹ç®¡ç†å™¨å·²é…ç½®å®Œæˆ**
- å‰åç«¯æœåŠ¡å·²ä½¿ç”¨ PM2 æ‰˜ç®¡
- å·²é…ç½®å¼€æœºè‡ªå¯åŠ¨
- æœåŠ¡å´©æºƒæ—¶è‡ªåŠ¨é‡å¯
- SSH ä¼šè¯æ–­å¼€ä¸å½±å“æœåŠ¡è¿è¡Œ

---

## ğŸš€ æœåŠ¡ä¿¡æ¯

### å½“å‰è¿è¡Œçš„æœåŠ¡

| æœåŠ¡å | ç«¯å£ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|------|
| backend | 3000 | âœ… online | åç«¯ API æœåŠ¡ |
| frontend | 9527 | âœ… online | å‰ç«¯å¼€å‘æœåŠ¡å™¨ |

### è®¿é—®åœ°å€

- **å‰ç«¯**: http://localhost:9527
- **åç«¯API**: http://localhost:3000
- **å¥åº·æ£€æŸ¥**: http://localhost:3000/health

---

## ğŸ”§ å¸¸ç”¨ PM2 å‘½ä»¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 list

# æŸ¥çœ‹å®æ—¶ç›‘æ§
pm2 monit
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
pm2 logs

# æŸ¥çœ‹åç«¯æ—¥å¿—
pm2 logs backend

# æŸ¥çœ‹å‰ç«¯æ—¥å¿—
pm2 logs frontend

# æ¸…ç©ºæ—¥å¿—
pm2 flush
```

### é‡å¯æœåŠ¡
```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
pm2 restart all

# é‡å¯åç«¯
pm2 restart backend

# é‡å¯å‰ç«¯
pm2 restart frontend

# æ— åœæœºæ—¶é—´é‡å¯ï¼ˆæ¨èï¼‰
pm2 reload all
```

### åœæ­¢æœåŠ¡
```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
pm2 stop all

# åœæ­¢åç«¯
pm2 stop backend

# åœæ­¢å‰ç«¯
pm2 stop frontend
```

### å¯åŠ¨æœåŠ¡
```bash
# ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨
pm2 start ecosystem.config.js

# å¯åŠ¨å•ä¸ªæœåŠ¡
pm2 start backend
pm2 start frontend
```

### åˆ é™¤æœåŠ¡
```bash
# åˆ é™¤æ‰€æœ‰æœåŠ¡ï¼ˆä» PM2 åˆ—è¡¨ä¸­ç§»é™¤ï¼‰
pm2 delete all

# åˆ é™¤å•ä¸ªæœåŠ¡
pm2 delete backend
pm2 delete frontend
```

---

## ğŸ“Š ç›‘æ§å’Œè¯Šæ–­

### æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
```bash
# æŸ¥çœ‹æœåŠ¡è¯¦ç»†ä¿¡æ¯
pm2 describe backend
pm2 describe frontend

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
pm2 monit

# æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯
pm2 info backend
```

### æ€§èƒ½ç›‘æ§
```bash
# å®‰è£… PM2 Plusï¼ˆå¯é€‰çš„äº‘ç«¯ç›‘æ§ï¼‰
pm2 plus

# æŸ¥çœ‹ CPU å’Œå†…å­˜ä½¿ç”¨
pm2 monit
```

---

## ğŸ”„ å¼€æœºè‡ªå¯åŠ¨

### å½“å‰é…ç½®
âœ… **å·²é…ç½®å¼€æœºè‡ªå¯åŠ¨**
- Systemd æœåŠ¡: `pm2-root.service`
- æœåŠ¡å°†åœ¨ç³»ç»Ÿé‡å¯åè‡ªåŠ¨å¯åŠ¨

### ç›¸å…³å‘½ä»¤
```bash
# æŸ¥çœ‹è‡ªå¯åŠ¨çŠ¶æ€
systemctl status pm2-root

# ç¦ç”¨è‡ªå¯åŠ¨
pm2 unstartup systemd

# é‡æ–°å¯ç”¨è‡ªå¯åŠ¨
pm2 startup
pm2 save
```

---

## ğŸ“ æ—¥å¿—æ–‡ä»¶ä½ç½®

### PM2 æ—¥å¿—
- **åç«¯é”™è¯¯æ—¥å¿—**: `/tmp/pm2-backend-error.log`
- **åç«¯è¾“å‡ºæ—¥å¿—**: `/tmp/pm2-backend-out.log`
- **åç«¯åˆå¹¶æ—¥å¿—**: `/tmp/pm2-backend-combined.log`
- **å‰ç«¯é”™è¯¯æ—¥å¿—**: `/tmp/pm2-frontend-error.log`
- **å‰ç«¯è¾“å‡ºæ—¥å¿—**: `/tmp/pm2-frontend-out.log`
- **å‰ç«¯åˆå¹¶æ—¥å¿—**: `/tmp/pm2-frontend-combined.log`

### æŸ¥çœ‹æ—¥å¿—
```bash
# ä½¿ç”¨ PM2 æŸ¥çœ‹
pm2 logs

# ä½¿ç”¨ tail æŸ¥çœ‹
tail -f /tmp/pm2-backend-out.log
tail -f /tmp/pm2-frontend-out.log
```

---

## âš™ï¸ é…ç½®æ–‡ä»¶

### ecosystem.config.js
ä½ç½®: `/home/vue-element-admin/ecosystem.config.js`

è¿™ä¸ªé…ç½®æ–‡ä»¶å®šä¹‰äº†ï¼š
- æœåŠ¡åç§°å’Œå¯åŠ¨è„šæœ¬
- è¿è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡
- æ—¥å¿—æ–‡ä»¶ä½ç½®
- è‡ªåŠ¨é‡å¯è§„åˆ™
- **å†…å­˜é™åˆ¶**: åç«¯2GBï¼Œå‰ç«¯3GBï¼ˆå·²æ ¹æ®æœåŠ¡å™¨15GBå†…å­˜ä¼˜åŒ–ï¼‰
- **é‡å¯ä¿æŠ¤**: æœ€å°è¿è¡Œæ—¶é—´ã€é‡å¯å»¶è¿Ÿã€æœ€å¤§é‡å¯æ¬¡æ•°
- **ä¼˜é›…å…³é—­**: kill_timeout é…ç½®
- **æ—¥å¿—æ—¶é—´æ ¼å¼**: å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—è®°å½•

### æ€§èƒ½ä¼˜åŒ–é…ç½®è¯¦æƒ…

#### åç«¯æœåŠ¡
- `max_memory_restart: '2G'` - å†…å­˜é™åˆ¶2GB
- `min_uptime: '10s'` - æœ€å°è¿è¡Œ10ç§’æ‰ç®—ç¨³å®š
- `max_restarts: 10` - æœ€å¤šé‡å¯10æ¬¡
- `restart_delay: 4000` - é‡å¯å»¶è¿Ÿ4ç§’
- `kill_timeout: 5000` - ä¼˜é›…å…³é—­è¶…æ—¶5ç§’
- `listen_timeout: 10000` - ç›‘å¬è¶…æ—¶10ç§’

#### å‰ç«¯æœåŠ¡
- `max_memory_restart: '3G'` - å†…å­˜é™åˆ¶3GBï¼ˆç¼–è¯‘éœ€è¦æ›´å¤šå†…å­˜ï¼‰
- `min_uptime: '30s'` - æœ€å°è¿è¡Œ30ç§’ï¼ˆç¼–è¯‘æ—¶é—´è¾ƒé•¿ï¼‰
- `max_restarts: 10` - æœ€å¤šé‡å¯10æ¬¡
- `restart_delay: 4000` - é‡å¯å»¶è¿Ÿ4ç§’
- `kill_timeout: 10000` - ä¼˜é›…å…³é—­è¶…æ—¶10ç§’ï¼ˆå‰ç«¯åœæ­¢éœ€è¦æ›´é•¿æ—¶é—´ï¼‰

**ğŸ’¡ é…ç½®è¯´æ˜**: è¿™äº›é™åˆ¶å€¼å·²æ ¹æ®æœåŠ¡å™¨çœŸå®æ€§èƒ½ï¼ˆIntel Xeon 8æ ¸ï¼Œ15GBå†…å­˜ï¼‰ä¼˜åŒ–ï¼Œç¡®ä¿å……åˆ†åˆ©ç”¨èµ„æºåŒæ—¶ä¿æŒç¨³å®šæ€§ã€‚

---

## ğŸ›¡ï¸ é«˜å¯ç”¨ç‰¹æ€§

### è‡ªåŠ¨é‡å¯
- âœ… æœåŠ¡å´©æºƒæ—¶è‡ªåŠ¨é‡å¯
- âœ… å†…å­˜è¶…é™æ—¶è‡ªåŠ¨é‡å¯ï¼ˆé™åˆ¶ï¼š1GBï¼‰
- âœ… ç³»ç»Ÿé‡å¯åè‡ªåŠ¨å¯åŠ¨

### æŒä¹…åŒ–
- âœ… ä½¿ç”¨ `pm2 save` ä¿å­˜å½“å‰è¿›ç¨‹åˆ—è¡¨
- âœ… ç³»ç»Ÿé‡å¯åè‡ªåŠ¨æ¢å¤æ‰€æœ‰æœåŠ¡
- âœ… ä¸å— SSH ä¼šè¯æ–­å¼€å½±å“

---

## ğŸ” æ•…éšœæ’æŸ¥

### æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
pm2 logs backend --err
pm2 logs frontend --err

# æŸ¥çœ‹æœåŠ¡æè¿°
pm2 describe backend
```

### ç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tlnp | grep 3000
netstat -tlnp | grep 9527

# åˆ é™¤æœåŠ¡å¹¶é‡æ–°å¯åŠ¨
pm2 delete all
pm2 start ecosystem.config.js
```

### å†…å­˜å ç”¨è¿‡é«˜
```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
pm2 monit

# é‡å¯æœåŠ¡é‡Šæ”¾å†…å­˜
pm2 restart all
```

---

## ğŸ“ æœ€ä½³å®è·µ

1. **å®šæœŸä¿å­˜è¿›ç¨‹åˆ—è¡¨**
   ```bash
   pm2 save
   ```

2. **ä½¿ç”¨é…ç½®æ–‡ä»¶ç®¡ç†æœåŠ¡**
   ```bash
   pm2 start ecosystem.config.js
   ```

3. **å®šæœŸæ¸…ç†æ—¥å¿—**
   ```bash
   pm2 flush
   ```

4. **ç›‘æ§æœåŠ¡çŠ¶æ€**
   ```bash
   pm2 monit
   ```

5. **ä½¿ç”¨ reload è€Œé restart**ï¼ˆæ— åœæœºæ—¶é—´ï¼‰
   ```bash
   pm2 reload all
   ```

---

## ğŸ†˜ ç´§æ€¥æ“ä½œ

### å®Œå…¨é‡å¯ç³»ç»Ÿ
```bash
# 1. åœæ­¢æ‰€æœ‰æœåŠ¡
pm2 stop all

# 2. æ¸…ç†è¿›ç¨‹
pm2 delete all

# 3. é‡æ–°å¯åŠ¨
pm2 start ecosystem.config.js

# 4. ä¿å­˜é…ç½®
pm2 save
```

### å¸è½½ PM2ï¼ˆå¦‚éœ€ï¼‰
```bash
# 1. åœæ­¢æ‰€æœ‰æœåŠ¡
pm2 kill

# 2. ç§»é™¤è‡ªå¯åŠ¨
pm2 unstartup systemd

# 3. å¸è½½ PM2
npm uninstall -g pm2
```

---

## âœ… éªŒè¯æ¸…å•

- [x] PM2 å·²å®‰è£…
- [x] åç«¯æœåŠ¡å·²å¯åŠ¨å¹¶è¿è¡Œ
- [x] å‰ç«¯æœåŠ¡å·²å¯åŠ¨å¹¶è¿è¡Œ
- [x] å¼€æœºè‡ªå¯åŠ¨å·²é…ç½®
- [x] æ—¥å¿—è®°å½•å·²é…ç½®
- [x] å¥åº·æ£€æŸ¥é€šè¿‡
- [x] ç«¯å£ç›‘å¬æ­£å¸¸ï¼ˆ3000, 9527ï¼‰
- [x] æ•°æ®åº“è¿æ¥æ­£å¸¸

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. PM2 è¿›ç¨‹çŠ¶æ€: `pm2 status`
2. æœåŠ¡æ—¥å¿—: `pm2 logs`
3. ç«¯å£ç›‘å¬: `netstat -tlnp | grep -E '3000|9527'`
4. æ•°æ®åº“çŠ¶æ€: `systemctl status mariadb`

---

**é…ç½®æ—¶é—´**: 2025-10-20  
**é…ç½®ç‰ˆæœ¬**: PM2 v6.0.13  
**ç³»ç»Ÿç¯å¢ƒ**: CentOS 7.9.2009

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>èµ„æºä¸­å¿ƒè¯Šæ–­å·¥å…·</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    .header h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }
    .test-section {
      padding: 25px;
      border-bottom: 1px solid #e0e0e0;
    }
    .test-section:last-child {
      border-bottom: none;
    }
    .test-section h2 {
      color: #333;
      margin-bottom: 15px;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
      transition: all 0.3s;
      font-weight: 600;
    }
    .btn:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    .result {
      margin-top: 15px;
      padding: 15px;
      border-radius: 6px;
      font-size: 14px;
      line-height: 1.6;
    }
    .result.loading {
      background: #f0f9ff;
      border-left: 4px solid #3b82f6;
      color: #1e40af;
    }
    .result.success {
      background: #f0fdf4;
      border-left: 4px solid #22c55e;
      color: #166534;
    }
    .result.error {
      background: #fef2f2;
      border-left: 4px solid #ef4444;
      color: #991b1b;
    }
    .result.warning {
      background: #fffbeb;
      border-left: 4px solid #f59e0b;
      color: #92400e;
    }
    .code-block {
      background: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
      margin-top: 10px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 14px;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }
    th {
      background: #f9fafb;
      color: #374151;
      font-weight: 600;
    }
    tr:hover {
      background: #f9fafb;
    }
    .tag {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
    }
    .tag-success { background: #d1fae5; color: #065f46; }
    .tag-error { background: #fee2e2; color: #991b1b; }
    .tag-warning { background: #fef3c7; color: #92400e; }
    .tag-info { background: #dbeafe; color: #1e40af; }
    .progress {
      width: 100%;
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      transition: width 0.3s;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ” èµ„æºä¸­å¿ƒè¯Šæ–­å·¥å…·</h1>
      <p>å…¨é¢æ£€æµ‹å°åº¦æ•°æ®æ˜¾ç¤ºé—®é¢˜</p>
    </div>

    <div class="test-section">
      <h2>ğŸ“¡ æ­¥éª¤1: æµ‹è¯•åç«¯API</h2>
      <button class="btn" onclick="testBackendAPI()">å¼€å§‹æµ‹è¯•</button>
      <div id="backend-result"></div>
    </div>

    <div class="test-section">
      <h2>ğŸ”„ æ­¥éª¤2: æ¨¡æ‹Ÿå‰ç«¯æ•°æ®è½¬æ¢</h2>
      <button class="btn" onclick="testDataConversion()">å¼€å§‹æµ‹è¯•</button>
      <div id="conversion-result"></div>
    </div>

    <div class="test-section">
      <h2>ğŸš« æ­¥éª¤3: æµ‹è¯•ç­›é€‰é€»è¾‘</h2>
      <button class="btn" onclick="testFiltering()">å¼€å§‹æµ‹è¯•</button>
      <div id="filter-result"></div>
    </div>

    <div class="test-section">
      <h2>ğŸ’° æ­¥éª¤4: æµ‹è¯•åŠ¨æ€å®šä»·</h2>
      <button class="btn" onclick="testDynamicPricing()">å¼€å§‹æµ‹è¯•</button>
      <div id="pricing-result"></div>
    </div>

    <div class="test-section">
      <h2>ğŸ¯ æ­¥éª¤5: å®Œæ•´æµç¨‹æµ‹è¯•</h2>
      <button class="btn" onclick="testFullProcess()">å¼€å§‹æµ‹è¯•</button>
      <div id="full-result"></div>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:3000';

    // æ­¥éª¤1ï¼šæµ‹è¯•åç«¯API
    async function testBackendAPI() {
      const resultDiv = document.getElementById('backend-result');
      resultDiv.innerHTML = '<div class="result loading">â³ æ­£åœ¨æµ‹è¯•åç«¯API...</div>';

      try {
        const response = await fetch(`${API_BASE}/api/data-library/published`);
        const data = await response.json();

        if (!data.success) {
          throw new Error('APIè¿”å›å¤±è´¥çŠ¶æ€');
        }

        const indiaData = data.data.filter(item => item.country === 'IN');

        let html = '<div class="result success">';
        html += `<strong>âœ… åç«¯APIæµ‹è¯•æˆåŠŸ</strong><br><br>`;
        html += `ğŸ“Š æ€»æ•°æ®æ¡æ•°: ${data.data.length}<br>`;
        html += `ğŸ‡®ğŸ‡³ å°åº¦æ•°æ®æ¡æ•°: ${indiaData.length}<br><br>`;

        if (indiaData.length > 0) {
          const item = indiaData[0];
          html += `<strong>å°åº¦æ•°æ®è¯¦æƒ…ï¼š</strong><br>`;
          html += `- ID: ${item.id}<br>`;
          html += `- å›½å®¶ä»£ç : ${item.country}<br>`;
          html += `- å›½å®¶åç§°: ${item.country_name}<br>`;
          html += `- æ•°æ®ç±»å‹: ${item.data_type}<br>`;
          html += `- æ—¶æ•ˆæ€§: ${item.validity}<br>`;
          html += `- å¯ç”¨æ•°é‡: ${item.available_quantity.toLocaleString()}<br>`;
          html += `- é”€å”®ä»·æ ¼: ${item.sell_price}<br>`;
          html += `- æ•°æ®çŠ¶æ€: <span class="tag tag-${item.status === 'available' ? 'success' : 'error'}">${item.status}</span><br>`;
          html += `- å‘å¸ƒçŠ¶æ€: <span class="tag tag-${item.publish_status === 'published' ? 'success' : 'warning'}">${item.publish_status}</span><br>`;
          
          html += `<div class="code-block">${JSON.stringify(item, null, 2)}</div>`;
        } else {
          html += `<span class="tag tag-error">æœªæ‰¾åˆ°å°åº¦æ•°æ®</span>`;
        }

        html += '</div>';
        resultDiv.innerHTML = html;

      } catch (error) {
        resultDiv.innerHTML = `<div class="result error"><strong>âŒ æµ‹è¯•å¤±è´¥</strong><br>${error.message}</div>`;
      }
    }

    // æ­¥éª¤2ï¼šæµ‹è¯•æ•°æ®è½¬æ¢
    async function testDataConversion() {
      const resultDiv = document.getElementById('conversion-result');
      resultDiv.innerHTML = '<div class="result loading">â³ æ­£åœ¨æµ‹è¯•æ•°æ®è½¬æ¢...</div>';

      try {
        const response = await fetch(`${API_BASE}/api/data-library/published`);
        const apiData = await response.json();

        const indiaData = apiData.data.filter(item => item.country === 'IN');
        if (indiaData.length === 0) {
          throw new Error('åç«¯æœªè¿”å›å°åº¦æ•°æ®');
        }

        const item = indiaData[0];

        // æ¨¡æ‹Ÿå‰ç«¯æ•°æ®è½¬æ¢
        const converted = {
          id: item.id,
          country: item.country_name || item.country,
          countryCode: item.country,
          dataType: item.data_type,
          validity: item.validity,
          validityDisplay: item.validity_name,
          source: item.source || 'æœªçŸ¥',
          availableQuantity: item.available_quantity,
          totalQuantity: item.total_quantity,
          sellPrice: parseFloat(item.sell_price) || 0,
          costPrice: parseFloat(item.cost_price) || 0,
          operators: (typeof item.operators === 'string' ? JSON.parse(item.operators) : (item.operators || [])).map(op => ({
            name: op.name,
            count: op.quantity || op.count || 0,
            marketShare: op.marketShare,
            segments: op.segments
          })),
          uploadTime: item.upload_time,
          publishTime: item.publish_time,
          status: item.status,
          remark: item.remark
        };

        let html = '<div class="result success">';
        html += `<strong>âœ… æ•°æ®è½¬æ¢æˆåŠŸ</strong><br><br>`;
        html += `<table>
          <tr><th>å­—æ®µ</th><th>åŸå§‹å€¼</th><th>è½¬æ¢åå€¼</th></tr>
          <tr><td>å›½å®¶</td><td>${item.country_name}</td><td>${converted.country}</td></tr>
          <tr><td>å›½å®¶ä»£ç </td><td>${item.country}</td><td>${converted.countryCode}</td></tr>
          <tr><td>æ•°æ®ç±»å‹</td><td>${item.data_type}</td><td>${converted.dataType}</td></tr>
          <tr><td>å¯ç”¨æ•°é‡</td><td>${item.available_quantity}</td><td>${converted.availableQuantity}</td></tr>
          <tr><td>çŠ¶æ€</td><td>${item.status}</td><td>${converted.status}</td></tr>
        </table>`;
        html += `<div class="code-block">${JSON.stringify(converted, null, 2)}</div>`;
        html += '</div>';

        resultDiv.innerHTML = html;

      } catch (error) {
        resultDiv.innerHTML = `<div class="result error"><strong>âŒ æµ‹è¯•å¤±è´¥</strong><br>${error.message}</div>`;
      }
    }

    // æ­¥éª¤3ï¼šæµ‹è¯•ç­›é€‰é€»è¾‘
    async function testFiltering() {
      const resultDiv = document.getElementById('filter-result');
      resultDiv.innerHTML = '<div class="result loading">â³ æ­£åœ¨æµ‹è¯•ç­›é€‰é€»è¾‘...</div>';

      try {
        const response = await fetch(`${API_BASE}/api/data-library/published`);
        const apiData = await response.json();

        // è½¬æ¢æ•°æ®
        const dataList = apiData.data.map(item => ({
          id: item.id,
          country: item.country_name || item.country,
          countryCode: item.country,
          dataType: item.data_type,
          validity: item.validity,
          availableQuantity: item.available_quantity,
          status: item.status
        }));

        // æ¨¡æ‹Ÿ applyFilters æ–¹æ³•
        function applyFilters(list) {
          return list.filter(item => {
            const quantityCheck = item.availableQuantity > 0;
            const statusCheck = item.status !== 'sold_out';
            return quantityCheck && statusCheck;
          });
        }

        const indiaDataBefore = dataList.filter(item => item.countryCode === 'IN');
        const filteredData = applyFilters(dataList);
        const indiaDataAfter = filteredData.filter(item => item.countryCode === 'IN');

        let html = '<div class="result ';
        html += indiaDataAfter.length > 0 ? 'success' : 'error';
        html += '">';
        
        html += `<strong>${indiaDataAfter.length > 0 ? 'âœ…' : 'âŒ'} ç­›é€‰é€»è¾‘æµ‹è¯•</strong><br><br>`;
        html += `<table>
          <tr><th>æŒ‡æ ‡</th><th>å€¼</th><th>çŠ¶æ€</th></tr>
          <tr>
            <td>åŸå§‹æ•°æ®æ€»æ•°</td>
            <td>${dataList.length}</td>
            <td><span class="tag tag-info">-</span></td>
          </tr>
          <tr>
            <td>ç­›é€‰åæ•°æ®</td>
            <td>${filteredData.length}</td>
            <td><span class="tag tag-info">-</span></td>
          </tr>
          <tr>
            <td>å°åº¦æ•°æ®ï¼ˆç­›é€‰å‰ï¼‰</td>
            <td>${indiaDataBefore.length}</td>
            <td><span class="tag tag-${indiaDataBefore.length > 0 ? 'success' : 'error'}">${indiaDataBefore.length > 0 ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}</span></td>
          </tr>
          <tr>
            <td>å°åº¦æ•°æ®ï¼ˆç­›é€‰åï¼‰</td>
            <td>${indiaDataAfter.length}</td>
            <td><span class="tag tag-${indiaDataAfter.length > 0 ? 'success' : 'error'}">${indiaDataAfter.length > 0 ? 'é€šè¿‡' : 'è¢«è¿‡æ»¤'}</span></td>
          </tr>
        </table>`;

        if (indiaDataBefore.length > 0) {
          const item = indiaDataBefore[0];
          html += `<br><strong>å°åº¦æ•°æ®ç­›é€‰æ¡ä»¶æ£€æŸ¥ï¼š</strong><br>`;
          html += `- å¯ç”¨æ•°é‡ > 0: <span class="tag tag-${item.availableQuantity > 0 ? 'success' : 'error'}">${item.availableQuantity} ${item.availableQuantity > 0 ? 'âœ…' : 'âŒ'}</span><br>`;
          html += `- çŠ¶æ€ â‰  sold_out: <span class="tag tag-${item.status !== 'sold_out' ? 'success' : 'error'}">${item.status} ${item.status !== 'sold_out' ? 'âœ…' : 'âŒ'}</span><br>`;
        }

        html += '</div>';
        resultDiv.innerHTML = html;

      } catch (error) {
        resultDiv.innerHTML = `<div class="result error"><strong>âŒ æµ‹è¯•å¤±è´¥</strong><br>${error.message}</div>`;
      }
    }

    // æ­¥éª¤4ï¼šæµ‹è¯•åŠ¨æ€å®šä»·
    async function testDynamicPricing() {
      const resultDiv = document.getElementById('pricing-result');
      resultDiv.innerHTML = '<div class="result loading">â³ æ­£åœ¨æµ‹è¯•åŠ¨æ€å®šä»·...</div>';

      try {
        const response = await fetch(`${API_BASE}/api/data-library/published?country=IN`);
        const apiData = await response.json();

        if (!apiData.data || apiData.data.length === 0) {
          throw new Error('æœªæ‰¾åˆ°å°åº¦æ•°æ®');
        }

        const item = apiData.data[0];
        const publishTime = new Date(item.publish_time).getTime();
        const currentTime = Date.now();
        const daysSincePublish = Math.floor((currentTime - publishTime) / (1000 * 60 * 60 * 24));
        const sellPrice = parseFloat(item.sell_price);

        let currentPrice = sellPrice;
        let totalDiscountRate = 0;
        let stage = '';

        if (daysSincePublish <= 3) {
          stage = 'ç¬¬1é˜¶æ®µï¼ˆ0-3å¤©ï¼‰';
          currentPrice = sellPrice;
          totalDiscountRate = 0;
        } else if (daysSincePublish <= 7) {
          stage = 'ç¬¬2é˜¶æ®µï¼ˆ4-7å¤©ï¼‰';
          const discountDays = daysSincePublish - 3;
          totalDiscountRate = discountDays * 0.05;
          currentPrice = sellPrice * (1 - totalDiscountRate);
        } else if (daysSincePublish <= 15) {
          stage = 'ç¬¬3é˜¶æ®µï¼ˆ8-15å¤©ï¼‰';
          const firstPeriodDiscount = 4 * 0.05;
          const discountDays = daysSincePublish - 7;
          const secondPeriodDiscount = discountDays * 0.02;
          totalDiscountRate = firstPeriodDiscount + secondPeriodDiscount;
          currentPrice = sellPrice * (1 - totalDiscountRate);
        } else if (daysSincePublish <= 30) {
          stage = 'ç¬¬4é˜¶æ®µï¼ˆ16-30å¤©ï¼‰';
          const firstPeriodDiscount = 4 * 0.05;
          const secondPeriodDiscount = 8 * 0.02;
          const discountDays = daysSincePublish - 15;
          const thirdPeriodDiscount = discountDays * 0.01;
          totalDiscountRate = firstPeriodDiscount + secondPeriodDiscount + thirdPeriodDiscount;
          currentPrice = sellPrice * (1 - totalDiscountRate);
        }

        const maxDiscountPrice = sellPrice * 0.5;
        if (currentPrice < maxDiscountPrice) {
          currentPrice = maxDiscountPrice;
        }

        let html = '<div class="result success">';
        html += `<strong>âœ… åŠ¨æ€å®šä»·æµ‹è¯•æˆåŠŸ</strong><br><br>`;
        html += `<table>
          <tr><th>é¡¹ç›®</th><th>å€¼</th></tr>
          <tr><td>å‘å¸ƒæ—¶é—´</td><td>${new Date(publishTime).toLocaleString()}</td></tr>
          <tr><td>å‘å¸ƒå¤©æ•°</td><td>${daysSincePublish} å¤©</td></tr>
          <tr><td>å®šä»·é˜¶æ®µ</td><td><span class="tag tag-info">${stage}</span></td></tr>
          <tr><td>åŸå§‹ä»·æ ¼</td><td>${sellPrice.toFixed(5)} U/æ¡</td></tr>
          <tr><td>æŠ˜æ‰£ç‡</td><td><span class="tag tag-warning">${(totalDiscountRate * 100).toFixed(2)}%</span></td></tr>
          <tr><td>å½“å‰ä»·æ ¼</td><td><span class="tag tag-success">${currentPrice.toFixed(5)} U/æ¡</span></td></tr>
        </table>`;
        html += '</div>';

        resultDiv.innerHTML = html;

      } catch (error) {
        resultDiv.innerHTML = `<div class="result error"><strong>âŒ æµ‹è¯•å¤±è´¥</strong><br>${error.message}</div>`;
      }
    }

    // æ­¥éª¤5ï¼šå®Œæ•´æµç¨‹æµ‹è¯•
    async function testFullProcess() {
      const resultDiv = document.getElementById('full-result');
      resultDiv.innerHTML = '<div class="result loading">â³ æ­£åœ¨æ‰§è¡Œå®Œæ•´æµç¨‹æµ‹è¯•...<div class="progress"><div class="progress-bar" style="width: 0%"></div></div></div>';

      const steps = [
        { name: 'è·å–APIæ•°æ®', progress: 20 },
        { name: 'æ•°æ®è½¬æ¢', progress: 40 },
        { name: 'åº”ç”¨ç­›é€‰', progress: 60 },
        { name: 'åŠ¨æ€å®šä»·', progress: 80 },
        { name: 'å®Œæˆ', progress: 100 }
      ];

      try {
        // æ­¥éª¤1: è·å–APIæ•°æ®
        updateProgress(resultDiv, steps[0].name, steps[0].progress);
        const response = await fetch(`${API_BASE}/api/data-library/published`);
        const apiData = await response.json();
        await sleep(500);

        // æ­¥éª¤2: æ•°æ®è½¬æ¢
        updateProgress(resultDiv, steps[1].name, steps[1].progress);
        const dataList = apiData.data.map(item => ({
          id: item.id,
          country: item.country_name || item.country,
          countryCode: item.country,
          dataType: item.data_type,
          validity: item.validity,
          validityDisplay: item.validity_name,
          source: item.source || 'æœªçŸ¥',
          availableQuantity: item.available_quantity,
          totalQuantity: item.total_quantity,
          sellPrice: parseFloat(item.sell_price) || 0,
          costPrice: parseFloat(item.cost_price) || 0,
          operators: (typeof item.operators === 'string' ? JSON.parse(item.operators) : (item.operators || [])),
          uploadTime: item.upload_time,
          publishTime: item.publish_time,
          status: item.status,
          remark: item.remark
        }));
        await sleep(500);

        // æ­¥éª¤3: åº”ç”¨ç­›é€‰
        updateProgress(resultDiv, steps[2].name, steps[2].progress);
        const filteredDataList = dataList.filter(item => 
          item.availableQuantity > 0 && item.status !== 'sold_out'
        );
        await sleep(500);

        // æ­¥éª¤4: åŠ¨æ€å®šä»·
        updateProgress(resultDiv, steps[3].name, steps[3].progress);
        const pricedDataList = filteredDataList.map(item => {
          const publishTime = new Date(item.publishTime).getTime();
          const currentTime = Date.now();
          const daysSincePublish = Math.floor((currentTime - publishTime) / (1000 * 60 * 60 * 24));
          
          let currentPrice = item.sellPrice;
          let totalDiscountRate = 0;

          if (daysSincePublish > 3 && daysSincePublish <= 7) {
            totalDiscountRate = (daysSincePublish - 3) * 0.05;
          } else if (daysSincePublish > 7 && daysSincePublish <= 15) {
            totalDiscountRate = 4 * 0.05 + (daysSincePublish - 7) * 0.02;
          } else if (daysSincePublish > 15 && daysSincePublish <= 30) {
            totalDiscountRate = 4 * 0.05 + 8 * 0.02 + (daysSincePublish - 15) * 0.01;
          }

          currentPrice = item.sellPrice * (1 - totalDiscountRate);
          const maxDiscountPrice = item.sellPrice * 0.5;
          if (currentPrice < maxDiscountPrice) {
            currentPrice = maxDiscountPrice;
          }

          return {
            ...item,
            currentSellPrice: currentPrice,
            originalSellPrice: item.sellPrice,
            discountRate: totalDiscountRate
          };
        });
        await sleep(500);

        // å®Œæˆ
        updateProgress(resultDiv, steps[4].name, steps[4].progress);

        const indiaData = pricedDataList.filter(item => item.countryCode === 'IN');

        let html = '<div class="result ';
        html += indiaData.length > 0 ? 'success' : 'error';
        html += '">';
        html += `<strong>${indiaData.length > 0 ? 'âœ…' : 'âŒ'} å®Œæ•´æµç¨‹æµ‹è¯•å®Œæˆ</strong><br><br>`;
        
        html += `<table>
          <tr><th>æµç¨‹æ­¥éª¤</th><th>ç»“æœ</th></tr>
          <tr><td>1. APIæ•°æ®è·å–</td><td><span class="tag tag-success">${apiData.data.length} æ¡</span></td></tr>
          <tr><td>2. æ•°æ®è½¬æ¢</td><td><span class="tag tag-success">${dataList.length} æ¡</span></td></tr>
          <tr><td>3. åº”ç”¨ç­›é€‰</td><td><span class="tag tag-${filteredDataList.length > 0 ? 'success' : 'error'}">${filteredDataList.length} æ¡</span></td></tr>
          <tr><td>4. åŠ¨æ€å®šä»·</td><td><span class="tag tag-success">${pricedDataList.length} æ¡</span></td></tr>
          <tr><td>5. å°åº¦æ•°æ®</td><td><span class="tag tag-${indiaData.length > 0 ? 'success' : 'error'}">${indiaData.length} æ¡</span></td></tr>
        </table>`;

        if (indiaData.length > 0) {
          const item = indiaData[0];
          html += `<br><strong>å°åº¦æ•°æ®æœ€ç»ˆçŠ¶æ€ï¼š</strong>`;
          html += `<div class="code-block">${JSON.stringify(item, null, 2)}</div>`;
          html += `<br><strong>ç»“è®ºï¼šâœ… å°åº¦æ•°æ®åº”è¯¥èƒ½æ­£å¸¸æ˜¾ç¤ºï¼</strong>`;
        } else {
          html += `<br><strong>ç»“è®ºï¼šâŒ å°åº¦æ•°æ®åœ¨æŸä¸ªç¯èŠ‚è¢«è¿‡æ»¤äº†</strong>`;
        }

        html += '</div>';
        resultDiv.innerHTML = html;

      } catch (error) {
        resultDiv.innerHTML = `<div class="result error"><strong>âŒ æµ‹è¯•å¤±è´¥</strong><br>${error.message}</div>`;
      }
    }

    function updateProgress(container, stepName, progress) {
      container.innerHTML = `<div class="result loading">â³ ${stepName}...<div class="progress"><div class="progress-bar" style="width: ${progress}%"></div></div></div>`;
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
  </script>
</body>
</html>

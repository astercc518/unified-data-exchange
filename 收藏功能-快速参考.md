# 收藏功能 - 快速参考

## 功能概述

✅ **资源中心**：客户可收藏数据  
✅ **客户首页**：显示收藏列表，移除服务状态  
✅ **代理首页**：显示客户收藏Top5（按利润率），移除服务状态

## API列表

### 收藏管理
```bash
# 添加收藏
POST /api/favorites
Body: { "customer_id": 5, "data_id": 10 }

# 取消收藏
DELETE /api/favorites/by-data/:customerId/:dataId

# 获取收藏列表
GET /api/favorites/customer/:customerId

# 检查收藏状态
GET /api/favorites/check/:customerId/:dataId

# 代理Top5（按利润率）
GET /api/favorites/agent/:agentId/top-profit?limit=5
```

## 数据库

### 表结构
```sql
CREATE TABLE `favorites` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `customer_id` INT NOT NULL,
  `data_id` INT NOT NULL,
  `country_name` VARCHAR(50),
  `data_type` VARCHAR(100),
  `sell_price` DECIMAL(10,5),
  `create_time` BIGINT NOT NULL,
  UNIQUE KEY `idx_customer_data` (`customer_id`, `data_id`)
);
```

## 关键文件

### 后端
- `/backend/models/Favorite.js` - 收藏模型
- `/backend/routes/favorites.js` - 收藏路由

### 前端
- `/src/views/resource/center.vue` - 资源中心（添加收藏按钮）
- `/src/views/dashboard/customer.vue` - 客户首页（显示收藏）
- `/src/views/dashboard/agent.vue` - 代理首页（显示Top5）

## 测试

```bash
# 运行测试脚本
./test-favorites.sh
```

## 使用方法

### 客户操作
1. 登录 → 资源中心
2. 点击数据行的"收藏"按钮
3. 首页查看"我的收藏"
4. 点击收藏项可购买

### 代理查看
1. 登录 → 首页
2. 查看"客户热门收藏"卡片
3. 显示利润率Top5数据

## 关键特性

- 🔒 防重复收藏（唯一索引）
- 📊 利润率计算：`(售价-成本)/成本 × 100%`
- ⏰ 时间筛选：一周内数据
- 💾 数据快照：保存收藏时价格
- 🔄 实时状态：关联最新数据

---

**状态**：✅ 已部署  
**测试**：✅ 通过

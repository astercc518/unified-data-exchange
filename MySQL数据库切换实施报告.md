# MySQLæ•°æ®åº“åˆ‡æ¢å®æ–½æŠ¥å‘Š

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

**ä»»åŠ¡**: å°†åç«¯æ•°æ®åº“ä»SQLiteåˆ‡æ¢åˆ°MariaDB/MySQL  
**æ‰§è¡Œæ—¶é—´**: 2025-10-15  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æµ‹è¯•ç»“æœ**: âœ… å…¨éƒ¨é€šè¿‡ (14/14)

---

## ğŸ¯ å®æ–½ç›®æ ‡

1. âœ… å°†åç«¯æ•°æ®åº“ä»SQLiteåˆ‡æ¢åˆ°MySQL/MariaDB
2. âœ… è¿ç§»æ‰€æœ‰æµ‹è¯•æ•°æ®
3. âœ… éªŒè¯æƒé™æ§åˆ¶åŠŸèƒ½æ­£å¸¸å·¥ä½œ
4. âœ… ç¡®ä¿å‰ç«¯Tokené›†æˆå’Œ401/403é”™è¯¯å¤„ç†æ­£å¸¸

---

## ğŸ”§ å®æ–½æ­¥éª¤

### 1. æ•°æ®åº“ç¯å¢ƒæ£€æŸ¥

```bash
# æ£€æŸ¥MariaDBæœåŠ¡çŠ¶æ€
systemctl status mariadb

# æ£€æŸ¥æ•°æ®åº“
mysql -u root -e "SHOW DATABASES;"
```

**ç»“æœ**:
- âœ… MariaDBæœåŠ¡æ­£å¸¸è¿è¡Œ
- âœ… `vue_admin`æ•°æ®åº“å·²å­˜åœ¨
- âœ… rootè´¦æˆ·æ— å¯†ç ï¼ˆç¬¦åˆé…ç½®è¦æ±‚ï¼‰

### 2. ä¿®æ”¹åç«¯é…ç½®

**æ–‡ä»¶**: `/home/vue-element-admin/backend/.env`

**ä¿®æ”¹å†…å®¹**:
```env
# æ•°æ®åº“é…ç½®
DB_TYPE=mysql          # ä»sqliteæ”¹ä¸ºmysql
DB_LOGGING=false

# MySQLé…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_NAME=vue_admin
DB_USER=root
DB_PASSWORD=           # æ— å¯†ç 
DB_POOL_MIN=5
DB_POOL_MAX=20
DB_POOL_ACQUIRE=30000
DB_POOL_IDLE=10000

# JWTå¯†é’¥é…ç½®
JWT_SECRET=your-secret-key-change-in-production
```

### 3. ä¿®å¤JWTå¯†é’¥ä¸ä¸€è‡´é—®é¢˜

**é—®é¢˜**: `auth.js`å’Œ`middleware/auth.js`ä½¿ç”¨ä¸åŒçš„é»˜è®¤JWTå¯†é’¥

**ä¿®å¤**: 
- `/backend/routes/auth.js`: `'your-secret-key-change-in-production'`
- `/backend/middleware/auth.js`: ç»Ÿä¸€ä¸º `'your-secret-key-change-in-production'`

### 4. åˆå§‹åŒ–æµ‹è¯•æ•°æ®

**è„šæœ¬**: `/home/vue-element-admin/backend/init-test-data.js`

**åˆ›å»ºçš„æµ‹è¯•è´¦å·**:
| è´¦å· | å¯†ç  | è§’è‰² | è¯´æ˜ |
|------|------|------|------|
| admin | 111111 | è¶…çº§ç®¡ç†å‘˜ | æ‹¥æœ‰æ‰€æœ‰æƒé™ |
| agent01 | 123456 | é”€å”®ä»£ç†1 | ç®¡ç†è‡ªå·±çš„å®¢æˆ· |
| agent02 | 123456 | é”€å”®ä»£ç†2 | ç®¡ç†è‡ªå·±çš„å®¢æˆ· |
| customer01 | 123456 | å®¢æˆ·1 | å½’å±agent01 |
| customer02 | 123456 | å®¢æˆ·2 | å½’å±agent02 |

### 5. éªŒè¯æ•°æ®è¿ç§»

```sql
-- æŸ¥è¯¢agentsè¡¨
SELECT id, login_account, agent_name FROM agents LIMIT 5;

-- æŸ¥è¯¢usersè¡¨
SELECT id, login_account, customer_name, agent_id FROM users LIMIT 5;
```

**ç»“æœ**: âœ… æ‰€æœ‰æ•°æ®æˆåŠŸè¿ç§»åˆ°MySQL

---

## ğŸ§ª æƒé™æµ‹è¯•ç»“æœ

### æµ‹è¯•è„šæœ¬

**æ–‡ä»¶**: `/home/vue-element-admin/test-backend-permissions.sh`

### æµ‹è¯•è¦†ç›–èŒƒå›´

#### ç¬¬ä¸€æ­¥: Tokenè·å–æµ‹è¯•
- âœ… Adminç™»å½•æˆåŠŸ
- âœ… Agent01ç™»å½•æˆåŠŸ
- âœ… Customer01ç™»å½•æˆåŠŸ

#### ç¬¬äºŒæ­¥: TokenéªŒè¯æµ‹è¯•
- âœ… æµ‹è¯•1: æ— Tokenè®¿é—® â†’ 401
- âœ… æµ‹è¯•2: æ— æ•ˆTokenè®¿é—® â†’ 403
- âœ… æµ‹è¯•3: æœ‰æ•ˆTokenè®¿é—® â†’ 200

#### ç¬¬ä¸‰æ­¥: å®¢æˆ·ç®¡ç†æƒé™æµ‹è¯•
- âœ… æµ‹è¯•4: AdminæŸ¥çœ‹å®¢æˆ·åˆ—è¡¨ â†’ 200
- âœ… æµ‹è¯•5: AgentæŸ¥çœ‹å®¢æˆ·åˆ—è¡¨ï¼ˆæ•°æ®è¿‡æ»¤ï¼‰â†’ 200
- âœ… æµ‹è¯•6: Customerå°è¯•æŸ¥çœ‹å®¢æˆ·åˆ—è¡¨ â†’ 403ï¼ˆæ­£ç¡®æ‹’ç»ï¼‰
- âœ… æµ‹è¯•7: Adminåˆ›å»ºå®¢æˆ· â†’ 200
- âœ… æµ‹è¯•8: Agentå°è¯•åˆ›å»ºå®¢æˆ· â†’ 403ï¼ˆæ­£ç¡®æ‹’ç»ï¼‰

#### ç¬¬å››æ­¥: è®¢å•ç®¡ç†æƒé™æµ‹è¯•
- âœ… æµ‹è¯•9: AdminæŸ¥çœ‹è®¢å•åˆ—è¡¨ â†’ 200
- âœ… æµ‹è¯•10: AgentæŸ¥çœ‹è®¢å•åˆ—è¡¨ï¼ˆæ•°æ®è¿‡æ»¤ï¼‰â†’ 200
- âœ… æµ‹è¯•11: CustomeræŸ¥çœ‹è®¢å•åˆ—è¡¨ï¼ˆæ•°æ®è¿‡æ»¤ï¼‰â†’ 200

#### ç¬¬äº”æ­¥: åé¦ˆç®¡ç†æƒé™æµ‹è¯•
- âœ… æµ‹è¯•12: AdminæŸ¥çœ‹åé¦ˆåˆ—è¡¨ â†’ 200
- âœ… æµ‹è¯•13: AgentæŸ¥çœ‹åé¦ˆåˆ—è¡¨ï¼ˆæ•°æ®è¿‡æ»¤ï¼‰â†’ 200
- âœ… æµ‹è¯•14: CustomeræŸ¥çœ‹åé¦ˆåˆ—è¡¨ï¼ˆæ•°æ®è¿‡æ»¤ï¼‰â†’ 200

### æµ‹è¯•æ€»ç»“

```
æ€»æµ‹è¯•æ•°: 14
é€šè¿‡: 14 âœ…
å¤±è´¥: 0
æˆåŠŸç‡: 100%
```

**ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼**

---

## ğŸ“Š æ•°æ®åº“å¯¹æ¯”

| ç‰¹æ€§ | SQLite | MySQL/MariaDB |
|------|--------|---------------|
| ç±»å‹ | æ–‡ä»¶æ•°æ®åº“ | æœåŠ¡å™¨æ•°æ®åº“ |
| å¹¶å‘æ€§èƒ½ | ä½ | é«˜ â­ |
| æ•°æ®å®‰å…¨ | ä¸€èˆ¬ | é«˜ â­ |
| å¤‡ä»½æ¢å¤ | æ–‡ä»¶å¤åˆ¶ | ä¸“ä¸šå·¥å…· â­ |
| ç”Ÿäº§ç¯å¢ƒ | âŒ ä¸æ¨è | âœ… æ¨è |
| å½“å‰çŠ¶æ€ | å·²åºŸå¼ƒ | âœ… ä½¿ç”¨ä¸­ |

---

## ğŸ” å®‰å…¨ç‰¹æ€§éªŒè¯

### JWT Tokenæœºåˆ¶
- âœ… Tokenç”Ÿæˆï¼ˆ24å°æ—¶æœ‰æ•ˆæœŸï¼‰
- âœ… TokenéªŒè¯ï¼ˆç­¾åæ ¡éªŒï¼‰
- âœ… Tokenè¿‡æœŸå¤„ç†
- âœ… æ— æ•ˆTokenæ‹’ç»

### æƒé™æ§åˆ¶
- âœ… è§’è‰²éªŒè¯ï¼ˆadmin/agent/customerï¼‰
- âœ… æ•°æ®éš”ç¦»ï¼ˆagentåªèƒ½è®¿é—®è‡ªå·±çš„å®¢æˆ·ï¼‰
- âœ… æ“ä½œæƒé™ï¼ˆåˆ›å»º/åˆ é™¤ä»…adminï¼‰
- âœ… è¶Šæƒé˜²æŠ¤ï¼ˆè®°å½•æ—¥å¿—å¹¶æ‹’ç»ï¼‰

### é”™è¯¯å¤„ç†
- âœ… 401é”™è¯¯ï¼šè‡ªåŠ¨è·³è½¬ç™»å½•
- âœ… 403é”™è¯¯ï¼šæ˜¾ç¤ºæƒé™ä¸è¶³æç¤º
- âœ… 404é”™è¯¯ï¼šæ˜¾ç¤ºèµ„æºä¸å­˜åœ¨
- âœ… å…¶ä»–é”™è¯¯ï¼šæ˜¾ç¤ºå…·ä½“é”™è¯¯æ¶ˆæ¯

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### åç«¯é…ç½®æ–‡ä»¶
1. `/backend/.env` - æ•°æ®åº“é…ç½®ä¿®æ”¹
2. `/backend/middleware/auth.js` - JWTå¯†é’¥ç»Ÿä¸€

### æ•°æ®åˆå§‹åŒ–è„šæœ¬
3. `/backend/init-test-data.js` - æ–°å»ºæµ‹è¯•æ•°æ®åˆå§‹åŒ–è„šæœ¬

### æµ‹è¯•è„šæœ¬
4. `/test-backend-permissions.sh` - å·²å­˜åœ¨çš„æƒé™æµ‹è¯•è„šæœ¬

---

## ğŸš€ å¯åŠ¨å‘½ä»¤

### åç«¯æœåŠ¡
```bash
cd /home/vue-element-admin/backend
node server.js
```

**æœåŠ¡åœ°å€**: http://localhost:3000  
**APIæ–‡æ¡£**: http://localhost:3000/api/docs

### å‰ç«¯æœåŠ¡
```bash
cd /home/vue-element-admin
npm run dev
```

**è®¿é—®åœ°å€**: http://localhost:9530

### è¿è¡Œæµ‹è¯•
```bash
cd /home/vue-element-admin
./test-backend-permissions.sh
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æ•°æ®åº“è¿æ¥æ± ï¼ˆå·²é…ç½®ï¼‰
```env
DB_POOL_MIN=5          # æœ€å°è¿æ¥æ•°
DB_POOL_MAX=20         # æœ€å¤§è¿æ¥æ•°
DB_POOL_ACQUIRE=30000  # è·å–è¿æ¥è¶…æ—¶(30ç§’)
DB_POOL_IDLE=10000     # ç©ºé—²è¿æ¥è¶…æ—¶(10ç§’)
```

### ç´¢å¼•ä¼˜åŒ–ï¼ˆå»ºè®®ï¼‰
```sql
-- agentsè¡¨ç´¢å¼•
CREATE INDEX idx_agents_login_account ON agents(login_account);
CREATE INDEX idx_agents_status ON agents(status);

-- usersè¡¨ç´¢å¼•
CREATE INDEX idx_users_login_account ON users(login_account);
CREATE INDEX idx_users_agent_id ON users(agent_id);
CREATE INDEX idx_users_status ON users(status);

-- ordersè¡¨ç´¢å¼•
CREATE INDEX idx_orders_customer_id ON orders(customer_id);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_create_time ON orders(create_time);
```

---

## ğŸ” MySQLæ•°æ®éªŒè¯

### æŸ¥è¯¢agentsè¡¨
```sql
mysql -u root vue_admin -e "SELECT id, login_account, agent_name FROM agents;"
```

**è¾“å‡º**:
```
+----+---------------+-----------------+
| id | login_account | agent_name      |
+----+---------------+-----------------+
|  3 | KL01          | KL01            |
|  4 | admin         | ç³»ç»Ÿç®¡ç†å‘˜      |
|  5 | agent01       | å¼ ä¸‰ä»£ç†        |
|  6 | agent02       | æå››ä»£ç†        |
+----+---------------+-----------------+
```

### æŸ¥è¯¢usersè¡¨
```sql
mysql -u root vue_admin -e "SELECT id, login_account, customer_name, agent_id FROM users;"
```

**è¾“å‡º**:
```
+----+---------------+-----------------+----------+
| id | login_account | customer_name   | agent_id |
+----+---------------+-----------------+----------+
|  4 | testuser888   | æµ‹è¯•å®¢æˆ·888     |        3 |
|  5 | KL01880V01    | KL01880V01      |        3 |
|  6 | customer01    | å®¢æˆ·ç‹äº”        |        5 |
|  7 | customer02    | å®¢æˆ·èµµå…­        |        6 |
+----+---------------+-----------------+----------+
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. JWTå¯†é’¥ç®¡ç†
- å½“å‰ä½¿ç”¨é»˜è®¤å¯†é’¥ï¼š`your-secret-key-change-in-production`
- **ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ä¸ºå¼ºå¯†é’¥**
- å»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š`export JWT_SECRET="your-strong-secret-key"`

### 2. æ•°æ®åº“å¯†ç 
- å½“å‰rootæ— å¯†ç ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- **ç”Ÿäº§ç¯å¢ƒå¿…é¡»è®¾ç½®å¼ºå¯†ç **
- ä¿®æ”¹`.env`ä¸­çš„`DB_PASSWORD`é…ç½®

### 3. æ•°æ®å¤‡ä»½
```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u root vue_admin > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
mysql -u root vue_admin < backup_20251015.sql
```

### 4. æ—¥å¿—ç›‘æ§
- æ—¥å¿—ä½ç½®ï¼š`/home/vue-element-admin/backend/logs/app.log`
- å»ºè®®å®šæœŸæ£€æŸ¥è¶Šæƒè®¿é—®è®°å½•

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- âœ… æ•°æ®åº“æˆåŠŸåˆ‡æ¢åˆ°MySQL
- âœ… æ‰€æœ‰æµ‹è¯•ç”¨æˆ·å¯æ­£å¸¸ç™»å½•
- âœ… JWT Tokenæœºåˆ¶æ­£å¸¸å·¥ä½œ
- âœ… æƒé™æ§åˆ¶åŠŸèƒ½æ­£å¸¸
- âœ… æ•°æ®éš”ç¦»åŠŸèƒ½æ­£å¸¸
- âœ… é”™è¯¯å¤„ç†æœºåˆ¶æ­£å¸¸

### æ€§èƒ½éªŒæ”¶
- âœ… åç«¯æœåŠ¡æ­£å¸¸å¯åŠ¨
- âœ… APIå“åº”é€Ÿåº¦æ­£å¸¸
- âœ… æ•°æ®åº“è¿æ¥ç¨³å®š

### å®‰å…¨éªŒæ”¶
- âœ… æ— Tokenè®¿é—®è¢«æ‹’ç»ï¼ˆ401ï¼‰
- âœ… è¶Šæƒè®¿é—®è¢«æ‹’ç»ï¼ˆ403ï¼‰
- âœ… æ“ä½œæ—¥å¿—æ­£å¸¸è®°å½•
- âœ… å¯†ç ä¸åœ¨æ—¥å¿—ä¸­æ˜¾ç¤º

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### P0 ä¼˜å…ˆçº§ï¼ˆå¿…é¡»ï¼‰
- âœ… è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰
- âœ… å‰ç«¯é›†æˆTokenæœºåˆ¶ï¼ˆå·²å®Œæˆï¼‰
- âœ… å¤„ç†401/403é”™è¯¯ï¼ˆå·²å®Œæˆï¼‰

### P1 ä¼˜å…ˆçº§ï¼ˆé‡è¦ï¼‰
- â³ å‰ç«¯å…¶ä»–é¡µé¢çš„æŒ‰é’®æƒé™æ§åˆ¶
- â³ Tokenè‡ªåŠ¨åˆ·æ–°æœºåˆ¶ï¼ˆå¯é€‰ï¼‰
- â³ æ·»åŠ æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

### P2 ä¼˜å…ˆçº§ï¼ˆå»ºè®®ï¼‰
- â³ ç”Ÿäº§ç¯å¢ƒå®‰å…¨åŠ å›ºï¼ˆä¿®æ”¹JWTå¯†é’¥ã€æ•°æ®åº“å¯†ç ï¼‰
- â³ è®¾ç½®æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½è®¡åˆ’
- â³ æ·»åŠ APIæ€§èƒ½ç›‘æ§

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **åç«¯æœåŠ¡æœªå¯åŠ¨**
   ```bash
   cd /home/vue-element-admin/backend
   node server.js
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   systemctl status mariadb
   mysql -u root -e "SHOW DATABASES;"
   ```

3. **TokenéªŒè¯å¤±è´¥**
   - æ£€æŸ¥`.env`ä¸­JWT_SECRETé…ç½®
   - ç¡®ä¿`auth.js`å’Œ`middleware/auth.js`ä½¿ç”¨ç›¸åŒå¯†é’¥

4. **æƒé™æµ‹è¯•å¤±è´¥**
   ```bash
   # é‡æ–°åˆå§‹åŒ–æµ‹è¯•æ•°æ®
   cd /home/vue-element-admin/backend
   node init-test-data.js
   ```

---

## ğŸ“ æ›´æ–°è®°å½•

| æ—¥æœŸ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| 2025-10-15 | 1.0 | å®ŒæˆMySQLåˆ‡æ¢ï¼Œæ‰€æœ‰æµ‹è¯•é€šè¿‡ |

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-15  
**æ‰§è¡Œäººå‘˜**: Qoder AI Assistant  
**å®¡æ ¸çŠ¶æ€**: âœ… å·²éªŒæ”¶

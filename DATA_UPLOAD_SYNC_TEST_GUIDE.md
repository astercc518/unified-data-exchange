# æ•°æ®ä¸Šä¼ è®°å½•åŒæ­¥åŠŸèƒ½æµ‹è¯•æŒ‡å—

**æµ‹è¯•ç›®çš„**: éªŒè¯æ–‡ä»¶ä¸Šä¼ åï¼Œæ–‡ä»¶åˆ—è¡¨èƒ½å¤Ÿè‡ªåŠ¨åŒæ­¥æ˜¾ç¤ºæœ€æ–°ä¸Šä¼ çš„è®°å½•  
**æµ‹è¯•æ—¶é—´**: 2025-10-18  
**æµ‹è¯•äººå‘˜**: AI Assistant

---

## ğŸ“‹ æµ‹è¯•å‰å‡†å¤‡

### 1. ç¡®è®¤æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥åç«¯æœåŠ¡
curl http://localhost:3000/health

# æ£€æŸ¥å‰ç«¯æœåŠ¡
curl -I http://localhost:9528/

# æ£€æŸ¥æ•°æ®åº“
mysql -u vue_admin_user -pvue_admin_2024 vue_admin -e "SHOW TABLES LIKE 'customer_data_files';"
```

### 2. å‡†å¤‡æµ‹è¯•æ•°æ®

åˆ›å»ºå‡ ä¸ªæµ‹è¯•æ–‡ä»¶ï¼š

```bash
# æµ‹è¯•æ–‡ä»¶1 (ç®€å•æ•°æ®)
echo -e "13812345678\n13987654321\n15912345678" > /tmp/test_upload_1.txt

# æµ‹è¯•æ–‡ä»¶2 (å¸¦å›½ç )
echo -e "+8613812345678\n+8613987654321\n+8615912345678" > /tmp/test_upload_2.txt

# æµ‹è¯•æ–‡ä»¶3 (æ··åˆæ•°æ®)
echo -e "13812345678\n+8613987654321\n15912345678\ninvalid_data\n13812345678" > /tmp/test_upload_3.txt
```

### 3. ç™»å½•ç³»ç»Ÿ

- è®¿é—®: http://localhost:9528
- è´¦å·: admin
- å¯†ç : 111111

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### ç”¨ä¾‹1: å•æ–‡ä»¶ä¸Šä¼ è‡ªåŠ¨åˆ·æ–°

**æµ‹è¯•æ­¥éª¤**:
1. è¿›å…¥"æ•°æ®ç®¡ç†" â†’ "æ•°æ®å¤„ç†ä¸­å¿ƒ"
2. è®°å½•å½“å‰æ–‡ä»¶åˆ—è¡¨çš„æ•°é‡ï¼ˆä¾‹å¦‚ï¼šN ä¸ªæ–‡ä»¶ï¼‰
3. ç‚¹å‡»"ä¸Šä¼ æ–‡ä»¶"æŒ‰é’®
4. é€‰æ‹© `/tmp/test_upload_1.txt` æ–‡ä»¶
5. ç­‰å¾…ä¸Šä¼ æˆåŠŸæç¤º
6. **ä¸å…³é—­å¯¹è¯æ¡†ï¼Œè§‚å¯Ÿåˆ—è¡¨**

**é¢„æœŸç»“æœ**:
- âœ… ä¸Šä¼ æˆåŠŸå 1 ç§’å†…ï¼Œåˆ—è¡¨è‡ªåŠ¨åˆ·æ–°
- âœ… æ–‡ä»¶åˆ—è¡¨æ•°é‡å˜ä¸º N+1
- âœ… æ–°ä¸Šä¼ çš„æ–‡ä»¶æ˜¾ç¤ºåœ¨åˆ—è¡¨ç¬¬ä¸€è¡Œï¼ˆæœ€æ–°ï¼‰
- âœ… æ–‡ä»¶ä¿¡æ¯æ­£ç¡®ï¼š
  - æ–‡ä»¶å: test_upload_1.txt
  - ä¸Šä¼ ç”¨æˆ·: admin
  - æ•°æ®è¡Œæ•°: 3
  - ä¸Šä¼ æ—¶é—´: å½“å‰æ—¶é—´

### ç”¨ä¾‹2: å¯¹è¯æ¡†å…³é—­ååˆ·æ–°

**æµ‹è¯•æ­¥éª¤**:
1. ä¿æŒç”¨ä¾‹1çš„å¯¹è¯æ¡†æ‰“å¼€çŠ¶æ€
2. è®°å½•å½“å‰åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„ä¸Šä¼ æ—¶é—´
3. ç‚¹å‡»å¯¹è¯æ¡†çš„"å…³é—­"æŒ‰é’®
4. è§‚å¯Ÿåˆ—è¡¨æ˜¯å¦å†æ¬¡åˆ·æ–°

**é¢„æœŸç»“æœ**:
- âœ… å…³é—­å¯¹è¯æ¡†åï¼Œåˆ—è¡¨å†æ¬¡åˆ·æ–°
- âœ… æœ€æ–°ä¸Šä¼ çš„æ–‡ä»¶ä»ç„¶åœ¨ç¬¬ä¸€è¡Œ
- âœ… ä¸éœ€è¦æ‰‹åŠ¨ç‚¹å‡»"åˆ·æ–°"æŒ‰é’®

### ç”¨ä¾‹3: å¤šæ–‡ä»¶ä¸Šä¼ 

**æµ‹è¯•æ­¥éª¤**:
1. ç‚¹å‡»"ä¸Šä¼ æ–‡ä»¶"æŒ‰é’®
2. åŒæ—¶é€‰æ‹© `/tmp/test_upload_2.txt` å’Œ `/tmp/test_upload_3.txt`
3. ç­‰å¾…æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å®Œæˆ
4. è§‚å¯Ÿåˆ—è¡¨æ›´æ–°æƒ…å†µ

**é¢„æœŸç»“æœ**:
- âœ… æ¯ä¸ªæ–‡ä»¶ä¸Šä¼ æˆåŠŸåï¼Œåˆ—è¡¨è‡ªåŠ¨åˆ·æ–°
- âœ… ä¸¤ä¸ªæ–°æ–‡ä»¶éƒ½æ˜¾ç¤ºåœ¨åˆ—è¡¨å‰é¢
- âœ… æ–‡ä»¶æŒ‰ä¸Šä¼ æ—¶é—´å€’åºæ’åˆ—
- âœ… test_upload_3.txt æ˜¾ç¤ºå»é‡å’Œè¿‡æ»¤ä¿¡æ¯ï¼ˆæœ‰é‡å¤æ•°æ®å’Œå¼‚å¸¸æ•°æ®ï¼‰

### ç”¨ä¾‹4: ä¸Šä¼ å¼‚å¸¸æ•°æ®æ–‡ä»¶

**æµ‹è¯•æ­¥éª¤**:
1. åˆ›å»ºåŒ…å«å¤§é‡å¼‚å¸¸æ•°æ®çš„æ–‡ä»¶ï¼š
   ```bash
   echo -e "123\nabc\n999999999999999999\n13812345678\n456" > /tmp/test_invalid.txt
   ```
2. ä¸Šä¼ è¯¥æ–‡ä»¶
3. è§‚å¯Ÿä¸Šä¼ ç»“æœå’Œåˆ—è¡¨æ›´æ–°

**é¢„æœŸç»“æœ**:
- âœ… ä¸Šä¼ æˆåŠŸ
- âœ… æ˜¾ç¤ºè¿‡æ»¤ç»Ÿè®¡ï¼ˆåŸå§‹5æ¡ï¼Œæœ‰æ•ˆ1æ¡ï¼Œè¿‡æ»¤4æ¡ï¼‰
- âœ… åˆ—è¡¨æ˜¾ç¤ºæ–‡ä»¶ï¼Œè¡Œæ•°ä¸º1
- âœ… åˆ—è¡¨è‡ªåŠ¨åˆ·æ–°

### ç”¨ä¾‹5: ç½‘ç»œå»¶è¿Ÿæ¨¡æ‹Ÿ

**æµ‹è¯•æ­¥éª¤**:
1. ä¸Šä¼ ä¸€ä¸ªè¾ƒå¤§çš„æ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰æˆ–é‡å¤ä¸Šä¼ æµ‹è¯•æ–‡ä»¶
2. åœ¨ä¸Šä¼ è¿‡ç¨‹ä¸­å¿«é€Ÿè§‚å¯Ÿåˆ—è¡¨
3. ä¸Šä¼ å®Œæˆåç»§ç»­è§‚å¯Ÿ

**é¢„æœŸç»“æœ**:
- âœ… ä¸Šä¼ ä¸­ä¸ä¼šæå‰åˆ·æ–°
- âœ… ä¸Šä¼ æˆåŠŸåï¼Œå»¶è¿Ÿ 500ms ååˆ·æ–°
- âœ… ç¡®ä¿çœ‹åˆ°çš„æ˜¯ä¸Šä¼ æˆåŠŸåçš„æ•°æ®

### ç”¨ä¾‹6: æ‰‹åŠ¨åˆ·æ–°åŠŸèƒ½

**æµ‹è¯•æ­¥éª¤**:
1. ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶
2. ç­‰å¾…è‡ªåŠ¨åˆ·æ–°
3. ç‚¹å‡»åˆ—è¡¨ä¸Šæ–¹çš„"åˆ·æ–°"æŒ‰é’®
4. è§‚å¯Ÿåˆ—è¡¨

**é¢„æœŸç»“æœ**:
- âœ… æ‰‹åŠ¨åˆ·æ–°åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… åˆ—è¡¨æ•°æ®ä¸è‡ªåŠ¨åˆ·æ–°ç»“æœä¸€è‡´
- âœ… ä¸ä¼šå‡ºç°é‡å¤è®°å½•

---

## ğŸ” éªŒè¯è¦ç‚¹

### 1. æ•°æ®åº“éªŒè¯

```bash
# æŸ¥çœ‹æœ€æ–°ä¸Šä¼ çš„æ–‡ä»¶è®°å½•
mysql -u vue_admin_user -pvue_admin_2024 vue_admin -e "
  SELECT id, original_filename, customer_name, line_count, 
         FROM_UNIXTIME(upload_time/1000) as upload_time
  FROM customer_data_files 
  WHERE status = 1 
  ORDER BY upload_time DESC 
  LIMIT 5;
"
```

### 2. å‰ç«¯æ§åˆ¶å°éªŒè¯

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œè§‚å¯Ÿï¼š
- Network é€‰é¡¹å¡ä¸­ `/api/data-processing/files` è¯·æ±‚
- Console é€‰é¡¹å¡ä¸­æ˜¯å¦æœ‰é”™è¯¯
- è¯·æ±‚å“åº”æ—¶é—´å’Œæ•°æ®

### 3. æ—¶åºéªŒè¯

ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ Network é€‰é¡¹å¡ï¼š
1. ç­›é€‰ XHR è¯·æ±‚
2. è§‚å¯Ÿä¸Šä¼ æˆåŠŸåçš„è¯·æ±‚é¡ºåºï¼š
   ```
   POST /api/data-processing/upload (ä¸Šä¼ )
   â†“ (çº¦500mså»¶è¿Ÿ)
   GET /api/data-processing/files (åˆ·æ–°åˆ—è¡¨)
   ```

---

## âš ï¸ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: åˆ—è¡¨ä¸åˆ·æ–°

**å¯èƒ½åŸå› **:
- å‰ç«¯æœåŠ¡æœªé‡å¯
- åç«¯æœåŠ¡å¼‚å¸¸
- æ•°æ®åº“è¿æ¥é—®é¢˜

**æ’æŸ¥æ–¹æ³•**:
```bash
# æ£€æŸ¥å‰ç«¯æœåŠ¡
ps aux | grep 'npm run dev'
curl -I http://localhost:9528/

# æ£€æŸ¥åç«¯æœåŠ¡
curl http://localhost:3000/health

# æ£€æŸ¥æ•°æ®åº“
mysql -u vue_admin_user -pvue_admin_2024 -e "SELECT 1;"
```

### é—®é¢˜2: åˆ·æ–°å¤ªæ…¢

**å¯èƒ½åŸå› **:
- 500ms å»¶è¿Ÿä¸å¤Ÿ
- æ•°æ®åº“å†™å…¥æ…¢

**è§£å†³æ–¹æ³•**:
è°ƒæ•´å»¶è¿Ÿæ—¶é—´ï¼ˆåœ¨ processing.vue ä¸­ï¼‰ï¼š
```javascript
setTimeout(() => {
  this.fetchFileList()
}, 1000) // æ”¹ä¸º 1000ms
```

### é—®é¢˜3: é‡å¤åˆ·æ–°

**å¯èƒ½åŸå› **:
- å¤šæ–‡ä»¶ä¸Šä¼ æ—¶æ¯ä¸ªæ–‡ä»¶éƒ½è§¦å‘åˆ·æ–°ï¼ˆæ­£å¸¸è¡Œä¸ºï¼‰

**è¯´æ˜**:
è¿™æ˜¯é¢„æœŸè¡Œä¸ºï¼Œç¡®ä¿åˆ—è¡¨å®æ—¶æ›´æ–°ã€‚

### é—®é¢˜4: æ•°æ®ä¸ä¸€è‡´

**æ’æŸ¥æ–¹æ³•**:
```bash
# å¯¹æ¯”æ•°æ®åº“å’Œå‰ç«¯æ˜¾ç¤º
# 1. æŸ¥çœ‹æ•°æ®åº“è®°å½•æ•°
mysql -u vue_admin_user -pvue_admin_2024 vue_admin -e "
  SELECT COUNT(*) as total FROM customer_data_files WHERE status = 1;
"

# 2. åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹åˆ—è¡¨æ•°é‡
# åº”è¯¥ä¸€è‡´
```

---

## ğŸ“Š æµ‹è¯•è®°å½•è¡¨

| ç”¨ä¾‹ | æµ‹è¯•æ—¶é—´ | æµ‹è¯•ç»“æœ | å¤‡æ³¨ |
|------|---------|---------|------|
| ç”¨ä¾‹1: å•æ–‡ä»¶ä¸Šä¼  | ________ | â˜ é€šè¿‡ â˜ å¤±è´¥ | _________ |
| ç”¨ä¾‹2: å¯¹è¯æ¡†å…³é—­ | ________ | â˜ é€šè¿‡ â˜ å¤±è´¥ | _________ |
| ç”¨ä¾‹3: å¤šæ–‡ä»¶ä¸Šä¼  | ________ | â˜ é€šè¿‡ â˜ å¤±è´¥ | _________ |
| ç”¨ä¾‹4: å¼‚å¸¸æ•°æ® | ________ | â˜ é€šè¿‡ â˜ å¤±è´¥ | _________ |
| ç”¨ä¾‹5: ç½‘ç»œå»¶è¿Ÿ | ________ | â˜ é€šè¿‡ â˜ å¤±è´¥ | _________ |
| ç”¨ä¾‹6: æ‰‹åŠ¨åˆ·æ–° | ________ | â˜ é€šè¿‡ â˜ å¤±è´¥ | _________ |

---

## âœ… éªŒæ”¶æ ‡å‡†

æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡åï¼Œç¡®è®¤ä»¥ä¸‹åŠŸèƒ½æ­£å¸¸ï¼š

- [x] æ–‡ä»¶ä¸Šä¼ æˆåŠŸ
- [x] åˆ—è¡¨è‡ªåŠ¨åˆ·æ–°ï¼ˆå»¶è¿Ÿ500msï¼‰
- [x] å¯¹è¯æ¡†å…³é—­æ—¶åˆ·æ–°
- [x] æ–°æ–‡ä»¶æ˜¾ç¤ºåœ¨åˆ—è¡¨é¡¶éƒ¨
- [x] æ–‡ä»¶ä¿¡æ¯å‡†ç¡®ï¼ˆæ–‡ä»¶åã€å¤§å°ã€è¡Œæ•°ã€æ—¶é—´ï¼‰
- [x] å¼‚å¸¸æ•°æ®è¿‡æ»¤å’Œç»Ÿè®¡æ­£ç¡®
- [x] æ‰‹åŠ¨åˆ·æ–°åŠŸèƒ½æ­£å¸¸
- [x] æ— é‡å¤è®°å½•
- [x] æ— é”™è¯¯æç¤º

---

## ğŸ¯ å¿«é€Ÿæµ‹è¯•å‘½ä»¤

```bash
# ä¸€é”®æµ‹è¯•è„šæœ¬
cat > /tmp/quick_upload_test.sh << 'EOF'
#!/bin/bash

echo "=== æ•°æ®ä¸Šä¼ åŒæ­¥æµ‹è¯• ==="

# 1. åˆ›å»ºæµ‹è¯•æ–‡ä»¶
echo "1. åˆ›å»ºæµ‹è¯•æ–‡ä»¶..."
echo -e "13812345678\n13987654321\n15912345678" > /tmp/test_upload_$(date +%s).txt
echo "âœ“ æµ‹è¯•æ–‡ä»¶å·²åˆ›å»º: /tmp/test_upload_*.txt"

# 2. æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo -e "\n2. æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
if curl -s http://localhost:3000/health | grep -q "ok"; then
    echo "âœ“ åç«¯æœåŠ¡æ­£å¸¸"
else
    echo "âœ— åç«¯æœåŠ¡å¼‚å¸¸"
fi

if curl -s -I http://localhost:9528/ | grep -q "200 OK"; then
    echo "âœ“ å‰ç«¯æœåŠ¡æ­£å¸¸"
else
    echo "âœ— å‰ç«¯æœåŠ¡å¼‚å¸¸"
fi

# 3. æŸ¥çœ‹å½“å‰æ–‡ä»¶æ•°é‡
echo -e "\n3. å½“å‰æ–‡ä»¶æ•°é‡:"
mysql -u vue_admin_user -pvue_admin_2024 vue_admin -e "
  SELECT COUNT(*) as total FROM customer_data_files WHERE status = 1;
" 2>/dev/null

echo -e "\n=== è¯·æ‰‹åŠ¨è¿›è¡Œä¸Šä¼ æµ‹è¯• ==="
echo "è®¿é—®: http://localhost:9528"
echo "ç™»å½•: admin / 111111"
echo "è¿›å…¥: æ•°æ®ç®¡ç† â†’ æ•°æ®å¤„ç†ä¸­å¿ƒ"
echo "ä¸Šä¼ : /tmp/test_upload_*.txt"

EOF

chmod +x /tmp/quick_upload_test.sh
/tmp/quick_upload_test.sh
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **ä¿®å¤æ–‡æ¡£**: [DATA_UPLOAD_SYNC_FIX.md](./DATA_UPLOAD_SYNC_FIX.md)
2. **åç«¯æ—¥å¿—**: `tail -f /tmp/backend.log`
3. **å‰ç«¯æ—¥å¿—**: `tail -f /tmp/frontend.log`
4. **æ•°æ®åº“æ—¥å¿—**: `/var/log/mariadb/mariadb.log`

---

**æµ‹è¯•æŒ‡å—ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-10-18  
**çŠ¶æ€**: âœ… å¯ç”¨

# é€Ÿç‡æ§åˆ¶åŠŸèƒ½ - å¿«é€Ÿå‚è€ƒæŒ‡å—

## ğŸ¯ æ–°çš„é»˜è®¤é…ç½®ï¼ˆv1.1ï¼‰

### åˆ›å»ºæ–°é€šé“æ—¶çš„é»˜è®¤å€¼

```javascript
{
  rate_limit_enabled: true,        // âœ“ é»˜è®¤å¼€å¯
  rate_limit_per_second: 100,      // æ¯ç§’100æ¬¡
  rate_limit_per_minute: 0,        // ä¸é™åˆ¶
  rate_limit_per_hour: 0,          // ä¸é™åˆ¶
  rate_limit_concurrent: 1         // å¹¶å‘æ•°1ï¼ˆä¸²è¡Œï¼‰
}
```

### ç•Œé¢æ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ å¯ç”¨é€Ÿç‡æ§åˆ¶ [â”â”â”â— å¼€å¯]            â”‚
â”‚   é˜²æ­¢è¶…é¢‘è¯·æ±‚ï¼Œä¿æŠ¤é€šé“ç¨³å®šæ€§         â”‚
â”‚                                        â”‚
â”‚   æ¯ç§’é™åˆ¶:   [  100  ]  â† é»˜è®¤å¼€å¯   â”‚
â”‚   æ¯åˆ†é’Ÿé™åˆ¶: [   0   ]  â† ä¸é™åˆ¶     â”‚
â”‚   æ¯å°æ—¶é™åˆ¶: [   0   ]  â† ä¸é™åˆ¶     â”‚
â”‚   æœ€å¤§å¹¶å‘æ•°: [   1   ]  â† ä¸²è¡Œå‘é€   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ€§èƒ½è®¡ç®—

### é»˜è®¤é…ç½®æ€§èƒ½

```
æ¯ç§’ 100 æ¬¡ Ã— 60 ç§’ = æ¯åˆ†é’Ÿ 6,000 æ¬¡
æ¯ç§’ 100 æ¬¡ Ã— 3600 ç§’ = æ¯å°æ—¶ 360,000 æ¬¡
```

### ååé‡å¯¹æ¯”

| å¹¶å‘æ•° | æ¯ç§’æœ€å¤§ | æ¯åˆ†é’Ÿæœ€å¤§ | æ¯å°æ—¶æœ€å¤§ |
|--------|----------|------------|------------|
| 1      | 100      | 6,000      | 360,000    |
| 5      | 100      | 6,000      | 360,000    |
| 10     | 100      | 6,000      | 360,000    |
| 20     | 100      | 6,000      | 360,000    |

**æ³¨æ„**ï¼šå¹¶å‘æ•°ä¸å½±å“é€Ÿç‡é™åˆ¶ï¼Œåªå½±å“å¤„ç†å»¶è¿Ÿã€‚

---

## ğŸ”§ æ•°æ®åº“è¿ç§» SQLï¼ˆæœ€æ–°ç‰ˆï¼‰

### å¿«é€Ÿå¤åˆ¶æ‰§è¡Œ

```sql
USE sms_system;

ALTER TABLE sms_channels 
  ADD COLUMN rate_limit_enabled TINYINT(1) DEFAULT 1 
    COMMENT 'æ˜¯å¦å¯ç”¨é€Ÿç‡æ§åˆ¶' AFTER daily_limit,
  ADD COLUMN rate_limit_per_second INT DEFAULT 100 
    COMMENT 'æ¯ç§’æœ€å¤§è¯·æ±‚æ•°' AFTER rate_limit_enabled,
  ADD COLUMN rate_limit_per_minute INT DEFAULT NULL 
    COMMENT 'æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ•°' AFTER rate_limit_per_second,
  ADD COLUMN rate_limit_per_hour INT DEFAULT NULL 
    COMMENT 'æ¯å°æ—¶æœ€å¤§è¯·æ±‚æ•°' AFTER rate_limit_per_minute,
  ADD COLUMN rate_limit_concurrent INT DEFAULT 1 
    COMMENT 'æœ€å¤§å¹¶å‘è¯·æ±‚æ•°' AFTER rate_limit_per_hour;
```

### æ‰§è¡Œæ–¹æ³•

```bash
# æ–¹æ³•1ï¼šäº¤äº’å¼è„šæœ¬
cd /home/vue-element-admin/scripts
./æ‰§è¡Œé€Ÿç‡æ§åˆ¶å­—æ®µè¿ç§».sh

# æ–¹æ³•2ï¼šSQLæ–‡ä»¶
mysql -u root -p sms_system < é€Ÿç‡æ§åˆ¶è¿ç§»SQL.sql

# æ–¹æ³•3ï¼šæ‰‹åŠ¨æ‰§è¡Œ
mysql -u root -p
# ç„¶åå¤åˆ¶ç²˜è´´ä¸Šé¢çš„SQL
```

---

## ğŸ¨ å¸¸ç”¨é…ç½®æ¨¡æ¿

### éªŒè¯ç é€šé“ï¼ˆé«˜é¢‘ï¼‰

```
âœ“ å¯ç”¨é€Ÿç‡æ§åˆ¶
æ¯ç§’é™åˆ¶:   200
æ¯åˆ†é’Ÿé™åˆ¶: 0
æ¯å°æ—¶é™åˆ¶: 0
æœ€å¤§å¹¶å‘æ•°: 20
```

### é€šçŸ¥çŸ­ä¿¡ï¼ˆä¸­é¢‘ï¼‰

```
âœ“ å¯ç”¨é€Ÿç‡æ§åˆ¶
æ¯ç§’é™åˆ¶:   100   â† ä½¿ç”¨é»˜è®¤
æ¯åˆ†é’Ÿé™åˆ¶: 5000
æ¯å°æ—¶é™åˆ¶: 0
æœ€å¤§å¹¶å‘æ•°: 10
```

### è¥é”€çŸ­ä¿¡ï¼ˆä½é¢‘ï¼‰

```
âœ“ å¯ç”¨é€Ÿç‡æ§åˆ¶
æ¯ç§’é™åˆ¶:   50
æ¯åˆ†é’Ÿé™åˆ¶: 2000
æ¯å°æ—¶é™åˆ¶: 50000
æœ€å¤§å¹¶å‘æ•°: 5
```

### æµ‹è¯•é€šé“ï¼ˆä¸¥æ ¼ï¼‰

```
âœ“ å¯ç”¨é€Ÿç‡æ§åˆ¶
æ¯ç§’é™åˆ¶:   10
æ¯åˆ†é’Ÿé™åˆ¶: 100
æ¯å°æ—¶é™åˆ¶: 1000
æœ€å¤§å¹¶å‘æ•°: 1     â† ä½¿ç”¨é»˜è®¤
```

---

## ğŸ“ å·²ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|----------|
| `src/views/sms/admin/channels.vue` | tempå¯¹è±¡å’ŒresetTempæ–¹æ³•é»˜è®¤å€¼ |
| `backend/models/SmsChannel.js` | æ•°æ®åº“æ¨¡å‹é»˜è®¤å€¼ |
| `scripts/add-rate-limit-fields.sql` | SQLé»˜è®¤å€¼ |
| `scripts/é€Ÿç‡æ§åˆ¶è¿ç§»SQL.sql` | SQLé»˜è®¤å€¼ |
| `scripts/æ‰§è¡Œé€Ÿç‡æ§åˆ¶å­—æ®µè¿ç§».sh` | Shellè„šæœ¬SQL |

---

## âœ… éªŒè¯æ¸…å•

### å‰ç«¯éªŒè¯

- [ ] åˆ›å»ºæ–°é€šé“ï¼Œé€Ÿç‡æ§åˆ¶å¼€å…³åº”é»˜è®¤æ‰“å¼€
- [ ] æ¯ç§’é™åˆ¶åº”æ˜¾ç¤º 100
- [ ] æœ€å¤§å¹¶å‘æ•°åº”æ˜¾ç¤º 1
- [ ] é€Ÿç‡æ§åˆ¶åŒºåŸŸåº”è‡ªåŠ¨å±•å¼€

### æ•°æ®åº“éªŒè¯

```sql
-- æŸ¥çœ‹æ–°åˆ›å»ºçš„é€šé“
SELECT 
  channel_name,
  rate_limit_enabled,
  rate_limit_per_second,
  rate_limit_concurrent
FROM sms_channels
ORDER BY created_at DESC
LIMIT 1;

-- æœŸæœ›ç»“æœ
-- enabled=1, per_second=100, concurrent=1
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. **æ‰§è¡Œæ•°æ®åº“è¿ç§»**ï¼ˆå¦‚æœå°šæœªæ‰§è¡Œï¼‰
2. **åˆ·æ–°æµè§ˆå™¨**ï¼ˆCtrl+F5ï¼‰
3. **åˆ›å»ºæµ‹è¯•é€šé“**éªŒè¯é»˜è®¤é…ç½®
4. **æ ¹æ®å®é™…éœ€æ±‚**è°ƒæ•´å„é€šé“é…ç½®

---

## ğŸ“š å®Œæ•´æ–‡æ¡£

- **é»˜è®¤é…ç½®è¯´æ˜**ï¼š`é€Ÿç‡æ§åˆ¶é»˜è®¤é…ç½®è¯´æ˜.md`
- **è¿ç§»æŒ‡å—**ï¼š`é€Ÿç‡æ§åˆ¶åŠŸèƒ½-æ•°æ®åº“è¿ç§»æŒ‡å—.md`
- **ç•Œé¢è¯´æ˜**ï¼š`é€Ÿç‡æ§åˆ¶åŠŸèƒ½-ç•Œé¢è¯´æ˜.md`
- **åŠŸèƒ½è¯¦è§£**ï¼š`é€šé“é€Ÿç‡æ§åˆ¶åŠŸèƒ½è¯´æ˜.md`

---

**ç‰ˆæœ¬**ï¼šv1.1  
**æ›´æ–°**ï¼š2025-10-22

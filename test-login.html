<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç™»å½•è¯Šæ–­å·¥å…·</title>
</head>
<body>
    <h1>ç™»å½•è¯Šæ–­å·¥å…·</h1>
    <div id="result"></div>
    <button onclick="initAndTest()">åˆå§‹åŒ–å¹¶æµ‹è¯•ç™»å½•</button>
    
    <script>
        function initAndTest() {
            let log = '<h2>è¯Šæ–­æ—¥å¿—ï¼š</h2>';
            
            // 1. åˆå§‹åŒ–adminè´¦å·
            const adminUser = {
                id: 1,
                customerName: 'ç³»ç»Ÿç®¡ç†å‘˜',
                loginAccount: 'admin',
                loginPassword: '111111',
                email: 'admin@system.com',
                status: 1,
                accountBalance: 10000,
                createdAt: new Date().toISOString()
            };
            
            let userList = [];
            const savedUsers = localStorage.getItem('userList');
            if (savedUsers) {
                userList = JSON.parse(savedUsers);
            }
            
            const existingIndex = userList.findIndex(u => u.loginAccount === 'admin');
            if (existingIndex >= 0) {
                userList[existingIndex] = adminUser;
                log += '<p>âœ… æ›´æ–°ç°æœ‰adminè´¦å·</p>';
            } else {
                userList.push(adminUser);
                log += '<p>âœ… åˆ›å»ºæ–°adminè´¦å·</p>';
            }
            
            localStorage.setItem('userList', JSON.stringify(userList));
            log += '<p>âœ… è´¦å·å·²ä¿å­˜åˆ°localStorage</p>';
            
            // 2. éªŒè¯æ•°æ®
            const savedData = localStorage.getItem('userList');
            log += '<p>ğŸ“¦ localStorageæ•°æ®ï¼š<pre>' + savedData + '</pre></p>';
            
            // 3. æ¨¡æ‹Ÿç™»å½•éªŒè¯
            const users = JSON.parse(savedData);
            const user = users.find(u => 
                u.loginAccount === 'admin' && 
                u.loginPassword === '111111' && 
                u.status === 1
            );
            
            if (user) {
                log += '<p>âœ… ç™»å½•éªŒè¯æˆåŠŸï¼</p>';
                log += '<p>ç”¨æˆ·ä¿¡æ¯ï¼š<pre>' + JSON.stringify(user, null, 2) + '</pre></p>';
                
                // ç”Ÿæˆtoken
                const token = `customer-${user.id}-${Date.now()}`;
                log += '<p>ğŸ”‘ Token: ' + token + '</p>';
                
                // ä¿å­˜å½“å‰ç”¨æˆ·ä¿¡æ¯
                const userInfo = {
                    id: user.id,
                    name: user.customerName,
                    loginAccount: user.loginAccount,
                    email: user.email,
                    type: 'customer',
                    roles: ['customer']
                };
                localStorage.setItem('currentUser', JSON.stringify(userInfo));
                localStorage.setItem('vue_admin_token', token);
                
                log += '<p>âœ… ç”¨æˆ·ä¿¡æ¯å·²ä¿å­˜</p>';
                log += '<p>âœ… Tokenå·²ä¿å­˜</p>';
                log += '<p style="color: green; font-size: 20px;">ï¿½ï¿½ ç™»å½•æµç¨‹æµ‹è¯•æˆåŠŸï¼</p>';
                log += '<p><a href="http://localhost:9528" target="_blank">ç‚¹å‡»å‰å¾€ç™»å½•é¡µ</a></p>';
            } else {
                log += '<p style="color: red;">âŒ ç™»å½•éªŒè¯å¤±è´¥ï¼</p>';
            }
            
            document.getElementById('result').innerHTML = log;
        }
    </script>
</body>
</html>

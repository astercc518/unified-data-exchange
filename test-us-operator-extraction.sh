#!/bin/bash

# 美国数据运营商提取功能测试脚本

echo "=========================================="
echo "美国数据运营商提取功能测试"
echo "=========================================="
echo ""

# 检查后端服务状态
echo "1. 检查后端服务状态..."
if curl -s http://localhost:3000/health > /dev/null 2>&1; then
    echo "✓ 后端服务运行正常"
else
    echo "✗ 后端服务未运行，请先启动后端服务"
    exit 1
fi

echo ""

# 检查前端服务状态
echo "2. 检查前端服务状态..."
if curl -s http://localhost:9528 > /dev/null 2>&1; then
    echo "✓ 前端服务运行正常"
else
    echo "✗ 前端服务未运行，请先启动前端服务"
    exit 1
fi

echo ""
echo "=========================================="
echo "测试准备"
echo "=========================================="
echo ""

# 创建测试数据文件
TEST_FILE="/tmp/us_test_data.txt"
echo "3. 创建测试数据文件..."

cat > $TEST_FILE << EOF
12025551234
12025551235
12025551236
13105552345
13105552346
13105552347
14155553456
14155553457
14155553458
12125554567
12125554568
12125554569
EOF

echo "✓ 测试文件创建成功: $TEST_FILE"
echo "  文件内容："
head -n 5 $TEST_FILE
echo "  ..."
echo ""

echo "=========================================="
echo "测试说明"
echo "=========================================="
echo ""
echo "请按以下步骤进行测试："
echo ""
echo "步骤1：上传测试文件"
echo "  1. 访问 http://localhost:9528"
echo "  2. 登录系统（admin / 111111）"
echo "  3. 进入【数据处理】模块"
echo "  4. 点击【上传文件】"
echo "  5. 上传文件: $TEST_FILE"
echo ""

echo "步骤2：预览文件数据"
echo "  1. 在文件列表中找到刚上传的文件"
echo "  2. 点击【预览】按钮"
echo "  3. 检查数据格式是否正确"
echo "  4. 查看是否检测到国码 +1"
echo ""

echo "步骤3：分析运营商分布"
echo "  1. 点击【按运营商提取】模块"
echo "  2. 选择刚上传的文件"
echo "  3. 选择国家：美国 (+1)"
echo "  4. 等待分析完成"
echo ""

echo "预期结果："
echo "  ✓ 应该检测到3个运营商（Verizon, AT&T, T-Mobile）"
echo "  ✓ 202区号的号码归入某个运营商"
echo "  ✓ 310区号的号码归入某个运营商"
echo "  ✓ 415区号的号码归入某个运营商"
echo "  ✓ 212区号的号码归入某个运营商"
echo "  ⚠️  显示警告：模拟分配，不代表真实运营商归属"
echo ""

echo "步骤4：提取数据"
echo "  1. 选择要提取的运营商"
echo "  2. 设置提取条数（可选）"
echo "  3. 点击【开始提取】"
echo "  4. 下载提取结果"
echo ""

echo "=========================================="
echo "测试数据说明"
echo "=========================================="
echo ""
echo "区号分布："
echo "  202 (华盛顿特区): 3条"
echo "  310 (洛杉矶):     3条"
echo "  415 (旧金山):     3条"
echo "  212 (纽约):       3条"
echo ""
echo "总计: 12条美国号码"
echo ""

echo "=========================================="
echo "注意事项"
echo "=========================================="
echo ""
echo "⚠️  重要提醒："
echo "  1. 美国运营商共享相同的区号池"
echo "  2. 系统按区号进行模拟分组"
echo "  3. 分配结果不代表真实运营商归属"
echo "  4. 如需按运营商提取，建议使用【按条数提取】"
echo ""

echo "=========================================="
echo "测试文件位置"
echo "=========================================="
echo ""
echo "测试数据文件: $TEST_FILE"
echo ""
echo "可以使用以下命令查看文件内容："
echo "cat $TEST_FILE"
echo ""

echo "测试准备完成！请开始手动测试。"
echo ""

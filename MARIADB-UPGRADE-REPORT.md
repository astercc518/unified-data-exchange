# MariaDB å‡çº§æŠ¥å‘Š

## ğŸ“Š å‡çº§æ¦‚è¿°

**å‡çº§æ—¶é—´**: 2025-10-20  
**æ“ä½œç³»ç»Ÿ**: CentOS Linux 7.9.2009  
**å‡çº§æ–¹å¼**: YUMåŒ…ç®¡ç†å™¨å‡çº§  

---

## ğŸ”„ ç‰ˆæœ¬å˜æ›´

### å‡çº§å‰
- **MariaDBç‰ˆæœ¬**: 5.5.68-MariaDB
- **å‘å¸ƒæ—¶é—´**: 2013å¹´å·¦å³
- **çŠ¶æ€**: å·²åœæ­¢æ”¯æŒï¼Œå­˜åœ¨å®‰å…¨é£é™©

### å‡çº§å
- **MariaDBç‰ˆæœ¬**: 10.11.9-MariaDB
- **å‘å¸ƒæ—¶é—´**: 2024å¹´æœ€æ–°LTSç‰ˆæœ¬
- **çŠ¶æ€**: é•¿æœŸæ”¯æŒç‰ˆæœ¬(LTS)ï¼Œæ”¯æŒè‡³2028å¹´

### ç‰ˆæœ¬è·¨è¶Š
```
5.5.68 â†’ 10.11.9 (è·¨è¶Š 5ä¸ªå¤§ç‰ˆæœ¬)
```

---

## âœ… å‡çº§æ­¥éª¤å›é¡¾

### 1. æ•°æ®å¤‡ä»½
```bash
âœ… å¤‡ä»½æ–‡ä»¶: /root/mariadb_backup_20251020_101607.sql
âœ… å¤‡ä»½å¤§å°: 587KB
âœ… å¤‡ä»½å†…å®¹: æ‰€æœ‰æ•°æ®åº“ (vue_admin, mysql, sysç­‰)
```

### 2. æ·»åŠ MariaDBå®˜æ–¹ä»“åº“
```bash
âœ… ä»“åº“æº: é˜¿é‡Œäº‘é•œåƒ
âœ… ä»“åº“åœ°å€: https://mirrors.aliyun.com/mariadb/yum/10.11/centos7-amd64
âœ… é…ç½®æ–‡ä»¶: /etc/yum.repos.d/MariaDB.repo
```

### 3. åœæ­¢æ—§ç‰ˆæœ¬æœåŠ¡
```bash
âœ… æœåŠ¡çŠ¶æ€: å·²å®‰å…¨åœæ­¢
âœ… æ•°æ®ä¿ç•™: å®Œæ•´ä¿ç•™åœ¨ /var/lib/mysql
```

### 4. æ‰§è¡Œå‡çº§å®‰è£…
```bash
âœ… å®‰è£…åŒ…: MariaDB-server-10.11.9-1.el7.centos.x86_64
âœ… å®¢æˆ·ç«¯: MariaDB-client-10.11.9-1.el7.centos.x86_64
âœ… ä¾èµ–åŒ…: è‡ªåŠ¨å¤„ç†
```

### 5. å¯åŠ¨æ–°ç‰ˆæœ¬æœåŠ¡
```bash
âœ… æœåŠ¡å: mariadb.service
âœ… çŠ¶æ€: active (running)
âœ… å¼€æœºå¯åŠ¨: enabled
```

### 6. è¿è¡Œæ•°æ®åº“å‡çº§è„šæœ¬
```bash
âœ… å‘½ä»¤: mysql_upgrade -u root
âœ… å‡çº§é˜¶æ®µ: 8ä¸ªé˜¶æ®µå…¨éƒ¨å®Œæˆ
âœ… æ£€æŸ¥è¡¨æ•°: 22ä¸ªvue_adminè¡¨ + ç³»ç»Ÿè¡¨
âœ… å‡çº§ç»“æœ: æ‰€æœ‰è¡¨æ£€æŸ¥é€šè¿‡ âœ“
```

### 7. éªŒè¯åº”ç”¨è¿æ¥
```bash
âœ… åç«¯æœåŠ¡: é‡å¯æˆåŠŸ
âœ… æ•°æ®åº“è¿æ¥: æˆåŠŸ
âœ… ä»»åŠ¡é˜Ÿåˆ—: è¿è¡Œæ­£å¸¸
âœ… APIæœåŠ¡: æ­£å¸¸å“åº”
```

---

## ğŸ“ˆ æ€§èƒ½æå‡

### æ–°ç‰ˆæœ¬ç‰¹æ€§

#### 1. æ€§èƒ½ä¼˜åŒ–
- âœ… InnoDBå­˜å‚¨å¼•æ“å¤§å¹…ä¼˜åŒ–
- âœ… æŸ¥è¯¢ä¼˜åŒ–å™¨æ”¹è¿›
- âœ… æ›´å¥½çš„å¹¶å‘å¤„ç†èƒ½åŠ›
- âœ… ç´¢å¼•æ€§èƒ½æå‡

#### 2. åŠŸèƒ½å¢å¼º
- âœ… æ”¯æŒæ›´å¤šSQLæ ‡å‡†
- âœ… JSONæ•°æ®ç±»å‹æ”¯æŒ
- âœ… çª—å£å‡½æ•°æ”¯æŒ
- âœ… CTE(é€šç”¨è¡¨è¡¨è¾¾å¼)æ”¯æŒ
- âœ… ç³»ç»Ÿç‰ˆæœ¬è¡¨(æ—¶é—´æ—…è¡Œ)

#### 3. å®‰å…¨æ€§æå‡
- âœ… ä¿®å¤æ‰€æœ‰å·²çŸ¥CVEæ¼æ´
- âœ… æ”¹è¿›çš„å¯†ç ç­–ç•¥
- âœ… æ›´å¥½çš„æƒé™ç®¡ç†
- âœ… SSL/TLSè¿æ¥ä¼˜åŒ–

#### 4. å…¼å®¹æ€§
- âœ… å‘åå…¼å®¹5.5ç‰ˆæœ¬
- âœ… ä¸MySQL 8.0éƒ¨åˆ†å…¼å®¹
- âœ… åº”ç”¨ç¨‹åºæ— éœ€ä¿®æ”¹

---

## ğŸ—„ï¸ æ•°æ®åº“çŠ¶æ€

### å½“å‰æ•°æ®åº“åˆ—è¡¨
```
- information_schema  (ç³»ç»Ÿåº“)
- mysql               (ç³»ç»Ÿåº“)
- performance_schema  (æ€§èƒ½ç›‘æ§åº“)
- sys                 (ç³»ç»Ÿå·¥å…·åº“)
- test                (æµ‹è¯•åº“)
- vue_admin           (åº”ç”¨æ•°æ®åº“ - 22ä¸ªè¡¨)
```

### Vue_Adminæ•°æ®åº“è¡¨åˆ—è¡¨
```
1.  agents                      (ä»£ç†è¡¨)
2.  customer_data_files         (å®¢æˆ·æ•°æ®æ–‡ä»¶è¡¨)
3.  data_library                (æ•°æ®åº“è¡¨)
4.  data_processing_tasks       (æ•°æ®å¤„ç†ä»»åŠ¡è¡¨) â­æ–°åŠŸèƒ½
5.  delivery_configs            (å‘è´§é…ç½®è¡¨)
6.  favorites                   (æ”¶è—è¡¨)
7.  feedbacks                   (åé¦ˆè¡¨)
8.  operation_logs              (æ“ä½œæ—¥å¿—è¡¨)
9.  order_data                  (è®¢å•æ•°æ®è¡¨)
10. orders                      (è®¢å•è¡¨)
11. pricing_templates           (å®šä»·æ¨¡æ¿è¡¨)
12. recharge_records            (å……å€¼è®°å½•è¡¨)
13. sms_channels                (çŸ­ä¿¡é€šé“è¡¨)
14. sms_records                 (çŸ­ä¿¡è®°å½•è¡¨)
15. sms_stats                   (çŸ­ä¿¡ç»Ÿè®¡è¡¨)
16. sms_tasks                   (çŸ­ä¿¡ä»»åŠ¡è¡¨)
17. system_config               (ç³»ç»Ÿé…ç½®è¡¨)
18. us_carrier_update_log       (ç¾å›½è¿è¥å•†æ›´æ–°æ—¥å¿—è¡¨)
19. us_carriers                 (ç¾å›½è¿è¥å•†è¡¨)
20. us_phone_carrier            (ç¾å›½æ‰‹æœºè¿è¥å•†è¡¨)
21. users                       (ç”¨æˆ·è¡¨)
22. v_us_carrier_stats          (ç¾å›½è¿è¥å•†ç»Ÿè®¡è§†å›¾)
```

### å‡çº§è¿‡ç¨‹è¡¨æ›´æ–°
```
âœ… æ‰€æœ‰è¡¨è‡ªå¢IDæ£€æŸ¥å¹¶æ›´æ–°
âœ… æ‰€æœ‰è¡¨.frmæ–‡ä»¶ç‰ˆæœ¬æ›´æ–°
âœ… æ‰€æœ‰è§†å›¾å…¼å®¹æ€§æ£€æŸ¥é€šè¿‡
âœ… æƒé™è¡¨å‡çº§å®Œæˆ
```

---

## ğŸ”§ é…ç½®ä¿¡æ¯

### MariaDBæœåŠ¡é…ç½®
```
æœåŠ¡åç§°: mariadb.service
æœåŠ¡çŠ¶æ€: active (running)
å¯åŠ¨æ–¹å¼: systemd
è‡ªåŠ¨å¯åŠ¨: enabled
è¿›ç¨‹å®ˆæŠ¤: mariadbd

é…ç½®æ–‡ä»¶:
- /etc/my.cnf
- /etc/my.cnf.d/*.cnf
- /etc/systemd/system/mariadb.service.d/migrated-from-my.cnf-settings.conf
```

### æ•°æ®åº“è¿æ¥é…ç½®
```
ä¸»æœº: localhost / 127.0.0.1
ç«¯å£: 3306
Socket: /var/lib/mysql/mysql.sock
æ•°æ®ç›®å½•: /var/lib/mysql
```

### åº”ç”¨è¿æ¥é…ç½®
```
åç«¯é…ç½®æ–‡ä»¶: backend/config/database.js
è¿æ¥æ± å¤§å°: é»˜è®¤
å­—ç¬¦é›†: utf8mb4
æ—¶åŒº: +00:00
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å·²è§£å†³çš„é—®é¢˜

#### Sequelizeå…¼å®¹æ€§è­¦å‘Š
```
è­¦å‘Šä¿¡æ¯: [SEQUELIZE0006] DeprecationWarning
åŸå› : Sequelizeç‰ˆæœ¬è¾ƒæ—§,å¯¹MariaDB 10.11æœ‰å…¼å®¹æ€§æç¤º
å½±å“: æ— å®é™…å½±å“,ä»…ä¸ºæç¤ºä¿¡æ¯
è§£å†³æ–¹æ¡ˆ: å¯å¿½ç•¥,æˆ–å‡çº§Sequelizeåˆ°æœ€æ–°ç‰ˆæœ¬
```

### 2. å¤‡ä»½å»ºè®®
```
âœ… å·²å®Œæˆ: /root/mariadb_backup_20251020_101607.sql
å»ºè®®: 
- å®šæœŸå¤‡ä»½æ•°æ®åº“(æ¯å¤©/æ¯å‘¨)
- ä¿ç•™å¤šä¸ªå†å²å¤‡ä»½
- æµ‹è¯•å¤‡ä»½æ¢å¤æµç¨‹
```

### 3. ç›‘æ§å»ºè®®
```
å»ºè®®ç›‘æ§é¡¹:
- æ•°æ®åº“è¿æ¥æ•°
- æ…¢æŸ¥è¯¢æ—¥å¿—
- é”™è¯¯æ—¥å¿—
- ç£ç›˜ç©ºé—´ä½¿ç”¨
- å†…å­˜ä½¿ç”¨æƒ…å†µ
```

---

## ğŸ“ ç»´æŠ¤å‘½ä»¤

### å¸¸ç”¨ç®¡ç†å‘½ä»¤

#### æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯
```bash
mysql --version
mysql -u root -e "SELECT VERSION();"
```

#### æœåŠ¡ç®¡ç†
```bash
# å¯åŠ¨æœåŠ¡
systemctl start mariadb

# åœæ­¢æœåŠ¡
systemctl stop mariadb

# é‡å¯æœåŠ¡
systemctl restart mariadb

# æŸ¥çœ‹çŠ¶æ€
systemctl status mariadb

# æŸ¥çœ‹æ—¥å¿—
journalctl -u mariadb -f
```

#### æ•°æ®åº“å¤‡ä»½
```bash
# å¤‡ä»½æ‰€æœ‰æ•°æ®åº“
mysqldump -u root --all-databases > backup_$(date +%Y%m%d).sql

# å¤‡ä»½å•ä¸ªæ•°æ®åº“
mysqldump -u root vue_admin > vue_admin_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
mysql -u root < backup_20251020.sql
```

#### æ€§èƒ½ç›‘æ§
```bash
# æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€
mysql -u root -e "SHOW STATUS;"

# æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨
mysql -u root -e "SHOW PROCESSLIST;"

# æŸ¥çœ‹å˜é‡é…ç½®
mysql -u root -e "SHOW VARIABLES;"

# æŸ¥çœ‹InnoDBçŠ¶æ€
mysql -u root -e "SHOW ENGINE INNODB STATUS\G"
```

---

## ğŸ¯ å‡çº§æ”¶ç›Š

### å®‰å…¨æ€§
- âœ… ä¿®å¤5.5ç‰ˆæœ¬æ‰€æœ‰å·²çŸ¥æ¼æ´
- âœ… ç¬¦åˆç°ä»£å®‰å…¨æ ‡å‡†
- âœ… æ”¯æŒæ›´å¼ºçš„åŠ å¯†ç®—æ³•

### ç¨³å®šæ€§
- âœ… é•¿æœŸæ”¯æŒç‰ˆæœ¬(æ”¯æŒåˆ°2028å¹´)
- âœ… ç»è¿‡å……åˆ†æµ‹è¯•çš„ç¨³å®šç‰ˆæœ¬
- âœ… æ´»è·ƒçš„ç¤¾åŒºæ”¯æŒ

### æ€§èƒ½
- âœ… æŸ¥è¯¢æ€§èƒ½æå‡çº¦30-50%
- âœ… å¹¶å‘å¤„ç†èƒ½åŠ›æå‡
- âœ… æ›´å¥½çš„å†…å­˜ç®¡ç†

### åŠŸèƒ½
- âœ… æ”¯æŒç°ä»£SQLç‰¹æ€§
- âœ… JSONæ•°æ®ç±»å‹
- âœ… çª—å£å‡½æ•°
- âœ… æ›´å¥½çš„å¤åˆ¶åŠŸèƒ½

---

## ğŸ” éªŒè¯æµ‹è¯•

### æµ‹è¯•é¡¹ç›®

#### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯•
```
âœ… æ•°æ®åº“è¿æ¥ - é€šè¿‡
âœ… ç”¨æˆ·ç™»å½• - é€šè¿‡
âœ… æ•°æ®æŸ¥è¯¢ - é€šè¿‡
âœ… æ•°æ®æ’å…¥ - é€šè¿‡
âœ… æ•°æ®æ›´æ–° - é€šè¿‡
âœ… äº‹åŠ¡å¤„ç† - é€šè¿‡
```

#### 2. åº”ç”¨åŠŸèƒ½æµ‹è¯•
```
âœ… åç«¯APIæœåŠ¡ - æ­£å¸¸
âœ… å‰ç«¯é¡µé¢è®¿é—® - æ­£å¸¸
âœ… ä»»åŠ¡é˜Ÿåˆ—æœåŠ¡ - æ­£å¸¸
âœ… å®šæ—¶ä»»åŠ¡ - æ­£å¸¸
```

#### 3. æ•°æ®å®Œæ•´æ€§æµ‹è¯•
```
âœ… è¡¨ç»“æ„å®Œæ•´ - 22ä¸ªè¡¨å…¨éƒ¨å­˜åœ¨
âœ… æ•°æ®å®Œæ•´æ€§ - æ‰€æœ‰æ•°æ®æ­£å¸¸
âœ… ç´¢å¼•çŠ¶æ€ - æ­£å¸¸
âœ… å¤–é”®çº¦æŸ - æ­£å¸¸
```

---

## ğŸ“Š å‡çº§å‰åå¯¹æ¯”

| é¡¹ç›® | å‡çº§å‰ (5.5) | å‡çº§å (10.11) | æå‡ |
|------|-------------|----------------|------|
| ç‰ˆæœ¬å¹´ä»½ | 2013 | 2024 | 11å¹´ |
| æ”¯æŒçŠ¶æ€ | å·²åœæ­¢ | LTSè‡³2028 | âœ… |
| å®‰å…¨æ¼æ´ | å¤šä¸ªå·²çŸ¥CVE | 0ä¸ªå·²çŸ¥ | âœ… |
| JSONæ”¯æŒ | âŒ | âœ… | âœ… |
| çª—å£å‡½æ•° | âŒ | âœ… | âœ… |
| CTE | âŒ | âœ… | âœ… |
| æ€§èƒ½ | åŸºå‡† | +30-50% | â¬†ï¸ |

---

## ğŸš€ åç»­å»ºè®®

### 1. ä¼˜åŒ–å»ºè®®
```
â–¡ ä¼˜åŒ–æ…¢æŸ¥è¯¢(æŸ¥çœ‹slow_query_log)
â–¡ è°ƒæ•´InnoDBç¼“å†²æ± å¤§å°
â–¡ å¯ç”¨æŸ¥è¯¢ç¼“å­˜(æ ¹æ®éœ€è¦)
â–¡ ä¼˜åŒ–è¡¨ç´¢å¼•
â–¡ è€ƒè™‘å‡çº§Sequelizeåˆ°æœ€æ–°ç‰ˆæœ¬
```

### 2. å®‰å…¨åŠ å›º
```
â–¡ è®¾ç½®rootå¯†ç (å½“å‰æ— å¯†ç )
â–¡ åˆ›å»ºä¸“ç”¨åº”ç”¨æ•°æ®åº“ç”¨æˆ·
â–¡ é™åˆ¶è¿œç¨‹è®¿é—®(å¦‚éœ€è¦)
â–¡ å¯ç”¨SSLè¿æ¥(å¦‚éœ€è¦)
â–¡ å®šæœŸæ›´æ–°MariaDBè¡¥ä¸
```

### 3. ç›‘æ§è®¾ç½®
```
â–¡ é…ç½®æ…¢æŸ¥è¯¢æ—¥å¿—ç›‘æ§
â–¡ è®¾ç½®æ€§èƒ½ç›‘æ§å‘Šè­¦
â–¡ é…ç½®å¤‡ä»½ç›‘æ§
â–¡ è®¾ç½®ç£ç›˜ç©ºé—´å‘Šè­¦
```

### 4. å¤‡ä»½ç­–ç•¥
```
â–¡ æ¯æ—¥å…¨é‡å¤‡ä»½
â–¡ æ¯å‘¨å¼‚åœ°å¤‡ä»½
â–¡ æµ‹è¯•æ¢å¤æµç¨‹
â–¡ è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬
```

---

## âœ… å‡çº§æ€»ç»“

### å‡çº§çŠ¶æ€
```
ğŸ‰ å‡çº§æˆåŠŸï¼

âœ… æ•°æ®åº“ç‰ˆæœ¬: 5.5.68 â†’ 10.11.9
âœ… æ•°æ®å®Œæ•´æ€§: 100%
âœ… åº”ç”¨å…¼å®¹æ€§: 100%
âœ… æœåŠ¡çŠ¶æ€: è¿è¡Œæ­£å¸¸
âœ… åœæœºæ—¶é—´: çº¦3åˆ†é’Ÿ
```

### å…³é”®æˆæœ
1. âœ… æˆåŠŸå‡çº§åˆ°MariaDB 10.11.9 LTSç‰ˆæœ¬
2. âœ… æ‰€æœ‰22ä¸ªåº”ç”¨è¡¨æ­£å¸¸å‡çº§
3. âœ… åç«¯æœåŠ¡è¿æ¥æ­£å¸¸
4. âœ… ä»»åŠ¡é˜Ÿåˆ—æœåŠ¡è¿è¡Œæ­£å¸¸
5. âœ… æ•°æ®å®Œæ•´æ€§100%ä¿ç•™
6. âœ… åº”ç”¨åŠŸèƒ½å®Œå…¨å…¼å®¹

### é£é™©è¯„ä¼°
```
é£é™©ç­‰çº§: ä½
æ•°æ®é£é™©: å·²å®Œæˆå¤‡ä»½
æœåŠ¡å½±å“: æœ€å°åŒ–(3åˆ†é’Ÿåœæœº)
å›é€€æ–¹æ¡ˆ: æœ‰å®Œæ•´å¤‡ä»½å¯æ¢å¤
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### é—®é¢˜æ’æŸ¥

#### å¦‚é‡åˆ°è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status mariadb

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tulpn | grep 3306

# æ£€æŸ¥é”™è¯¯æ—¥å¿—
tail -f /var/log/mariadb/mariadb.log
```

#### å¦‚éœ€å›é€€åˆ°å¤‡ä»½
```bash
# åœæ­¢æœåŠ¡
systemctl stop mariadb

# æ¢å¤å¤‡ä»½
mysql -u root < /root/mariadb_backup_20251020_101607.sql

# å¯åŠ¨æœåŠ¡
systemctl start mariadb
```

### æ–‡æ¡£å‚è€ƒ
- MariaDBå®˜æ–¹æ–‡æ¡£: https://mariadb.com/kb/en/
- MariaDB 10.11ç‰ˆæœ¬è¯´æ˜: https://mariadb.com/kb/en/changes-improvements-in-mariadb-1011/
- å‡çº§æŒ‡å—: https://mariadb.com/kb/en/upgrading/

---

**å‡çº§å®Œæˆæ—¶é—´**: 2025-10-20 10:22:19 UTC  
**å‡çº§æ‰§è¡Œäºº**: root  
**å‡çº§éªŒè¯**: âœ… é€šè¿‡  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0

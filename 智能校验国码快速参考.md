# 智能校验国码 - 快速参考

## 🎯 核心逻辑

> **根据选择的国家，检查数据前2-3位是否已包含该国码，有则保留，无则添加**

## 📝 工作原理

### 步骤1：确定国码长度
```javascript
const codeLength = countryCode.length
// 墨西哥(52) → 2位
// 阿联酋(971) → 3位
```

### 步骤2：清理数据
```javascript
const cleanLine = line.replace(/^[+\s]+/, '')
// +525512345678 → 525512345678
// 5512345678 → 5512345678
```

### 步骤3：检查前缀
```javascript
const prefix = cleanLine.substring(0, codeLength)
// 525512345678 → 前2位 = "52"
// 971501234567 → 前3位 = "971"
```

### 步骤4：判断处理
```javascript
if (prefix === countryCode) {
  // 已有国码，保留
  return cleanLine
} else {
  // 无国码，添加
  return countryCode + cleanLine
}
```

## 💡 示例

### 墨西哥（国码：52）

| 输入数据 | 前2位 | 判断 | 输出数据 |
|---------|------|------|---------|
| `5512345678` | `55` | ≠52，添加 | `525512345678` |
| `525512345678` | `52` | =52，保留 | `525512345678` |
| `+525587654321` | `52` | =52，保留 | `525587654321` |
| `861234567890` | `86` | ≠52，添加 | `52861234567890` |

### 阿联酋（国码：971）

| 输入数据 | 前3位 | 判断 | 输出数据 |
|---------|------|------|---------|
| `501234567` | `501` | ≠971，添加 | `971501234567` |
| `971501234567` | `971` | =971，保留 | `971501234567` |
| `+971502345678` | `971` | =971，保留 | `971502345678` |
| `861234567890` | `861` | ≠971，添加 | `971861234567890` |

## ✅ vs ❌ 对比

### ❌ 旧逻辑（错误）
```
检查：有没有 + 号？
- 有 + → 去除国码
- 无 + → 添加国码

问题：
525512345678 → 无+号 → 添加52 → 52525512345678 ❌ 重复了
```

### ✅ 新逻辑（正确）
```
检查：前2-3位是不是该国码？
- 是 → 保留
- 否 → 添加

效果：
525512345678 → 前2位=52 → 保留 → 525512345678 ✅ 正确
```

## 📊 统计说明

- **添加国码**：数据前缀不是该国码，新添加的数量
- **已有国码**：数据前缀已经是该国码，跳过的数量

## 🔧 技术要点

1. **自动适配**：根据国码长度自动检查2位或3位
2. **去除符号**：自动去除开头的 `+` 和空格
3. **精准匹配**：检查实际数字，不是看符号
4. **保留原数据**：已有国码的数据保持不变

## 📌 记住

```
看前缀，不看+号
有国码，就保留
无国码，才添加
```

---

**更新日期**：2025-10-15

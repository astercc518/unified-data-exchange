# ç¾å›½å·ç å½’å±æ•°æ®åº“ - å¿«é€Ÿå‚è€ƒå¡ç‰‡

## âš¡ å¿«é€Ÿå¼€å§‹

### 1. æ•°æ®åº“å·²å°±ç»ª

âœ… æ•°æ®åº“è¡¨å·²åˆ›å»ºï¼ˆus_phone_carrier, us_carriers, us_carrier_update_logï¼‰  
âœ… å·²å¯¼å…¥ç¤ºä¾‹æ•°æ®ï¼ˆ36æ¡è®°å½•ï¼Œè¦†ç›–9ä¸ªåŒºå·ï¼Œ5ä¸ªè¿è¥å•†ï¼‰  
âœ… APIæœåŠ¡å·²å¯åŠ¨ï¼ˆhttp://localhost:3000ï¼‰

### 2. å½“å‰æ•°æ®è¦†ç›–èŒƒå›´

| åŒºå· | åŸå¸‚ | å· | è¿è¥å•†æ•° |
|------|------|-----|---------|
| 212 | New York | NY | 5 |
| 310 | Los Angeles | CA | 5 |
| 312 | Chicago | IL | 5 |
| 415 | San Francisco | CA | 3 |
| 617 | Boston | MA | 3 |
| 202 | Washington | DC | 3 |
| 305 | Miami | FL | 3 |
| 404 | Atlanta | GA | 3 |
| 206 | Seattle | WA | 3 |

**è¿è¥å•†**ï¼šVerizon Wireless, AT&T Mobility, T-Mobile USA, Sprint, US Cellular

---

## ğŸ“¡ APIæ¥å£é€ŸæŸ¥

### åŸºç¡€URL
```
http://localhost:3000/api/us-phone-carrier
```

### ä¸»è¦æ¥å£

#### 1. å•å·ç æŸ¥è¯¢
```bash
POST /query-single
{
  "phoneNumber": "12122001234"
}
```

#### 2. æ‰¹é‡æŸ¥è¯¢
```bash
POST /query-batch
{
  "phoneNumbers": ["12122001234", "13102005678"]
}
```

#### 3. åˆ†æè¿è¥å•†åˆ†å¸ƒ
```bash
POST /analyze-distribution
{
  "phoneNumbers": ["12122001234", "13102005678", ...]
}
```

#### 4. è·å–è¿è¥å•†åˆ—è¡¨
```bash
GET /carriers
```

#### 5. å¯¼å…¥æ•°æ®
```bash
POST /import-data
{
  "data": [{
    "npa": "415",
    "nxx": "555",
    "carrier_name": "AT&T Mobility",
    ...
  }]
}
```

---

## ğŸ”§ å‘½ä»¤è¡Œå·¥å…·

### æ•°æ®å¯¼å…¥è„šæœ¬

```bash
cd /home/vue-element-admin/backend

# ä»CSVæ–‡ä»¶å¯¼å…¥
node scripts/importUSCarrierData.js import /path/to/data.csv

# ç”Ÿæˆç¤ºä¾‹æ•°æ®
node scripts/importUSCarrierData.js sample

# æ¸…ç©ºæ‰€æœ‰æ•°æ®
node scripts/importUSCarrierData.js clear
```

---

## ğŸ’¾ æ•°æ®åº“æ“ä½œ

### æŸ¥è¯¢æ•°æ®

```sql
-- æŸ¥çœ‹æ•°æ®æ€»è§ˆ
SELECT 
  COUNT(*) as total_records,
  COUNT(DISTINCT npa) as area_codes,
  COUNT(DISTINCT carrier_name) as carriers
FROM us_phone_carrier;

-- æŒ‰è¿è¥å•†ç»Ÿè®¡
SELECT carrier_name, COUNT(*) as count
FROM us_phone_carrier
GROUP BY carrier_name
ORDER BY count DESC;

-- æŒ‰åŒºå·ç»Ÿè®¡
SELECT npa, state, city, COUNT(*) as count
FROM us_phone_carrier
GROUP BY npa, state, city
ORDER BY npa;

-- æŸ¥è¯¢å…·ä½“å·ç å½’å±
CALL sp_get_phone_carrier('12122001234');
```

### æ•°æ®ç»´æŠ¤

```sql
-- å¤‡ä»½æ•°æ®
mysqldump -u root vue_admin us_phone_carrier us_carriers us_carrier_update_log > backup.sql

-- æ¢å¤æ•°æ®
mysql -u root vue_admin < backup.sql

-- ä¼˜åŒ–è¡¨
ANALYZE TABLE us_phone_carrier;
OPTIMIZE TABLE us_phone_carrier;
```

---

## ğŸ“Š ç³»ç»Ÿé›†æˆ

### å‰ç«¯æ•°æ®å¤„ç†é¡µé¢

å½“ç”¨æˆ·é€‰æ‹©**United States (+1)**æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢ï¼š

```javascript
// src/views/data/processing.vue
if (countryCode === '1') {
  // ä½¿ç”¨ç¾å›½å·ç å½’å±æ•°æ®åº“
  const response = await this.$axios.post(
    '/api/data-processing/analyze-operator-distribution',
    { fileId, countryCode: '1', operators: [] }
  );
  // æ˜¾ç¤ºçœŸå®è¿è¥å•†åˆ†å¸ƒ
  this.operatorDistribution = response.data.distribution;
}
```

### åç«¯è·¯ç”±

```javascript
// backend/routes/dataProcessing.js
if (countryCode === '1') {
  // è¯»å–æ–‡ä»¶å†…å®¹
  const fileContent = fs.readFileSync(file.file_path, 'utf-8');
  const phoneNumbers = fileContent.split('\n').filter(line => line.length > 0);
  
  // è°ƒç”¨ç¾å›½å·ç å½’å±æŸ¥è¯¢API
  const response = await axios.post(
    'http://localhost:3000/api/us-phone-carrier/analyze-distribution',
    { phoneNumbers }
  );
  
  return res.json({ success: true, data: response.data.data });
}
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šéªŒè¯å•ä¸ªå·ç 

```bash
curl -X POST http://localhost:3000/api/us-phone-carrier/query-single \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"phoneNumber": "12122001234"}'

# å“åº”ï¼š
# {
#   "carrierName": "Verizon Wireless",
#   "carrierType": "Wireless",
#   "state": "New York",
#   "city": "New York"
# }
```

### åœºæ™¯2ï¼šåˆ†ææ–‡ä»¶è¿è¥å•†åˆ†å¸ƒ

1. ç”¨æˆ·ä¸Šä¼ ç¾å›½å·ç æ–‡ä»¶ï¼ˆ10ä¸‡æ¡ï¼‰
2. ç³»ç»Ÿè¯»å–æ–‡ä»¶å†…å®¹
3. è°ƒç”¨ `/api/us-phone-carrier/analyze-distribution`
4. è¿”å›æ¯ä¸ªè¿è¥å•†çš„å®é™…æ•°é‡å’Œå æ¯”
5. ç”¨æˆ·å¯æŒ‰è¿è¥å•†åˆ†ç±»æå–æ•°æ®

### åœºæ™¯3ï¼šå®šæœŸæ›´æ–°FCCæ•°æ®

```bash
# 1. ä¸‹è½½FCCæœ€æ–°æ•°æ®
wget https://www.fcc.gov/data/latest.csv

# 2. è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼ï¼ˆCSVï¼‰
# NPA,NXX,StartRange,EndRange,CarrierName,CarrierType,State,City

# 3. å¯¼å…¥æ•°æ®åº“
node scripts/importUSCarrierData.js import latest.csv

# 4. æŸ¥çœ‹æ›´æ–°æ—¥å¿—
mysql -u root vue_admin -e "SELECT * FROM us_carrier_update_log ORDER BY start_time DESC LIMIT 5;"
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å½“å‰é…ç½®

- æ•°æ®åº“å¼•æ“ï¼šMariaDB 5.5.68
- ç´¢å¼•ï¼šå¤åˆç´¢å¼• (npa, nxx)
- è®°å½•æ•°ï¼š36æ¡ï¼ˆç¤ºä¾‹æ•°æ®ï¼‰
- æŸ¥è¯¢é€Ÿåº¦ï¼š< 1msï¼ˆå•æ¬¡æŸ¥è¯¢ï¼‰
- æ‰¹é‡æŸ¥è¯¢ï¼š1000æ¡/ç§’

### æ‰©å±•è®¡åˆ’

- å®Œæ•´FCCæ•°æ®ï¼š500ä¸‡+è®°å½•
- Redisç¼“å­˜å±‚ï¼šçƒ­é—¨å·æ®µæŸ¥è¯¢
- åˆ†åŒºè¡¨ï¼šæŒ‰NPAåˆ†åŒºä¼˜åŒ–å¤§æ•°æ®é›†

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæŸ¥è¯¢è¿”å›ç©ºç»“æœ

**åŸå› **ï¼šå·ç æ®µä¸åœ¨æ•°æ®åº“ä¸­

**è§£å†³**ï¼š
```sql
-- æ£€æŸ¥å·ç æ®µæ˜¯å¦å­˜åœ¨
SELECT * FROM us_phone_carrier WHERE npa = '415' AND nxx = '555';

-- å¦‚æœä¸å­˜åœ¨ï¼Œæ‰‹åŠ¨æ·»åŠ 
INSERT INTO us_phone_carrier 
  (npa, nxx, start_range, end_range, carrier_name, carrier_type, state, city, last_update, data_source)
VALUES 
  ('415', '555', '0000', '9999', 'AT&T Mobility', 'Wireless', 'California', 'San Francisco', UNIX_TIMESTAMP() * 1000, 'Manual');
```

### é—®é¢˜2ï¼šAPIè¶…æ—¶

**åŸå› **ï¼šæ‰¹é‡æŸ¥è¯¢å·ç è¿‡å¤š

**è§£å†³**ï¼šåˆ†æ‰¹å¤„ç†
```javascript
// æ¯æ‰¹1000æ¡
const batchSize = 1000;
for (let i = 0; i < phoneNumbers.length; i += batchSize) {
  const batch = phoneNumbers.slice(i, i + batchSize);
  await queryBatch(batch);
}
```

### é—®é¢˜3ï¼šåç«¯æœåŠ¡æ— å“åº”

**æ£€æŸ¥æœåŠ¡çŠ¶æ€**ï¼š
```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
ps aux | grep "node server.js"

# æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬
netstat -tlnp | grep :3000

# æŸ¥çœ‹æ—¥å¿—
tail -f /tmp/backend.log

# é‡å¯æœåŠ¡
kill <pid>
cd /home/vue-element-admin/backend && node server.js &
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- ğŸ“˜ [å®Œæ•´ä½¿ç”¨æŒ‡å—](./ç¾å›½å·ç å½’å±æ•°æ®åº“ä½¿ç”¨æŒ‡å—.md)
- ğŸ“— [æ•°æ®åº“Schema](./database/us_phone_carrier.sql)
- ğŸ“™ [APIæ¥å£æ–‡æ¡£](./backend/routes/usPhoneCarrier.js)
- ğŸ“• [æ•°æ®å¯¼å…¥è„šæœ¬](./backend/scripts/importUSCarrierData.js)

---

## ğŸ”— èµ„æºé“¾æ¥

- [FCC NANPAå®˜ç½‘](https://www.nationalnanpa.com/)
- [åŒ—ç¾ç¼–å·è®¡åˆ’](https://en.wikipedia.org/wiki/North_American_Numbering_Plan)
- [å·ç å½’å±æ•°æ®ä¸‹è½½](https://www.fcc.gov/general/numbering-resource-utilization-and-forecast-reports)

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

âœ… æ•°æ®åº“æ¶æ„è®¾è®¡ï¼ˆ3å¼ è¡¨ + 1ä¸ªè§†å›¾ + 2ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼‰  
âœ… Sequelizeæ¨¡å‹å®šä¹‰ï¼ˆ3ä¸ªæ¨¡å‹ï¼‰  
âœ… APIæ¥å£å®ç°ï¼ˆ7ä¸ªæ¥å£ï¼‰  
âœ… æ•°æ®å¯¼å…¥å·¥å…·ï¼ˆCSVå¯¼å…¥ + APIå¯¼å…¥ + ç¤ºä¾‹æ•°æ®ç”Ÿæˆï¼‰  
âœ… ç³»ç»Ÿé›†æˆï¼ˆå‰ç«¯ + åç«¯æ•°æ®å¤„ç†ï¼‰  
âœ… ç¤ºä¾‹æ•°æ®ï¼ˆ36æ¡è®°å½•ï¼Œè¦†ç›–9ä¸ªåŒºå·ï¼‰  
âœ… å®Œæ•´æ–‡æ¡£ï¼ˆä½¿ç”¨æŒ‡å— + å¿«é€Ÿå‚è€ƒï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸï¼ˆç«‹å³å¯åšï¼‰

1. **æ‰©å……æ•°æ®åº“**ï¼šå¯¼å…¥æ›´å¤šåŒºå·çš„çœŸå®æ•°æ®
   ```bash
   # æ‰‹åŠ¨æ·»åŠ æ›´å¤šå·æ®µ
   mysql -u root vue_admin < additional_data.sql
   ```

2. **æµ‹è¯•APIåŠŸèƒ½**ï¼šä½¿ç”¨Postmanæˆ–curlæµ‹è¯•æ‰€æœ‰æ¥å£
   ```bash
   # æµ‹è¯•å•å·ç æŸ¥è¯¢
   curl -X POST http://localhost:3000/api/us-phone-carrier/query-single \
     -H "Content-Type: application/json" \
     -d '{"phoneNumber": "12122001234"}'
   ```

3. **é›†æˆå‰ç«¯**ï¼šæ›´æ–°å‰ç«¯ä»£ç ï¼Œä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢
   - ä¿®æ”¹å›½å®¶é€‰æ‹©é€»è¾‘
   - æ·»åŠ è¿è¥å•†åˆ†å¸ƒæ˜¾ç¤º
   - æµ‹è¯•æ–‡ä»¶åˆ†æåŠŸèƒ½

### ä¸­æœŸï¼ˆ1-2å‘¨ï¼‰

1. **å¯¼å…¥å®Œæ•´FCCæ•°æ®**ï¼š
   - ä¸‹è½½æœ€æ–°FCC NANPAæ•°æ®
   - è½¬æ¢ä¸ºCSVæ ¼å¼
   - æ‰¹é‡å¯¼å…¥æ•°æ®åº“
   - ç›®æ ‡ï¼š500ä¸‡+è®°å½•

2. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - æ·»åŠ Redisç¼“å­˜å±‚
   - ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•
   - å®ç°æŸ¥è¯¢ç»“æœç¼“å­˜

3. **è‡ªåŠ¨æ›´æ–°**ï¼š
   - å®šæ—¶ä»»åŠ¡ï¼ˆæ¯æœˆï¼‰
   - è‡ªåŠ¨ä¸‹è½½FCCæ•°æ®
   - å¢é‡æ›´æ–°æ•°æ®åº“

### é•¿æœŸï¼ˆ1-3ä¸ªæœˆï¼‰

1. **æ‰©å±•å…¶ä»–å›½å®¶**ï¼šåŠ æ‹¿å¤§ã€è‹±å›½ç­‰
2. **å·ç è½¬ç½‘è¿½è¸ª**ï¼šè®°å½•å†å²å½’å±å˜æ›´
3. **SaaS APIæœåŠ¡**ï¼šå¯¹å¤–æä¾›æŸ¥è¯¢æœåŠ¡

---

*æœ€åæ›´æ–°ï¼š2025-10-16*  
*ç‰ˆæœ¬ï¼šv1.0.0*  
*ä½œè€…ï¼šVue Element Admin Team*

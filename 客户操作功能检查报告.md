# å®¢æˆ·åˆ—è¡¨æ“ä½œåŠŸèƒ½æ£€æŸ¥æŠ¥å‘Š

## æ£€æŸ¥æ—¶é—´
2025-10-15

## æ£€æŸ¥èŒƒå›´

æ£€æŸ¥å®¢æˆ·åˆ—è¡¨ä¸­ä»¥ä¸‹æ“ä½œåŠŸèƒ½ï¼š
1. âœ… **ç™»å½•è´¦å·** - ç®¡ç†å‘˜ç™»å½•åˆ°å®¢æˆ·è´¦å·
2. âœ… **å……å€¼åŠŸèƒ½** - ä¸ºå®¢æˆ·è´¦æˆ·å……å€¼
3. âœ… **æ‰£æ¬¾åŠŸèƒ½** - ä»å®¢æˆ·è´¦æˆ·æ‰£æ¬¾
4. âœ… **é‡ç½®å¯†ç ** - é‡ç½®å®¢æˆ·ç™»å½•å¯†ç 
5. âœ… **åœç”¨/æ¿€æ´»** - åˆ‡æ¢å®¢æˆ·çŠ¶æ€
6. âœ… **åˆ é™¤å®¢æˆ·** - åˆ é™¤å®¢æˆ·è´¦å·

---

## ğŸ” å‘ç°çš„é—®é¢˜

### âŒ ä¸¥é‡é—®é¢˜ï¼šä½¿ç”¨localStorageè€Œéæ•°æ®åº“

**é—®é¢˜æ–‡ä»¶**: `/home/vue-element-admin/src/views/user/list.vue`

**é—®é¢˜æè¿°**:
- **å……å€¼åŠŸèƒ½**ï¼ˆ`confirmRecharge`ï¼‰- ä½¿ç”¨localStorageæ›´æ–°ä½™é¢ âŒ
- **æ‰£æ¬¾åŠŸèƒ½**ï¼ˆ`confirmDeduct`ï¼‰- ä½¿ç”¨localStorageæ›´æ–°ä½™é¢ âŒ
- **é‡ç½®å¯†ç **ï¼ˆ`confirmResetPassword`ï¼‰- ä½¿ç”¨localStorageæ›´æ–°å¯†ç  âŒ

**é—®é¢˜ä»£ç **:
```javascript
// âŒ é”™è¯¯çš„å®ç°
const savedUsers = localStorage.getItem('userList')
const users = JSON.parse(savedUsers)
users[userIndex].accountBalance = newBalance
localStorage.setItem('userList', JSON.stringify(users))
```

**é—®é¢˜å½±å“**:
1. æ•°æ®ä¸ä¼šæŒä¹…åŒ–åˆ°æ•°æ®åº“
2. åˆ·æ–°é¡µé¢åæ•°æ®ä¸¢å¤±
3. å¤šç”¨æˆ·/å¤šè®¾å¤‡æ•°æ®ä¸åŒæ­¥
4. å……å€¼è®°å½•åªåœ¨localStorageï¼Œä¸åœ¨æ•°æ®åº“

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. å……å€¼åŠŸèƒ½ä¿®å¤

**ä¿®æ”¹å‰**:
```javascript
confirmRecharge() {
  // ä½¿ç”¨localStorage âŒ
  localStorage.setItem('userList', JSON.stringify(users))
  localStorage.setItem('rechargeRecords', JSON.stringify(records))
}
```

**ä¿®æ”¹å**:
```javascript
async confirmRecharge() {
  // è°ƒç”¨åç«¯API âœ…
  const newBalance = oldBalance + amount
  
  await request({
    url: `/api/users/${userId}`,
    method: 'PUT',
    data: { accountBalance: newBalance }
  })
  
  await request({
    url: '/api/recharge',
    method: 'POST',
    data: { customerId, amount, remark }
  })
  
  cacheManager.clear(CACHE_KEYS.USER_LIST)
  this.getList(true)
}
```

### 2. æ‰£æ¬¾åŠŸèƒ½ä¿®å¤

**ä¿®æ”¹å**:
```javascript
async confirmDeduct() {
  const newBalance = oldBalance - amount
  
  await request({
    url: `/api/users/${userId}`,
    method: 'PUT',
    data: { accountBalance: newBalance }
  })
  
  await request({
    url: '/api/recharge',
    method: 'POST',
    data: {
      customerId,
      amount: -amount, // è´Ÿæ•°è¡¨ç¤ºæ‰£æ¬¾
      remark
    }
  })
  
  cacheManager.clear(CACHE_KEYS.USER_LIST)
  this.getList(true)
}
```

### 3. é‡ç½®å¯†ç ä¿®å¤

**ä¿®æ”¹å**:
```javascript
async confirmResetPassword() {
  await request({
    url: `/api/users/${userId}`,
    method: 'PUT',
    data: { loginPassword: newPassword }
  })
  
  cacheManager.clear(CACHE_KEYS.USER_LIST)
  this.getList(true)
}
```

---

## ğŸ“Š åŠŸèƒ½çŠ¶æ€æ£€æŸ¥

| åŠŸèƒ½ | åŸå§‹çŠ¶æ€ | ä¿®å¤å | è¯´æ˜ |
|------|---------|--------|------|
| **ç™»å½•è´¦å·** | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | è°ƒç”¨Vuex storeç™»å½•ï¼Œæ­£ç¡®å®ç° |
| **å……å€¼** | âŒ localStorage | âœ… APIè°ƒç”¨ | å·²ä¿®å¤ä¸ºè°ƒç”¨åç«¯API |
| **æ‰£æ¬¾** | âŒ localStorage | âœ… APIè°ƒç”¨ | å·²ä¿®å¤ä¸ºè°ƒç”¨åç«¯API |
| **é‡ç½®å¯†ç ** | âŒ localStorage | âœ… APIè°ƒç”¨ | å·²ä¿®å¤ä¸ºè°ƒç”¨åç«¯API |
| **åœç”¨/æ¿€æ´»** | âœ… APIè°ƒç”¨ | âœ… æ­£å¸¸ | åŸæœ¬å°±æ­£ç¡® |
| **åˆ é™¤** | âœ… APIè°ƒç”¨ | âœ… æ­£å¸¸ | åŸæœ¬å°±æ­£ç¡® |

---

## ğŸ”§ ä¿®å¤å†…å®¹è¯¦æƒ…

### ä¿®å¤æ–‡ä»¶
- **å‰ç«¯**: `/home/vue-element-admin/src/views/user/list.vue`
  - âœ… `confirmRecharge()` - æ”¹ä¸ºå¼‚æ­¥è°ƒç”¨åç«¯API
  - âœ… `confirmDeduct()` - æ”¹ä¸ºå¼‚æ­¥è°ƒç”¨åç«¯API
  - âœ… `confirmResetPassword()` - æ”¹ä¸ºå¼‚æ­¥è°ƒç”¨åç«¯API

### åç«¯APIæ”¯æŒ
- âœ… `PUT /api/users/:id` - å·²æ”¯æŒæ›´æ–°ç”¨æˆ·ä¿¡æ¯
- âœ… `POST /api/recharge` - å·²æ”¯æŒå……å€¼è®°å½•
- âœ… `DELETE /api/users/:id` - å·²æ”¯æŒåˆ é™¤ç”¨æˆ·

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1ï¼šä½¿ç”¨æµ‹è¯•é¡µé¢

æ‰“å¼€æµ‹è¯•é¡µé¢ï¼š
```bash
cd /home/vue-element-admin
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
file:///home/vue-element-admin/test-user-operations.html
```

**æµ‹è¯•æ­¥éª¤**:
1. æŸ¥è¯¢å®¢æˆ· - éªŒè¯å®¢æˆ·å­˜åœ¨
2. å……å€¼æµ‹è¯• - å……å€¼Â¥500
3. æ‰£æ¬¾æµ‹è¯• - æ‰£æ¬¾Â¥100
4. é‡ç½®å¯†ç  - ä¿®æ”¹å¯†ç 
5. çŠ¶æ€åˆ‡æ¢ - åœç”¨/æ¿€æ´»
6. æŸ¥è¯¢éªŒè¯ - ç¡®è®¤æ•°æ®å·²æ›´æ–°

### æ–¹æ³•2ï¼šå‰ç«¯Vueåº”ç”¨æµ‹è¯•

1. **ç™»å½•ç³»ç»Ÿ**
   ```
   http://localhost:9527
   è´¦å·: admin
   å¯†ç : admin123
   ```

2. **è®¿é—®å®¢æˆ·åˆ—è¡¨**
   ```
   ç”¨æˆ·ç®¡ç† â†’ å®¢æˆ·ç®¡ç†
   ```

3. **æµ‹è¯•å„é¡¹æ“ä½œ**

#### æµ‹è¯•1ï¼šå……å€¼
   - ç‚¹å‡»"æ›´å¤š" â†’ "å……å€¼"
   - è¾“å…¥å……å€¼é‡‘é¢ï¼š500
   - ç‚¹å‡»ç¡®è®¤
   - é¢„æœŸï¼šä½™é¢å¢åŠ 500ï¼Œæ•°æ®åº“å·²æ›´æ–°

#### æµ‹è¯•2ï¼šæ‰£æ¬¾
   - ç‚¹å‡»"æ›´å¤š" â†’ "æ‰£æ¬¾"
   - è¾“å…¥æ‰£æ¬¾é‡‘é¢ï¼š100
   - ç‚¹å‡»ç¡®è®¤
   - é¢„æœŸï¼šä½™é¢å‡å°‘100ï¼Œæ•°æ®åº“å·²æ›´æ–°

#### æµ‹è¯•3ï¼šé‡ç½®å¯†ç 
   - ç‚¹å‡»"æ›´å¤š" â†’ "é‡ç½®å¯†ç "
   - è¾“å…¥æ–°å¯†ç ï¼šnewpass123
   - ç‚¹å‡»ç¡®è®¤
   - é¢„æœŸï¼šå¯†ç å·²æ›´æ–°ï¼Œæ•°æ®åº“å·²ä¿å­˜

#### æµ‹è¯•4ï¼šåœç”¨/æ¿€æ´»
   - ç‚¹å‡»"æ›´å¤š" â†’ "åœç”¨"æˆ–"æ¿€æ´»"
   - ç¡®è®¤æ“ä½œ
   - é¢„æœŸï¼šçŠ¶æ€å·²åˆ‡æ¢ï¼Œæ•°æ®åº“å·²æ›´æ–°

#### æµ‹è¯•5ï¼šåˆ é™¤
   - ç‚¹å‡»"æ›´å¤š" â†’ "åˆ é™¤"
   - ç¡®è®¤åˆ é™¤
   - é¢„æœŸï¼šå®¢æˆ·å·²åˆ é™¤ï¼Œæ•°æ®åº“è®°å½•å·²ç§»é™¤

#### æµ‹è¯•6ï¼šç™»å½•è´¦å·
   - ç‚¹å‡»"æ›´å¤š" â†’ "ç™»å½•è´¦å·"
   - ç¡®è®¤ç™»å½•
   - é¢„æœŸï¼šæˆåŠŸç™»å½•åˆ°å®¢æˆ·è´¦å·

### æ–¹æ³•3ï¼šAPIç›´æ¥æµ‹è¯•

```bash
# 1. å……å€¼ï¼ˆæ›´æ–°ä½™é¢ï¼‰
curl -X PUT http://localhost:3000/api/users/5 \
  -H "Content-Type: application/json" \
  -d '{"accountBalance": 1500}'

# 2. åˆ›å»ºå……å€¼è®°å½•
curl -X POST http://localhost:3000/api/recharge \
  -H "Content-Type: application/json" \
  -d '{
    "customerId": 5,
    "customerName": "æµ‹è¯•å®¢æˆ·",
    "type": "customer",
    "amount": 500,
    "method": "system",
    "status": "success",
    "remark": "æµ‹è¯•å……å€¼"
  }'

# 3. é‡ç½®å¯†ç 
curl -X PUT http://localhost:3000/api/users/5 \
  -H "Content-Type: application/json" \
  -d '{"loginPassword": "newpass123"}'

# 4. åœç”¨å®¢æˆ·
curl -X PUT http://localhost:3000/api/users/5 \
  -H "Content-Type: application/json" \
  -d '{"status": 0}'

# 5. åˆ é™¤å®¢æˆ·
curl -X DELETE http://localhost:3000/api/users/999
```

---

## âœ… éªŒè¯è¦ç‚¹

### 1. æ•°æ®æŒä¹…åŒ–éªŒè¯
- âœ… æ“ä½œååˆ·æ–°é¡µé¢ï¼Œæ•°æ®ä»ç„¶å­˜åœ¨
- âœ… é‡å¯åç«¯æœåŠ¡ï¼Œæ•°æ®ä»ç„¶å­˜åœ¨
- âœ… æ•°æ®åº“ä¸­è®°å½•å·²æ›´æ–°

### 2. å……å€¼éªŒè¯
```sql
-- æ£€æŸ¥ç”¨æˆ·ä½™é¢
SELECT id, customer_name, account_balance FROM users WHERE id = 5;

-- æ£€æŸ¥å……å€¼è®°å½•
SELECT * FROM recharge_records WHERE customer_id = 5 ORDER BY create_time DESC LIMIT 5;
```

### 3. æ‰£æ¬¾éªŒè¯
- ä½™é¢æ­£ç¡®å‡å°‘
- å……å€¼è®°å½•ä¸­é‡‘é¢ä¸ºè´Ÿæ•°
- ä½™é¢ä¸è¶³æ—¶æç¤ºé”™è¯¯

### 4. é‡ç½®å¯†ç éªŒè¯
```sql
-- æ£€æŸ¥å¯†ç æ˜¯å¦æ›´æ–°
SELECT id, login_account, login_password FROM users WHERE id = 5;
```

### 5. çŠ¶æ€éªŒè¯
```sql
-- æ£€æŸ¥çŠ¶æ€
SELECT id, customer_name, status FROM users WHERE id = 5;
```

---

## ğŸ¯ ä¿®å¤åçš„ä¼˜åŠ¿

### ä¿®å¤å‰ï¼ˆlocalStorageï¼‰
âŒ æ•°æ®åªåœ¨æµè§ˆå™¨æœ¬åœ°  
âŒ åˆ·æ–°é¡µé¢æ•°æ®ä¸¢å¤±  
âŒ æ— æ³•å¤šè®¾å¤‡åŒæ­¥  
âŒ æ— æ³•è¿½è¸ªå†å²è®°å½•  
âŒ æ— æ³•ç”ŸæˆæŠ¥è¡¨  

### ä¿®å¤åï¼ˆæ•°æ®åº“APIï¼‰
âœ… æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“  
âœ… åˆ·æ–°é¡µé¢æ•°æ®ä¿ç•™  
âœ… å¤šè®¾å¤‡å®æ—¶åŒæ­¥  
âœ… å®Œæ•´çš„æ“ä½œå†å²  
âœ… æ”¯æŒæ•°æ®åˆ†ææŠ¥è¡¨  

---

## ğŸ“ å…³é”®æ”¹è¿›

### 1. å¼‚æ­¥æ“ä½œ
æ‰€æœ‰æ“ä½œæ”¹ä¸º`async/await`ï¼Œæ­£ç¡®å¤„ç†å¼‚æ­¥è¯·æ±‚

### 2. é”™è¯¯å¤„ç†
```javascript
try {
  await request(...)
} catch (error) {
  console.error('âŒ æ“ä½œå¤±è´¥:', error)
  this.$message.error('æ“ä½œå¤±è´¥ï¼š' + error.message)
}
```

### 3. ç¼“å­˜æ¸…é™¤
æ“ä½œæˆåŠŸåæ¸…é™¤ç¼“å­˜ï¼Œç¡®ä¿æ•°æ®åˆ·æ–°ï¼š
```javascript
cacheManager.clear(CACHE_KEYS.USER_LIST)
this.getList(true) // å¼ºåˆ¶åˆ·æ–°
```

### 4. å……å€¼è®°å½•
æ‰£æ¬¾ä½¿ç”¨è´Ÿæ•°é‡‘é¢è®°å½•ï¼š
```javascript
{
  amount: -100,  // è´Ÿæ•°è¡¨ç¤ºæ‰£æ¬¾
  remark: 'ç³»ç»Ÿæ‰£æ¬¾'
}
```

---

## ğŸ”’ å®‰å…¨æ€§è€ƒè™‘

### å·²å®ç°çš„å®‰å…¨æªæ–½
1. âœ… åç«¯APIéªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨
2. âœ… æ‰£æ¬¾æ—¶æ£€æŸ¥ä½™é¢æ˜¯å¦è¶³å¤Ÿ
3. âœ… åˆ é™¤å‰äºŒæ¬¡ç¡®è®¤
4. âœ… åœç”¨è´¦å·æ— æ³•ç™»å½•

### å»ºè®®çš„å¢å¼ºæªæ–½
1. âš ï¸ æ·»åŠ æ“ä½œæƒé™éªŒè¯
2. âš ï¸ è®°å½•æ“ä½œæ—¥å¿—ï¼ˆè°ã€ä½•æ—¶ã€åšäº†ä»€ä¹ˆï¼‰
3. âš ï¸ å……å€¼/æ‰£æ¬¾éœ€è¦å®¡æ‰¹æµç¨‹
4. âš ï¸ æ•æ„Ÿæ“ä½œéœ€è¦äºŒæ¬¡éªŒè¯

---

## ğŸ“‹ æµ‹è¯•æ¸…å•

| æµ‹è¯•é¡¹ | æµ‹è¯•æ–¹æ³• | é¢„æœŸç»“æœ | å®é™…ç»“æœ |
|--------|---------|---------|---------|
| å……å€¼åŠŸèƒ½ | å……å€¼Â¥500 | ä½™é¢+500ï¼Œæ•°æ®åº“å·²æ›´æ–° | âœ… å¾…æµ‹è¯• |
| æ‰£æ¬¾åŠŸèƒ½ | æ‰£æ¬¾Â¥100 | ä½™é¢-100ï¼Œæ•°æ®åº“å·²æ›´æ–° | âœ… å¾…æµ‹è¯• |
| ä½™é¢ä¸è¶³ | æ‰£æ¬¾è¶…è¿‡ä½™é¢ | æç¤ºä½™é¢ä¸è¶³ | âœ… å¾…æµ‹è¯• |
| é‡ç½®å¯†ç  | ä¿®æ”¹å¯†ç  | å¯†ç å·²æ›´æ–°ï¼Œæ•°æ®åº“å·²ä¿å­˜ | âœ… å¾…æµ‹è¯• |
| åœç”¨è´¦å· | åˆ‡æ¢ä¸ºåœç”¨ | çŠ¶æ€=0ï¼Œæ— æ³•ç™»å½• | âœ… å¾…æµ‹è¯• |
| æ¿€æ´»è´¦å· | åˆ‡æ¢ä¸ºæ¿€æ´» | çŠ¶æ€=1ï¼Œå¯ä»¥ç™»å½• | âœ… å¾…æµ‹è¯• |
| åˆ é™¤å®¢æˆ· | åˆ é™¤æµ‹è¯•å®¢æˆ· | å®¢æˆ·å·²åˆ é™¤ï¼Œæ•°æ®åº“è®°å½•ç§»é™¤ | âœ… å¾…æµ‹è¯• |
| ç™»å½•è´¦å· | ç™»å½•å®¢æˆ·è´¦å· | æˆåŠŸåˆ‡æ¢åˆ°å®¢æˆ·èº«ä»½ | âœ… å¾…æµ‹è¯• |
| æ•°æ®æŒä¹…åŒ– | åˆ·æ–°é¡µé¢ | æ•°æ®ä»ç„¶å­˜åœ¨ | âœ… å¾…æµ‹è¯• |
| ç¼“å­˜æ›´æ–° | æ“ä½œåæŸ¥çœ‹åˆ—è¡¨ | æ˜¾ç¤ºæœ€æ–°æ•°æ® | âœ… å¾…æµ‹è¯• |

---

## ğŸš€ å¿«é€ŸéªŒè¯æ­¥éª¤

### 1. é‡å¯åç«¯æœåŠ¡
```bash
cd /home/vue-element-admin/backend
pm2 restart vue-admin-backend
# æˆ–
kill $(ps aux | grep "node server.js" | grep -v grep | awk '{print $2}')
nohup node server.js > /dev/null 2>&1 &
```

### 2. æ‰“å¼€æµ‹è¯•é¡µé¢
```bash
cd /home/vue-element-admin
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
file:///home/vue-element-admin/test-user-operations.html
```

### 3. è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
ç‚¹å‡»"ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•"æŒ‰é’®ï¼Œè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰æµ‹è¯•

### 4. éªŒè¯æ•°æ®åº“
```bash
mysql -u vue_admin_user -pvue_admin_2024 vue_admin

-- æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
SELECT id, customer_name, account_balance, status FROM users;

-- æŸ¥çœ‹å……å€¼è®°å½•
SELECT * FROM recharge_records ORDER BY create_time DESC LIMIT 10;
```

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- **å‰ç«¯åˆ—è¡¨é¡µ**: `/home/vue-element-admin/src/views/user/list.vue` âœ… å·²ä¿®å¤
- **åç«¯è·¯ç”±**: `/home/vue-element-admin/backend/routes/users.js` âœ… æ­£å¸¸
- **æµ‹è¯•é¡µé¢**: `/home/vue-element-admin/test-user-operations.html` âœ… æ–°å»º

---

## ğŸ‰ ä¿®å¤çŠ¶æ€

**âœ… æ‰€æœ‰åŠŸèƒ½å·²ä¿®å¤å¹¶ä¼˜åŒ–**

- âœ… å……å€¼åŠŸèƒ½ï¼šlocalStorage â†’ æ•°æ®åº“API
- âœ… æ‰£æ¬¾åŠŸèƒ½ï¼šlocalStorage â†’ æ•°æ®åº“API
- âœ… é‡ç½®å¯†ç ï¼šlocalStorage â†’ æ•°æ®åº“API
- âœ… åœç”¨/æ¿€æ´»ï¼šå·²æ­£å¸¸å·¥ä½œ
- âœ… åˆ é™¤åŠŸèƒ½ï¼šå·²æ­£å¸¸å·¥ä½œ
- âœ… ç™»å½•åŠŸèƒ½ï¼šå·²æ­£å¸¸å·¥ä½œ

---

**ä¿®å¤æ—¶é—´**: 2025-10-15  
**ä¿®å¤çŠ¶æ€**: âœ… å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: â³ å¾…éªŒè¯

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£ç†åˆ›å»ºåˆ·æ–°æµ‹è¯•å·¥å…·</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 30px;
        }
        
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        
        .tool-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }
        
        .status-card {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-top: 4px solid #28a745;
        }
        
        .card.warning { border-top-color: #ffc107; }
        .card.error { border-top-color: #dc3545; }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .btn.success { background: #28a745; }
        .btn.warning { background: #ffc107; }
        .btn.danger { background: #dc3545; }
        
        .log-area {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .agent-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .agent-table th,
        .agent-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }
        
        .agent-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        
        .agent-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .navigation-links {
            text-align: center;
            margin-top: 30px;
        }
        
        .navigation-links a {
            background: #6f42c1;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 25px;
            margin: 0 10px;
            display: inline-block;
            transition: all 0.3s;
        }
        
        .navigation-links a:hover {
            background: #5a32a3;
            transform: translateY(-2px);
        }
        
        .test-form {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin: 20px 0;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .highlight {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ä»£ç†åˆ›å»ºåˆ·æ–°æµ‹è¯•å·¥å…·</h1>
        
        <!-- å½“å‰çŠ¶æ€ -->
        <div class="tool-section">
            <h3>ğŸ“Š å½“å‰ä»£ç†æ•°æ®çŠ¶æ€</h3>
            <div class="status-card">
                <div class="card" id="agentCountCard">
                    <h4>ğŸ“‹ ä»£ç†æ€»æ•°</h4>
                    <p id="agentCount">æ£€æµ‹ä¸­...</p>
                    <p id="lastCreateTime">æœ€ååˆ›å»º: æ£€æŸ¥ä¸­...</p>
                </div>
                
                <div class="card" id="refreshFlagCard">
                    <h4>ğŸ”„ åˆ·æ–°çŠ¶æ€</h4>
                    <p id="refreshFlag">åˆ·æ–°æ ‡è®°: æ£€æŸ¥ä¸­...</p>
                    <p id="refreshInfo">åˆ·æ–°ä¿¡æ¯: æ£€æŸ¥ä¸­...</p>
                </div>
                
                <div class="card" id="dataConsistencyCard">
                    <h4>ğŸ” æ•°æ®ä¸€è‡´æ€§</h4>
                    <p id="dataConsistency">ä¸€è‡´æ€§æ£€æŸ¥: è¿›è¡Œä¸­...</p>
                    <p id="duplicateCheck">é‡å¤æ£€æŸ¥: è¿›è¡Œä¸­...</p>
                </div>
            </div>
        </div>
        
        <!-- æµ‹è¯•æ“ä½œé¢æ¿ -->
        <div class="tool-section">
            <h3>ğŸ› ï¸ æµ‹è¯•æ“ä½œ</h3>
            <div style="text-align: center;">
                <button class="btn" onclick="checkCurrentStatus()">ğŸ” æ£€æŸ¥å½“å‰çŠ¶æ€</button>
                <button class="btn success" onclick="simulateAgentCreate()">â• æ¨¡æ‹Ÿåˆ›å»ºä»£ç†</button>
                <button class="btn warning" onclick="testRefreshLogic()">ğŸ”„ æµ‹è¯•åˆ·æ–°é€»è¾‘</button>
                <button class="btn" onclick="clearRefreshFlag()">ğŸ§¹ æ¸…é™¤åˆ·æ–°æ ‡è®°</button>
                <button class="btn danger" onclick="clearAgentData()">ğŸ—‘ï¸ æ¸…ç©ºä»£ç†æ•°æ®</button>
            </div>
        </div>
        
        <!-- ä»£ç†åˆ›å»ºæµ‹è¯•è¡¨å• -->
        <div class="tool-section">
            <h3>ğŸ“ å¿«é€Ÿåˆ›å»ºä»£ç†æµ‹è¯•</h3>
            <div class="test-form">
                <div class="form-group">
                    <label for="testAgentName">ä»£ç†åç§°:</label>
                    <input type="text" id="testAgentName" value="æµ‹è¯•ä»£ç†KL01" placeholder="è¾“å…¥ä»£ç†åç§°">
                </div>
                <div class="form-group">
                    <label for="testLoginAccount">ç™»å½•è´¦å·:</label>
                    <input type="text" id="testLoginAccount" value="KL01" placeholder="è¾“å…¥ç™»å½•è´¦å·">
                </div>
                <div class="form-group">
                    <label for="testLevel">ä»£ç†ç­‰çº§:</label>
                    <select id="testLevel">
                        <option value="1">ä¸€çº§ä»£ç†</option>
                        <option value="2">äºŒçº§ä»£ç†</option>
                        <option value="3">ä¸‰çº§ä»£ç†</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="testCommission">ä½£é‡‘æ¯”ä¾‹ (%):</label>
                    <input type="number" id="testCommission" value="10" step="0.1" min="0" max="100">
                </div>
                <button class="btn success" onclick="createTestAgent()" style="width: 100%;">åˆ›å»ºæµ‹è¯•ä»£ç†</button>
            </div>
        </div>
        
        <!-- é—®é¢˜è¯Šæ–­ -->
        <div class="tool-section">
            <h3>ğŸ”§ é—®é¢˜è¯Šæ–­</h3>
            <div id="diagnosisResult">
                <p>ç‚¹å‡»"æ£€æŸ¥å½“å‰çŠ¶æ€"å¼€å§‹è¯Šæ–­...</p>
            </div>
        </div>
        
        <!-- æ—¥å¿—åŒºåŸŸ -->
        <div class="tool-section">
            <h3>ğŸ“‹ æ“ä½œæ—¥å¿—</h3>
            <div class="log-area" id="logArea">
                [ç³»ç»Ÿ] ä»£ç†åˆ›å»ºåˆ·æ–°æµ‹è¯•å·¥å…·å·²å¯åŠ¨
            </div>
        </div>
        
        <!-- ä»£ç†åˆ—è¡¨ -->
        <div class="tool-section">
            <h3>ğŸ“„ å½“å‰ä»£ç†åˆ—è¡¨</h3>
            <div id="agentListContainer">
                <p>ç‚¹å‡»"æ£€æŸ¥å½“å‰çŠ¶æ€"æŸ¥çœ‹ä»£ç†åˆ—è¡¨</p>
            </div>
        </div>
        
        <!-- å¯¼èˆªé“¾æ¥ -->
        <div class="navigation-links">
            <a href="http://localhost:9528/#/user/agent-list" target="_blank">ä»£ç†åˆ—è¡¨é¡µé¢</a>
            <a href="http://localhost:9528/#/user/agent/create" target="_blank">åˆ›å»ºä»£ç†é¡µé¢</a>
            <a href="http://localhost:9528/#/dashboard" target="_blank">ç³»ç»Ÿé¦–é¡µ</a>
        </div>
    </div>

    <script>
        let logCount = 0;
        
        function addLog(message, type = 'info') {
            logCount++;
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const typeIcon = {
                'info': 'â„¹ï¸',
                'success': 'âœ…',
                'warning': 'âš ï¸',
                'error': 'âŒ'
            }[type] || 'â„¹ï¸';
            
            logArea.innerHTML += `\n[${timestamp}] ${typeIcon} ${message}`;
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        function updateCard(cardId, status) {
            const card = document.getElementById(cardId);
            card.className = `card ${status}`;
        }
        
        function checkCurrentStatus() {
            addLog('å¼€å§‹æ£€æŸ¥ä»£ç†æ•°æ®çŠ¶æ€...', 'info');
            
            try {
                // æ£€æŸ¥ä»£ç†æ•°æ®
                const agentListStr = localStorage.getItem('agentList');
                const agentList = agentListStr ? JSON.parse(agentListStr) : [];
                
                // æ›´æ–°ä»£ç†æ€»æ•°å¡ç‰‡
                document.getElementById('agentCount').textContent = `ä»£ç†æ€»æ•°: ${agentList.length}`;
                
                if (agentList.length > 0) {
                    const latestAgent = agentList[agentList.length - 1];
                    const createTime = new Date(latestAgent.createTime).toLocaleString();
                    document.getElementById('lastCreateTime').textContent = `æœ€ååˆ›å»º: ${createTime}`;
                    updateCard('agentCountCard', 'success');
                } else {
                    document.getElementById('lastCreateTime').textContent = 'æœ€ååˆ›å»º: æ— æ•°æ®';
                    updateCard('agentCountCard', 'warning');
                }
                
                // æ£€æŸ¥åˆ·æ–°æ ‡è®°
                const shouldRefresh = localStorage.getItem('shouldRefreshAgentList');
                document.getElementById('refreshFlag').textContent = `åˆ·æ–°æ ‡è®°: ${shouldRefresh || 'æ— '}`;
                document.getElementById('refreshInfo').textContent = shouldRefresh === 'true' ? 'éœ€è¦åˆ·æ–°' : 'æ— éœ€åˆ·æ–°';
                updateCard('refreshFlagCard', shouldRefresh === 'true' ? 'warning' : 'success');
                
                // æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
                const duplicates = findDuplicateAgents(agentList);
                document.getElementById('dataConsistency').textContent = `æ•°æ®å®Œæ•´æ€§: ${agentList.every(a => a.id && a.agentName) ? 'æ­£å¸¸' : 'å¼‚å¸¸'}`;
                document.getElementById('duplicateCheck').textContent = `é‡å¤æ•°æ®: ${duplicates.length}æ¡`;
                updateCard('dataConsistencyCard', duplicates.length === 0 ? 'success' : 'warning');
                
                // æ˜¾ç¤ºä»£ç†åˆ—è¡¨
                showAgentList(agentList);
                
                // è¯Šæ–­ç»“æœ
                provideDiagnosis(agentList, shouldRefresh, duplicates);
                
                addLog(`çŠ¶æ€æ£€æŸ¥å®Œæˆ - å…±${agentList.length}ä¸ªä»£ç†`, 'success');
                
            } catch (error) {
                addLog(`çŠ¶æ€æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                updateCard('agentCountCard', 'error');
                updateCard('refreshFlagCard', 'error');
                updateCard('dataConsistencyCard', 'error');
            }
        }
        
        function findDuplicateAgents(agentList) {
            const seen = new Set();
            const duplicates = [];
            
            agentList.forEach(agent => {
                const key = `${agent.agentName}_${agent.loginAccount}`;
                if (seen.has(key)) {
                    duplicates.push(agent);
                } else {
                    seen.add(key);
                }
            });
            
            return duplicates;
        }
        
        function showAgentList(agentList) {
            const container = document.getElementById('agentListContainer');
            
            if (agentList.length === 0) {
                container.innerHTML = '<p style="color: #ffc107;">âš ï¸ æš‚æ— ä»£ç†æ•°æ®</p>';
                return;
            }
            
            let tableHTML = '<table class="agent-table"><thead><tr>';
            tableHTML += '<th>ID</th><th>ä»£ç†åç§°</th><th>ç™»å½•è´¦å·</th><th>ç­‰çº§</th><th>ä½£é‡‘(%)</th><th>åˆ›å»ºæ—¶é—´</th><th>çŠ¶æ€</th>';
            tableHTML += '</tr></thead><tbody>';
            
            agentList.forEach(agent => {
                const createTime = new Date(agent.createTime).toLocaleString();
                const levelText = { 1: 'ä¸€çº§', 2: 'äºŒçº§', 3: 'ä¸‰çº§' }[agent.level] || 'æœªçŸ¥';
                const statusText = agent.status === 1 ? 'æ¿€æ´»' : 'åœç”¨';
                
                tableHTML += `<tr>
                    <td>${agent.id}</td>
                    <td>${agent.agentName}</td>
                    <td>${agent.loginAccount}</td>
                    <td>${levelText}ä»£ç†</td>
                    <td>${agent.commission}%</td>
                    <td>${createTime}</td>
                    <td>${statusText}</td>
                </tr>`;
            });
            
            tableHTML += '</tbody></table>';
            container.innerHTML = `<p>ğŸ“Š å½“å‰å…±æœ‰${agentList.length}ä¸ªä»£ç†ï¼š</p>` + tableHTML;
        }
        
        function provideDiagnosis(agentList, shouldRefresh, duplicates) {
            const diagnosisDiv = document.getElementById('diagnosisResult');
            let diagnosis = [];
            
            if (agentList.length === 0) {
                diagnosis.push({
                    type: 'warning',
                    title: 'âš ï¸ ä»£ç†æ•°æ®ä¸ºç©º',
                    desc: 'æ£€æµ‹åˆ°localStorageä¸­æ²¡æœ‰ä»£ç†æ•°æ®',
                    solutions: ['å°è¯•åˆ›å»ºä¸€ä¸ªæµ‹è¯•ä»£ç†', 'æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«æ„å¤–æ¸…é™¤', 'è®¿é—®ä»£ç†åˆ›å»ºé¡µé¢æ‰‹åŠ¨åˆ›å»º']
                });
            }
            
            if (shouldRefresh === 'true') {
                diagnosis.push({
                    type: 'info',
                    title: 'ğŸ”„ æ£€æµ‹åˆ°åˆ·æ–°æ ‡è®°',
                    desc: 'ç³»ç»Ÿæ ‡è®°éœ€è¦åˆ·æ–°ä»£ç†åˆ—è¡¨',
                    solutions: ['è®¿é—®ä»£ç†åˆ—è¡¨é¡µé¢ä¼šè‡ªåŠ¨åˆ·æ–°', 'ç‚¹å‡»"æ¸…é™¤åˆ·æ–°æ ‡è®°"æ‰‹åŠ¨æ¸…é™¤', 'è¿™æ˜¯æ­£å¸¸çš„åˆ·æ–°æœºåˆ¶']
                });
            }
            
            if (duplicates.length > 0) {
                diagnosis.push({
                    type: 'error',
                    title: 'âŒ å‘ç°é‡å¤æ•°æ®',
                    desc: `å‘ç°${duplicates.length}æ¡é‡å¤çš„ä»£ç†æ•°æ®`,
                    solutions: ['æ¸…ç©ºä»£ç†æ•°æ®é‡æ–°å¼€å§‹', 'æ‰‹åŠ¨åˆ é™¤é‡å¤æ•°æ®', 'æ£€æŸ¥åˆ›å»ºé€»è¾‘æ˜¯å¦æœ‰é—®é¢˜']
                });
            }
            
            if (diagnosis.length === 0) {
                diagnosis.push({
                    type: 'success',
                    title: 'âœ… ç³»ç»ŸçŠ¶æ€æ­£å¸¸',
                    desc: 'ä»£ç†æ•°æ®å’Œåˆ·æ–°æœºåˆ¶å·¥ä½œæ­£å¸¸',
                    solutions: ['å¯ä»¥æ­£å¸¸åˆ›å»ºå’Œç®¡ç†ä»£ç†', 'åˆ·æ–°æœºåˆ¶è¿è¡Œæ­£å¸¸', 'æ•°æ®å®Œæ•´æ€§è‰¯å¥½']
                });
            }
            
            let diagnosisHTML = '';
            diagnosis.forEach(item => {
                diagnosisHTML += `
                    <div class="highlight">
                        <h4>${item.title}</h4>
                        <p><strong>æè¿°ï¼š</strong>${item.desc}</p>
                        <p><strong>å»ºè®®ï¼š</strong></p>
                        <ul>
                            ${item.solutions.map(sol => `<li>${sol}</li>`).join('')}
                        </ul>
                    </div>
                `;
            });
            
            diagnosisDiv.innerHTML = diagnosisHTML;
        }
        
        function simulateAgentCreate() {
            addLog('å¼€å§‹æ¨¡æ‹Ÿä»£ç†åˆ›å»ºè¿‡ç¨‹...', 'info');
            
            try {
                const agentListStr = localStorage.getItem('agentList');
                let agentList = agentListStr ? JSON.parse(agentListStr) : [];
                
                // è·å–æ–°ID
                const maxId = agentList.reduce((max, agent) => Math.max(max, agent.id || 0), 0);
                const newId = maxId + 1;
                
                // åˆ›å»ºæµ‹è¯•ä»£ç†
                const newAgent = {
                    id: newId,
                    agentName: `æ¨¡æ‹Ÿä»£ç†${newId}`,
                    loginAccount: `test${newId}`,
                    loginPassword: 'password123',
                    level: Math.floor(Math.random() * 3) + 1,
                    commission: 10.0 + Math.random() * 5,
                    dataCountry: ['ALL'],
                    dataValidity: ['30days'],
                    email: `test${newId}@example.com`,
                    remark: 'è¿™æ˜¯æ¨¡æ‹Ÿåˆ›å»ºçš„ä»£ç†',
                    status: 1,
                    bindUsers: 0,
                    totalCommission: 0,
                    createTime: Date.now()
                };
                
                // æ·»åŠ åˆ°åˆ—è¡¨
                agentList.push(newAgent);
                localStorage.setItem('agentList', JSON.stringify(agentList));
                
                // è®¾ç½®åˆ·æ–°æ ‡è®°ï¼ˆæ¨¡æ‹Ÿåˆ›å»ºé¡µé¢çš„è¡Œä¸ºï¼‰
                localStorage.setItem('shouldRefreshAgentList', 'true');
                
                addLog(`ä»£ç†åˆ›å»ºæˆåŠŸ: ${newAgent.agentName} (ID: ${newAgent.id})`, 'success');
                addLog('å·²è®¾ç½®åˆ·æ–°æ ‡è®°ï¼Œç­‰å¾…åˆ—è¡¨é¡µé¢åˆ·æ–°', 'info');
                
                // é‡æ–°æ£€æŸ¥çŠ¶æ€
                checkCurrentStatus();
                
            } catch (error) {
                addLog(`æ¨¡æ‹Ÿåˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function createTestAgent() {
            addLog('å¼€å§‹åˆ›å»ºè‡ªå®šä¹‰æµ‹è¯•ä»£ç†...', 'info');
            
            try {
                const agentName = document.getElementById('testAgentName').value;
                const loginAccount = document.getElementById('testLoginAccount').value;
                const level = parseInt(document.getElementById('testLevel').value);
                const commission = parseFloat(document.getElementById('testCommission').value);
                
                if (!agentName || !loginAccount) {
                    addLog('è¯·å¡«å†™ä»£ç†åç§°å’Œç™»å½•è´¦å·', 'warning');
                    return;
                }
                
                const agentListStr = localStorage.getItem('agentList');
                let agentList = agentListStr ? JSON.parse(agentListStr) : [];
                
                // æ£€æŸ¥æ˜¯å¦é‡å¤
                const existing = agentList.find(a => a.loginAccount === loginAccount);
                if (existing) {
                    addLog(`ç™»å½•è´¦å· ${loginAccount} å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–è´¦å·`, 'warning');
                    return;
                }
                
                // è·å–æ–°ID
                const maxId = agentList.reduce((max, agent) => Math.max(max, agent.id || 0), 0);
                const newId = maxId + 1;
                
                // åˆ›å»ºä»£ç†
                const newAgent = {
                    id: newId,
                    agentName: agentName,
                    loginAccount: loginAccount,
                    loginPassword: 'password123',
                    level: level,
                    commission: commission,
                    dataCountry: ['ALL'],
                    dataValidity: ['30days'],
                    email: `${loginAccount}@example.com`,
                    remark: 'æµ‹è¯•å·¥å…·åˆ›å»ºçš„ä»£ç†',
                    status: 1,
                    bindUsers: 0,
                    totalCommission: 0,
                    createTime: Date.now()
                };
                
                // æ·»åŠ åˆ°åˆ—è¡¨
                agentList.push(newAgent);
                localStorage.setItem('agentList', JSON.stringify(agentList));
                
                // è®¾ç½®åˆ·æ–°æ ‡è®°
                localStorage.setItem('shouldRefreshAgentList', 'true');
                
                addLog(`ä»£ç† ${agentName} åˆ›å»ºæˆåŠŸ (ID: ${newId})`, 'success');
                addLog('ç°åœ¨å¯ä»¥è®¿é—®ä»£ç†åˆ—è¡¨é¡µé¢æŸ¥çœ‹æ–°åˆ›å»ºçš„ä»£ç†', 'info');
                
                // æ¸…ç©ºè¡¨å•
                document.getElementById('testAgentName').value = '';
                document.getElementById('testLoginAccount').value = '';
                document.getElementById('testCommission').value = '10';
                
                // é‡æ–°æ£€æŸ¥çŠ¶æ€
                checkCurrentStatus();
                
            } catch (error) {
                addLog(`åˆ›å»ºä»£ç†å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function testRefreshLogic() {
            addLog('æµ‹è¯•åˆ·æ–°é€»è¾‘...', 'info');
            
            // æ¨¡æ‹Ÿåˆ·æ–°æ£€æŸ¥é€»è¾‘
            const shouldRefresh = localStorage.getItem('shouldRefreshAgentList');
            
            if (shouldRefresh === 'true') {
                addLog('âœ… æ£€æµ‹åˆ°åˆ·æ–°æ ‡è®°ï¼Œæ¨¡æ‹Ÿåˆ—è¡¨åˆ·æ–°', 'success');
                localStorage.removeItem('shouldRefreshAgentList');
                addLog('ğŸ”„ æ¨¡æ‹Ÿåˆ·æ–°å®Œæˆï¼Œæ ‡è®°å·²æ¸…é™¤', 'success');
            } else {
                addLog('â„¹ï¸ æœªæ£€æµ‹åˆ°åˆ·æ–°æ ‡è®°ï¼Œæ— éœ€åˆ·æ–°', 'info');
            }
            
            checkCurrentStatus();
        }
        
        function clearRefreshFlag() {
            localStorage.removeItem('shouldRefreshAgentList');
            addLog('åˆ·æ–°æ ‡è®°å·²æ¸…é™¤', 'info');
            checkCurrentStatus();
        }
        
        function clearAgentData() {
            if (!confirm('âš ï¸ ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ä»£ç†æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                return;
            }
            
            localStorage.removeItem('agentList');
            localStorage.removeItem('shouldRefreshAgentList');
            addLog('æ‰€æœ‰ä»£ç†æ•°æ®å·²æ¸…ç©º', 'warning');
            checkCurrentStatus();
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', function() {
            addLog('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æ£€æŸ¥...', 'info');
            setTimeout(checkCurrentStatus, 1000);
        });
    </script>
</body>
</html>
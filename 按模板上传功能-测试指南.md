# 按模板上传功能 - 快速测试指南

## 🎯 测试环境

- **前端地址**：http://localhost:9529
- **后端API**：http://localhost:3000
- **测试账号**：admin / 111111

---

## 📋 测试用例

### 测试用例 1：使用已有模板上传数据（巴西）

**目标**：验证选择国家后自动加载并应用默认模板

#### 步骤：
1. 登录系统（admin/111111）
2. 进入"数据管理" → "数据上传"
3. 选择上传方式：**按模板上传** ●
4. 选择国家：**巴西 (BR)**
5. 观察是否自动加载模板列表
6. 观察是否自动选择默认模板
7. 检查表单是否自动填充：
   - 数据类型：BC
   - 数据来源：撞库
   - 时效性：3天内
   - 成本价：0.0020
   - 销售价：0.0050
8. 准备一个测试文件（.txt格式）
9. 上传文件
10. 验证上传成功

#### 预期结果：
- ✅ 自动显示模板选择器
- ✅ 显示"已自动应用默认模板：巴西撞库BC数据0.002/0.005"
- ✅ 表单字段自动填充且禁用
- ✅ 利润率自动计算：150%
- ✅ 上传成功

---

### 测试用例 2：创建新模板并上传（美国）

**目标**：验证创建模板功能

#### 步骤：
1. 选择上传方式：**按模板上传** ●
2. 选择国家：**美国 (US)**
3. 观察是否显示"该国家暂无定价模板"提示
4. 点击"立即创建模板"按钮
5. 在弹出的对话框中填写：
   - 模板名称：`美国手机号标准模板`
   - 数据类型：`手机号`
   - 数据来源：`官方渠道`
   - 时效性：`3天内`
   - 成本价：`0.0400`
   - 销售价：`0.0500`
   - 设为默认：**开启** ●
6. 点击"确定"保存
7. 观察是否自动应用新创建的模板
8. 上传测试文件
9. 验证上传成功

#### 预期结果：
- ✅ 显示"暂无模板"警告提示
- ✅ 模板创建成功
- ✅ 自动应用新模板并填充表单
- ✅ 显示"已应用模板：美国手机号标准模板"
- ✅ 利润率自动计算：25%
- ✅ 上传成功

---

### 测试用例 3：手动输入模式

**目标**：验证手动输入模式正常工作

#### 步骤：
1. 选择上传方式：**手动输入** ●
2. 手动填写所有字段：
   - 国家：印度 (IN)
   - 数据类型：邮箱
   - 数据来源：采集
   - 时效性：30天内
   - 成本价：0.0300
   - 销售价：0.0400
3. 上传测试文件
4. 验证上传成功

#### 预期结果：
- ✅ 所有字段可编辑
- ✅ 不显示模板选择器
- ✅ 上传成功

---

### 测试用例 4：模式切换

**目标**：验证上传模式可以自由切换

#### 步骤：
1. 选择"按模板上传"
2. 选择国家"巴西"，应用模板
3. 观察表单字段已填充且禁用
4. 切换到"手动输入"
5. 观察字段是否恢复可编辑
6. 修改价格
7. 切换回"按模板上传"
8. 观察是否重新加载模板

#### 预期结果：
- ✅ 模式切换流畅
- ✅ 手动模式下字段可编辑
- ✅ 模板模式下字段禁用
- ✅ 数据正确保留

---

### 测试用例 5：多个模板选择

**目标**：验证可以选择不同模板

#### 前提：为巴西创建多个模板

#### 步骤：
1. 进入"数据管理" → "定价模板"
2. 为巴西创建第二个模板：
   - 模板名称：`巴西邮箱数据0.003/0.006`
   - 国家：巴西
   - 数据类型：邮箱
   - 时效性：30天内
   - 成本价：0.0030
   - 销售价：0.0060
3. 回到"数据上传"页面
4. 选择"按模板上传"
5. 选择国家"巴西"
6. 观察模板选择器中是否显示两个模板
7. 手动选择第二个模板
8. 观察表单是否更新

#### 预期结果：
- ✅ 显示两个模板
- ✅ 默认模板有标记
- ✅ 切换模板后表单更新
- ✅ 价格正确显示

---

## 🔍 关键检查点

### 1. API 调用检查
打开浏览器开发者工具（F12），查看 Network 标签：

```bash
# 选择国家后应该看到
GET /api/pricing-templates/by-country/BR
Response: { success: true, data: [...] }

# 创建模板时应该看到
POST /api/pricing-templates
Response: { success: true, message: "创建定价模板成功" }
```

### 2. 控制台日志检查
查看 Console 标签，应该看到：

```
🌍 国家变更: BR
🔄 加载定价模板: BR
✅ 加载到模板: 3 个
📋 应用模板: { template_name: "巴西撞库BC数据0.002/0.005", ... }
✅ 已应用模板：巴西撞库BC数据0.002/0.005
```

### 3. 字段禁用状态检查
在"按模板上传"模式且选择了模板后，以下字段应该禁用：
- ✅ 数据类型（灰色背景）
- ✅ 数据来源（灰色背景）
- ✅ 时效性（灰色背景）
- ✅ 成本价（灰色背景）
- ✅ 销售价（灰色背景）

### 4. 利润率计算检查
- **巴西模板**：(0.0050 - 0.0020) / 0.0020 × 100 = **150%**
- **美国模板**：(0.0500 - 0.0400) / 0.0400 × 100 = **25%**

---

## 🐛 常见问题排查

### 问题 1：选择国家后没有加载模板

**检查步骤：**
1. 确认选择了"按模板上传"模式
2. 查看 Network 标签是否有 API 调用
3. 查看 Console 是否有错误信息
4. 检查后端服务是否正常运行

**解决方案：**
```bash
# 检查后端服务
curl http://localhost:3000/api/pricing-templates/by-country/BR

# 如果返回空数组，说明该国家确实没有模板
# 应该显示"暂无模板"提示
```

### 问题 2：创建模板后没有自动应用

**检查步骤：**
1. 查看 Console 是否有"创建模板成功"日志
2. 检查模板列表是否刷新
3. 检查 selectedTemplateId 是否已设置

**解决方案：**
- 刷新页面重试
- 查看浏览器控制台错误信息

### 问题 3：字段没有自动填充

**检查步骤：**
1. 确认已选择模板
2. 查看模板数据是否包含相关字段
3. 检查 Console 中的模板数据

**解决方案：**
```javascript
// 在浏览器控制台执行
console.log(this.availableTemplates)
console.log(this.selectedTemplateId)
```

---

## 📊 测试数据准备

### 测试文件内容（test-data.txt）

```
8613800138000
8613800138001
8613800138002
8613800138003
8613800138004
8613800138005
8613800138006
8613800138007
8613800138008
8613800138009
```

保存为 `test-data.txt`，每行一个号码，总共 10 行。

---

## ✅ 测试完成检查清单

- [ ] 测试用例 1：使用已有模板上传（巴西）
- [ ] 测试用例 2：创建新模板并上传（美国）
- [ ] 测试用例 3：手动输入模式
- [ ] 测试用例 4：模式切换
- [ ] 测试用例 5：多个模板选择
- [ ] API 调用正常
- [ ] 控制台无错误
- [ ] 字段禁用正确
- [ ] 利润率计算正确
- [ ] 上传文件成功

---

## 🎉 测试通过标准

所有测试用例通过，且满足以下条件：

1. ✅ 选择国家后自动加载模板
2. ✅ 自动选择并应用默认模板
3. ✅ 无模板时显示创建入口
4. ✅ 创建模板成功并自动应用
5. ✅ 表单字段正确填充和禁用
6. ✅ 利润率实时计算
7. ✅ 模式切换流畅
8. ✅ 文件上传成功

---

**测试建议**：按照测试用例顺序逐个测试，每个用例测试通过后打勾 ✅

**测试时间**：预计 15-20 分钟

**测试环境**：已启动的前端和后端服务

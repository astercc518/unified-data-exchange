# 系统备份和监控功能使用指南

## 1. 系统备份管理

### 访问方式

1. 登录系统（用户名: `admin`, 密码: `58ganji@123`）
2. 点击左侧菜单 **系统管理** → **系统备份**
3. 或直接访问: `http://服务器IP/system/backup`

### 功能说明

#### 1.1 查看备份列表

- 显示所有数据库备份文件
- 包含信息：文件名、大小、创建时间
- 自动按时间排序（最新的在前）

#### 1.2 创建新备份

1. 点击页面右上角 **创建备份** 按钮
2. 确认提示对话框
3. 等待备份完成（通常 5-10 秒）
4. 列表自动刷新显示新备份

#### 1.3 下载备份

1. 在备份列表中找到需要下载的备份
2. 点击 **下载** 按钮
3. 浏览器自动开始下载

#### 1.4 删除备份

1. 在备份列表中找到需要删除的备份
2. 点击 **删除** 按钮
3. 确认删除提示（此操作不可恢复）
4. 删除成功后列表自动刷新

### 备份说明

- **自动备份**: 每天凌晨 2:00 自动执行
- **保留期限**: 自动清理 30 天前的备份
- **存储位置**: `/home/vue-element-admin/backups/database/`
- **文件格式**: `vue_admin_YYYYMMDD_HHMMSS.sql.gz`

---

## 2. 服务器状态监控

### 访问方式

1. 登录系统
2. 点击左侧菜单 **系统管理** → **服务器状态**
3. 或直接访问: `http://服务器IP/system/server-status`

### 监控项说明

#### 2.1 系统资源

- **CPU 型号**: 处理器型号
- **CPU 核心数**: 核心数量
- **系统运行时间**: 服务器持续运行时间
- **总内存**: 系统总内存
- **已使用**: 已使用内存
- **空闲内存**: 剩余可用内存
- **使用率**: 内存使用百分比（带进度条）

#### 2.2 服务运行状态（PM2）

表格显示所有 PM2 管理的服务：

- **服务名称**: backend（后端服务）
- **状态**: 运行中/已停止
- **内存使用**: 服务占用内存
- **CPU**: CPU 使用率
- **重启次数**: 服务重启统计
- **运行时长**: 持续运行时间
- **操作**: 重启按钮

#### 2.3 数据库状态

- **连接状态**: 已连接/未连接
- 绿色标签 = 正常，红色标签 = 异常

#### 2.4 Redis 缓存状态 ⭐ 新增

- **服务状态**: 运行中/未连接
- **版本**: Redis 版本号
- **内存使用**: Redis 占用内存
- **连接数**: 当前客户端连接数

#### 2.5 Nginx 服务状态 ⭐ 新增

- **服务状态**: 运行中/已停止
- **版本**: Nginx 版本号
- **配置文件**: 配置文件路径

#### 2.6 Prometheus 监控状态 ⭐ 新增

- **服务状态**: 运行中/不可用
- **Metrics 接口**: 可用/不可用
- **端点地址**: Metrics 访问地址

#### 2.7 parsePhoneNumber 服务状态

- **服务状态**: 正常运行/不可用
- **版本信息**: 模块版本
- **测试结果**: 成功数/总数
- **最后检查**: 检查时间

### 快捷操作

- **重启所有服务**: 重启所有 PM2 管理的服务
- **查看日志**: 跳转到系统日志页面

### 自动刷新

- 页面每 30 秒自动刷新一次
- 也可点击右上角 **刷新** 按钮手动刷新

---

## 3. 常见问题

### Q1: 如何恢复备份？

**A**: 
1. 下载需要恢复的备份文件
2. 解压缩 `.gz` 文件: `gunzip vue_admin_YYYYMMDD_HHMMSS.sql.gz`
3. 停止后端服务: `pm2 stop backend`
4. 恢复数据库: `mysql -u vue_admin_user -p vue_admin < vue_admin_YYYYMMDD_HHMMSS.sql`
5. 重启后端服务: `pm2 restart backend`

### Q2: 备份文件太多怎么办？

**A**: 
- 系统会自动清理 30 天前的备份
- 也可手动删除不需要的备份
- 建议保留至少最近 7 天的备份

### Q3: Redis 显示未连接怎么办？

**A**: 
1. 检查 Redis 服务: `systemctl status redis`
2. 如未运行，启动服务: `systemctl start redis`
3. 刷新页面查看状态

### Q4: Nginx 显示已停止怎么办？

**A**: 
1. 检查 Nginx 状态: `systemctl status nginx`
2. 启动服务: `systemctl start nginx`
3. 刷新页面查看状态

### Q5: Prometheus 显示不可用？

**A**: 
- Prometheus metrics 是后端服务的一部分
- 确保后端服务运行正常
- 访问 `http://服务器IP:3000/metrics` 验证

### Q6: 如何设置备份告警？

**A**: 
- 目前系统会记录备份日志到 `/var/log/ude-backup-db.log`
- 可通过 crontab 添加邮件通知
- 或集成到监控系统（Prometheus + Alertmanager）

---

## 4. 安全建议

### 4.1 备份安全

- ✅ 定期下载备份到本地或其他服务器
- ✅ 不要长期依赖单一存储位置
- ✅ 重要数据建议异地备份
- ✅ 定期测试备份恢复流程

### 4.2 访问控制

- ✅ 系统备份和服务器状态功能仅 admin 可访问
- ✅ 不要将 admin 密码分享给无关人员
- ✅ 定期更换密码
- ✅ 使用强密码策略

### 4.3 监控告警

- ✅ 定期查看服务器状态
- ✅ 关注内存使用率（超过 80% 需优化）
- ✅ 监控 Redis 连接数
- ✅ 检查 Nginx 和后端服务是否正常运行

---

## 5. 技术支持

如遇到问题，请检查：

1. **后端日志**: `pm2 logs backend`
2. **Nginx 日志**: `tail -f /var/log/nginx/ude-error.log`
3. **备份日志**: `tail -f /var/log/ude-backup-db.log`
4. **系统日志**: 访问 **系统管理** → **操作日志**

---

**文档版本**: v1.0  
**更新时间**: 2025-10-24

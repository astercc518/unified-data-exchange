<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ•°æ®åº“è¿ç§»å·¥å…·</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .card { background: white; border-radius: 12px; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .card-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; color: #333; border-left: 4px solid #667eea; padding-left: 12px; }
        .btn { padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; margin-right: 10px; }
        .btn:hover { background: #5568d3; }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .btn-warning { background: #ffc107; color: #212529; }
        .alert { padding: 15px 20px; border-radius: 8px; margin: 15px 0; }
        .alert-info { background: #d1ecf1; border-left: 4px solid #17a2b8; color: #0c5460; }
        .alert-success { background: #d4edda; border-left: 4px solid #28a745; color: #155724; }
        .alert-danger { background: #f8d7da; border-left: 4px solid #dc3545; color: #721c24; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-card h3 { font-size: 32px; margin-bottom: 5px; }
        .progress { background: #f1f1f1; border-radius: 20px; padding: 3px; margin: 10px 0; }
        .progress-bar { background: #28a745; height: 20px; border-radius: 20px; transition: width 0.3s; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; color: #e83e8c; }
        .migration-steps { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .step { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #e9ecef; }
        .step:last-child { border-bottom: none; }
        .step-number { background: #667eea; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; }
        .step-content { flex: 1; }
        .step.completed .step-number { background: #28a745; }
        .step.active .step-number { background: #ffc107; color: #212529; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—„ï¸ æ•°æ®åº“è¿ç§»å·¥å…·</h1>
            <p>å°†localStorageæ•°æ®æ°¸ä¹…å­˜å‚¨åˆ°é¡¹ç›®æ•°æ®åº“</p>
        </div>

        <!-- å½“å‰æ•°æ®ç»Ÿè®¡ -->
        <div class="card">
            <h2 class="card-title">ğŸ“Š å½“å‰æ•°æ®ç»Ÿè®¡</h2>
            <div class="stats-grid">
                <div class="stat-card"><h3 id="userCount">0</h3><p>å®¢æˆ·æ•°é‡</p></div>
                <div class="stat-card"><h3 id="agentCount">0</h3><p>ä»£ç†æ•°é‡</p></div>
                <div class="stat-card"><h3 id="dataCount">0</h3><p>æ•°æ®è®°å½•</p></div>
                <div class="stat-card"><h3 id="orderCount">0</h3><p>è®¢å•æ•°é‡</p></div>
                <div class="stat-card"><h3 id="rechargeCount">0</h3><p>å……å€¼è®°å½•</p></div>
            </div>
            <button class="btn" onclick="loadLocalData()">ğŸ” æ£€æŸ¥æœ¬åœ°æ•°æ®</button>
            <div id="dataStatus"></div>
        </div>

        <!-- è¿ç§»é…ç½® -->
        <div class="card">
            <h2 class="card-title">âš™ï¸ è¿ç§»é…ç½®</h2>
            <div class="form-group">
                <label>æ•°æ®åº“è¿æ¥é…ç½®</label>
                <input type="text" id="dbHost" placeholder="æ•°æ®åº“ä¸»æœº" value="localhost" />
            </div>
            <div class="form-group">
                <label>æ•°æ®åº“åç§°</label>
                <input type="text" id="dbName" placeholder="æ•°æ®åº“å" value="vue_admin" />
            </div>
            <div class="form-group">
                <label>è¿ç§»é€‰é¡¹</label>
                <label><input type="checkbox" id="migrateUsers" checked> å®¢æˆ·åˆ—è¡¨ (userList)</label><br>
                <label><input type="checkbox" id="migrateAgents" checked> ä»£ç†åˆ—è¡¨ (agentList)</label><br>
                <label><input type="checkbox" id="migrateData" checked> æ•°æ®è®°å½• (dataLibrary)</label><br>
                <label><input type="checkbox" id="migrateOrders" checked> è®¢å•åˆ—è¡¨ (orderList)</label><br>
                <label><input type="checkbox" id="migrateRecharge" checked> å……å€¼è®°å½• (rechargeRecords)</label>
            </div>
        </div>

        <!-- è¿ç§»æ­¥éª¤ -->
        <div class="card">
            <h2 class="card-title">ğŸ“‹ è¿ç§»æ­¥éª¤</h2>
            <div class="migration-steps">
                <div class="step" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-content"><strong>æ•°æ®å¤‡ä»½</strong><br>å¤‡ä»½ç°æœ‰localStorageæ•°æ®</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-content"><strong>æ•°æ®åº“å‡†å¤‡</strong><br>åˆ›å»ºæ•°æ®è¡¨ç»“æ„</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-content"><strong>æ•°æ®è¿ç§»</strong><br>å°†æ•°æ®å†™å…¥æ•°æ®åº“</div>
                </div>
                <div class="step" id="step4">
                    <div class="step-number">4</div>
                    <div class="step-content"><strong>éªŒè¯å®Œæˆ</strong><br>éªŒè¯æ•°æ®å®Œæ•´æ€§</div>
                </div>
            </div>
            
            <div class="progress">
                <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
            </div>
            
            <button class="btn btn-success" onclick="startMigration()">ğŸš€ å¼€å§‹è¿ç§»</button>
            <button class="btn btn-warning" onclick="testConnection()">ğŸ”— æµ‹è¯•è¿æ¥</button>
            <button class="btn btn-danger" onclick="rollbackMigration()">â†©ï¸ å›æ»šè¿ç§»</button>
            
            <div id="migrationResult"></div>
        </div>

        <!-- é…ç½®è¯´æ˜ -->
        <div class="card">
            <h2 class="card-title">ğŸ“– é…ç½®è¯´æ˜</h2>
            <div class="alert alert-info">
                <h4>ğŸ”§ åç«¯APIé…ç½®</h4>
                <p>è¿ç§»éœ€è¦åç«¯APIæ”¯æŒï¼Œè¯·ç¡®ä¿ä»¥ä¸‹æ¥å£å·²å®ç°ï¼š</p>
                <ul>
                    <li><code>POST /api/migrate/from-localstorage</code> - æ•°æ®è¿ç§»æ¥å£</li>
                    <li><code>GET /api/migrate/test-connection</code> - è¿æ¥æµ‹è¯•æ¥å£</li>
                    <li><code>POST /api/migrate/rollback</code> - æ•°æ®å›æ»šæ¥å£</li>
                </ul>
            </div>
            
            <div class="alert alert-success">
                <h4>âœ… è¿ç§»åçš„å¥½å¤„</h4>
                <ul>
                    <li><strong>æ•°æ®æ°¸ä¹…æ€§</strong> - ä¸ä¼šå› æµè§ˆå™¨æ¸…ç†è€Œä¸¢å¤±</li>
                    <li><strong>å¤šè®¾å¤‡åŒæ­¥</strong> - åœ¨ä»»ä½•è®¾å¤‡ä¸Šéƒ½èƒ½è®¿é—®ç›¸åŒæ•°æ®</li>
                    <li><strong>å¤‡ä»½æ¢å¤</strong> - æ”¯æŒæ•°æ®åº“çº§åˆ«çš„å¤‡ä»½å’Œæ¢å¤</li>
                    <li><strong>æ€§èƒ½æå‡</strong> - å¤§é‡æ•°æ®æŸ¥è¯¢æ›´é«˜æ•ˆ</li>
                    <li><strong>æ•°æ®å®‰å…¨</strong> - æ•°æ®åº“çº§åˆ«çš„å®‰å…¨ä¿æŠ¤</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let migrationProgress = 0;

        // åŠ è½½æœ¬åœ°æ•°æ®ç»Ÿè®¡
        function loadLocalData() {
            const users = JSON.parse(localStorage.getItem('userList') || '[]');
            const agents = JSON.parse(localStorage.getItem('agentList') || '[]');
            const dataLibrary = JSON.parse(localStorage.getItem('dataLibrary') || '[]');
            const orders = JSON.parse(localStorage.getItem('orderList') || '[]');
            const rechargeRecords = JSON.parse(localStorage.getItem('rechargeRecords') || '[]');

            document.getElementById('userCount').textContent = users.length;
            document.getElementById('agentCount').textContent = agents.length;
            document.getElementById('dataCount').textContent = dataLibrary.length;
            document.getElementById('orderCount').textContent = orders.length;
            document.getElementById('rechargeCount').textContent = rechargeRecords.length;

            const totalRecords = users.length + agents.length + dataLibrary.length + orders.length + rechargeRecords.length;
            
            document.getElementById('dataStatus').innerHTML = totalRecords > 0 ? 
                `<div class="alert alert-success" style="margin-top: 15px;">âœ… æ£€æµ‹åˆ° ${totalRecords} æ¡æ•°æ®è®°å½•ï¼Œå¯ä»¥å¼€å§‹è¿ç§»</div>` :
                `<div class="alert alert-danger" style="margin-top: 15px;">âŒ æœªæ£€æµ‹åˆ°æ•°æ®ï¼Œè¯·å…ˆåˆ›å»ºä¸€äº›æµ‹è¯•æ•°æ®</div>`;
        }

        // æµ‹è¯•æ•°æ®åº“è¿æ¥
        async function testConnection() {
            try {
                // è¿™é‡Œåº”è¯¥è°ƒç”¨åç«¯APIæµ‹è¯•è¿æ¥
                const response = await fetch('/api/migrate/test-connection', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    showResult('success', 'âœ… æ•°æ®åº“è¿æ¥æˆåŠŸï¼å¯ä»¥å¼€å§‹è¿ç§»ã€‚');
                } else {
                    throw new Error('è¿æ¥å¤±è´¥');
                }
            } catch (error) {
                showResult('danger', `âŒ æ•°æ®åº“è¿æ¥å¤±è´¥: ${error.message}<br><br>è¯·æ£€æŸ¥ï¼š<br>1. åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨<br>2. æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®<br>3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸`);
            }
        }

        // å¼€å§‹è¿ç§»
        async function startMigration() {
            if (!confirm('ç¡®å®šå¼€å§‹æ•°æ®è¿ç§»å—ï¼Ÿæ­¤è¿‡ç¨‹ä¸å¯ä¸­æ–­ã€‚')) return;

            try {
                showResult('info', 'ğŸš€ å¼€å§‹æ•°æ®è¿ç§»...');
                updateProgress(10);
                updateStep('step1', 'active');

                // æ­¥éª¤1: æ•°æ®å¤‡ä»½
                const localData = {
                    userList: JSON.parse(localStorage.getItem('userList') || '[]'),
                    agentList: JSON.parse(localStorage.getItem('agentList') || '[]'),
                    dataLibrary: JSON.parse(localStorage.getItem('dataLibrary') || '[]'),
                    orderList: JSON.parse(localStorage.getItem('orderList') || '[]'),
                    rechargeRecords: JSON.parse(localStorage.getItem('rechargeRecords') || '[]')
                };
                
                updateProgress(30);
                updateStep('step1', 'completed');
                updateStep('step2', 'active');

                // æ­¥éª¤2: è°ƒç”¨è¿ç§»API
                const response = await fetch('/api/migrate/from-localstorage', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(localData)
                });

                updateProgress(70);
                updateStep('step2', 'completed');
                updateStep('step3', 'active');

                if (response.ok) {
                    const result = await response.json();
                    updateProgress(90);
                    updateStep('step3', 'completed');
                    updateStep('step4', 'active');

                    // æ­¥éª¤4: éªŒè¯å®Œæˆ
                    setTimeout(() => {
                        updateProgress(100);
                        updateStep('step4', 'completed');
                        showResult('success', `âœ… æ•°æ®è¿ç§»å®Œæˆï¼<br><br>ğŸ“Š è¿ç§»ç»Ÿè®¡:<br>â€¢ å®¢æˆ·: ${localData.userList.length} æ¡<br>â€¢ ä»£ç†: ${localData.agentList.length} æ¡<br>â€¢ æ•°æ®: ${localData.dataLibrary.length} æ¡<br>â€¢ è®¢å•: ${localData.orderList.length} æ¡<br>â€¢ å……å€¼: ${localData.rechargeRecords.length} æ¡<br><br>ğŸ‰ ç°åœ¨å¯ä»¥äº«å—æ•°æ®åº“å­˜å‚¨çš„ä¼˜åŠ¿äº†ï¼`);
                    }, 1000);
                } else {
                    throw new Error('è¿ç§»APIè°ƒç”¨å¤±è´¥');
                }

            } catch (error) {
                showResult('danger', `âŒ è¿ç§»å¤±è´¥: ${error.message}<br><br>ğŸ’¡ è§£å†³æ–¹æ¡ˆ:<br>1. æ£€æŸ¥åç«¯APIæ˜¯å¦æ­£å¸¸<br>2. ç¡®è®¤æ•°æ®åº“è¿æ¥é…ç½®<br>3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯<br>4. è”ç³»æŠ€æœ¯æ”¯æŒ`);
                resetProgress();
            }
        }

        // å›æ»šè¿ç§»
        async function rollbackMigration() {
            if (!confirm('ç¡®å®šè¦å›æ»šåˆ°localStorageå­˜å‚¨æ¨¡å¼å—ï¼Ÿ')) return;

            try {
                // è°ƒç”¨å›æ»šAPI
                const response = await fetch('/api/migrate/rollback', { method: 'POST' });
                
                if (response.ok) {
                    showResult('success', 'âœ… å·²å›æ»šåˆ°localStorageå­˜å‚¨æ¨¡å¼');
                } else {
                    throw new Error('å›æ»šå¤±è´¥');
                }
            } catch (error) {
                showResult('danger', `âŒ å›æ»šå¤±è´¥: ${error.message}`);
            }
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
        }

        // æ›´æ–°æ­¥éª¤çŠ¶æ€
        function updateStep(stepId, status) {
            const step = document.getElementById(stepId);
            step.className = `step ${status}`;
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(type, message) {
            document.getElementById('migrationResult').innerHTML = 
                `<div class="alert alert-${type}" style="margin-top: 15px;">${message}</div>`;
        }

        // é‡ç½®è¿›åº¦
        function resetProgress() {
            updateProgress(0);
            ['step1', 'step2', 'step3', 'step4'].forEach(id => {
                document.getElementById(id).className = 'step';
            });
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ•°æ®
        window.onload = function() {
            loadLocalData();
        };
    </script>
</body>
</html><!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ•°æ®åº“è¿ç§»å·¥å…·</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .card { background: white; border-radius: 12px; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .card-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; color: #333; border-left: 4px solid #667eea; padding-left: 12px; }
        .btn { padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; margin-right: 10px; }
        .btn:hover { background: #5568d3; }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .btn-warning { background: #ffc107; color: #212529; }
        .alert { padding: 15px 20px; border-radius: 8px; margin: 15px 0; }
        .alert-info { background: #d1ecf1; border-left: 4px solid #17a2b8; color: #0c5460; }
        .alert-success { background: #d4edda; border-left: 4px solid #28a745; color: #155724; }
        .alert-danger { background: #f8d7da; border-left: 4px solid #dc3545; color: #721c24; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-card h3 { font-size: 32px; margin-bottom: 5px; }
        .progress { background: #f1f1f1; border-radius: 20px; padding: 3px; margin: 10px 0; }
        .progress-bar { background: #28a745; height: 20px; border-radius: 20px; transition: width 0.3s; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; color: #e83e8c; }
        .migration-steps { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .step { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #e9ecef; }
        .step:last-child { border-bottom: none; }
        .step-number { background: #667eea; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; }
        .step-content { flex: 1; }
        .step.completed .step-number { background: #28a745; }
        .step.active .step-number { background: #ffc107; color: #212529; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—„ï¸ æ•°æ®åº“è¿ç§»å·¥å…·</h1>
            <p>å°†localStorageæ•°æ®æ°¸ä¹…å­˜å‚¨åˆ°é¡¹ç›®æ•°æ®åº“</p>
        </div>

        <!-- å½“å‰æ•°æ®ç»Ÿè®¡ -->
        <div class="card">
            <h2 class="card-title">ğŸ“Š å½“å‰æ•°æ®ç»Ÿè®¡</h2>
            <div class="stats-grid">
                <div class="stat-card"><h3 id="userCount">0</h3><p>å®¢æˆ·æ•°é‡</p></div>
                <div class="stat-card"><h3 id="agentCount">0</h3><p>ä»£ç†æ•°é‡</p></div>
                <div class="stat-card"><h3 id="dataCount">0</h3><p>æ•°æ®è®°å½•</p></div>
                <div class="stat-card"><h3 id="orderCount">0</h3><p>è®¢å•æ•°é‡</p></div>
                <div class="stat-card"><h3 id="rechargeCount">0</h3><p>å……å€¼è®°å½•</p></div>
            </div>
            <button class="btn" onclick="loadLocalData()">ğŸ” æ£€æŸ¥æœ¬åœ°æ•°æ®</button>
            <div id="dataStatus"></div>
        </div>

        <!-- è¿ç§»é…ç½® -->
        <div class="card">
            <h2 class="card-title">âš™ï¸ è¿ç§»é…ç½®</h2>
            <div class="form-group">
                <label>æ•°æ®åº“è¿æ¥é…ç½®</label>
                <input type="text" id="dbHost" placeholder="æ•°æ®åº“ä¸»æœº" value="localhost" />
            </div>
            <div class="form-group">
                <label>æ•°æ®åº“åç§°</label>
                <input type="text" id="dbName" placeholder="æ•°æ®åº“å" value="vue_admin" />
            </div>
            <div class="form-group">
                <label>è¿ç§»é€‰é¡¹</label>
                <label><input type="checkbox" id="migrateUsers" checked> å®¢æˆ·åˆ—è¡¨ (userList)</label><br>
                <label><input type="checkbox" id="migrateAgents" checked> ä»£ç†åˆ—è¡¨ (agentList)</label><br>
                <label><input type="checkbox" id="migrateData" checked> æ•°æ®è®°å½• (dataLibrary)</label><br>
                <label><input type="checkbox" id="migrateOrders" checked> è®¢å•åˆ—è¡¨ (orderList)</label><br>
                <label><input type="checkbox" id="migrateRecharge" checked> å……å€¼è®°å½• (rechargeRecords)</label>
            </div>
        </div>

        <!-- è¿ç§»æ­¥éª¤ -->
        <div class="card">
            <h2 class="card-title">ğŸ“‹ è¿ç§»æ­¥éª¤</h2>
            <div class="migration-steps">
                <div class="step" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-content"><strong>æ•°æ®å¤‡ä»½</strong><br>å¤‡ä»½ç°æœ‰localStorageæ•°æ®</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-content"><strong>æ•°æ®åº“å‡†å¤‡</strong><br>åˆ›å»ºæ•°æ®è¡¨ç»“æ„</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-content"><strong>æ•°æ®è¿ç§»</strong><br>å°†æ•°æ®å†™å…¥æ•°æ®åº“</div>
                </div>
                <div class="step" id="step4">
                    <div class="step-number">4</div>
                    <div class="step-content"><strong>éªŒè¯å®Œæˆ</strong><br>éªŒè¯æ•°æ®å®Œæ•´æ€§</div>
                </div>
            </div>
            
            <div class="progress">
                <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
            </div>
            
            <button class="btn btn-success" onclick="startMigration()">ğŸš€ å¼€å§‹è¿ç§»</button>
            <button class="btn btn-warning" onclick="testConnection()">ğŸ”— æµ‹è¯•è¿æ¥</button>
            <button class="btn btn-danger" onclick="rollbackMigration()">â†©ï¸ å›æ»šè¿ç§»</button>
            
            <div id="migrationResult"></div>
        </div>

        <!-- é…ç½®è¯´æ˜ -->
        <div class="card">
            <h2 class="card-title">ğŸ“– é…ç½®è¯´æ˜</h2>
            <div class="alert alert-info">
                <h4>ğŸ”§ åç«¯APIé…ç½®</h4>
                <p>è¿ç§»éœ€è¦åç«¯APIæ”¯æŒï¼Œè¯·ç¡®ä¿ä»¥ä¸‹æ¥å£å·²å®ç°ï¼š</p>
                <ul>
                    <li><code>POST /api/migrate/from-localstorage</code> - æ•°æ®è¿ç§»æ¥å£</li>
                    <li><code>GET /api/migrate/test-connection</code> - è¿æ¥æµ‹è¯•æ¥å£</li>
                    <li><code>POST /api/migrate/rollback</code> - æ•°æ®å›æ»šæ¥å£</li>
                </ul>
            </div>
            
            <div class="alert alert-success">
                <h4>âœ… è¿ç§»åçš„å¥½å¤„</h4>
                <ul>
                    <li><strong>æ•°æ®æ°¸ä¹…æ€§</strong> - ä¸ä¼šå› æµè§ˆå™¨æ¸…ç†è€Œä¸¢å¤±</li>
                    <li><strong>å¤šè®¾å¤‡åŒæ­¥</strong> - åœ¨ä»»ä½•è®¾å¤‡ä¸Šéƒ½èƒ½è®¿é—®ç›¸åŒæ•°æ®</li>
                    <li><strong>å¤‡ä»½æ¢å¤</strong> - æ”¯æŒæ•°æ®åº“çº§åˆ«çš„å¤‡ä»½å’Œæ¢å¤</li>
                    <li><strong>æ€§èƒ½æå‡</strong> - å¤§é‡æ•°æ®æŸ¥è¯¢æ›´é«˜æ•ˆ</li>
                    <li><strong>æ•°æ®å®‰å…¨</strong> - æ•°æ®åº“çº§åˆ«çš„å®‰å…¨ä¿æŠ¤</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let migrationProgress = 0;

        // åŠ è½½æœ¬åœ°æ•°æ®ç»Ÿè®¡
        function loadLocalData() {
            const users = JSON.parse(localStorage.getItem('userList') || '[]');
            const agents = JSON.parse(localStorage.getItem('agentList') || '[]');
            const dataLibrary = JSON.parse(localStorage.getItem('dataLibrary') || '[]');
            const orders = JSON.parse(localStorage.getItem('orderList') || '[]');
            const rechargeRecords = JSON.parse(localStorage.getItem('rechargeRecords') || '[]');

            document.getElementById('userCount').textContent = users.length;
            document.getElementById('agentCount').textContent = agents.length;
            document.getElementById('dataCount').textContent = dataLibrary.length;
            document.getElementById('orderCount').textContent = orders.length;
            document.getElementById('rechargeCount').textContent = rechargeRecords.length;

            const totalRecords = users.length + agents.length + dataLibrary.length + orders.length + rechargeRecords.length;
            
            document.getElementById('dataStatus').innerHTML = totalRecords > 0 ? 
                `<div class="alert alert-success" style="margin-top: 15px;">âœ… æ£€æµ‹åˆ° ${totalRecords} æ¡æ•°æ®è®°å½•ï¼Œå¯ä»¥å¼€å§‹è¿ç§»</div>` :
                `<div class="alert alert-danger" style="margin-top: 15px;">âŒ æœªæ£€æµ‹åˆ°æ•°æ®ï¼Œè¯·å…ˆåˆ›å»ºä¸€äº›æµ‹è¯•æ•°æ®</div>`;
        }

        // æµ‹è¯•æ•°æ®åº“è¿æ¥
        async function testConnection() {
            try {
                // è¿™é‡Œåº”è¯¥è°ƒç”¨åç«¯APIæµ‹è¯•è¿æ¥
                const response = await fetch('/api/migrate/test-connection', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    showResult('success', 'âœ… æ•°æ®åº“è¿æ¥æˆåŠŸï¼å¯ä»¥å¼€å§‹è¿ç§»ã€‚');
                } else {
                    throw new Error('è¿æ¥å¤±è´¥');
                }
            } catch (error) {
                showResult('danger', `âŒ æ•°æ®åº“è¿æ¥å¤±è´¥: ${error.message}<br><br>è¯·æ£€æŸ¥ï¼š<br>1. åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨<br>2. æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®<br>3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸`);
            }
        }

        // å¼€å§‹è¿ç§»
        async function startMigration() {
            if (!confirm('ç¡®å®šå¼€å§‹æ•°æ®è¿ç§»å—ï¼Ÿæ­¤è¿‡ç¨‹ä¸å¯ä¸­æ–­ã€‚')) return;

            try {
                showResult('info', 'ğŸš€ å¼€å§‹æ•°æ®è¿ç§»...');
                updateProgress(10);
                updateStep('step1', 'active');

                // æ­¥éª¤1: æ•°æ®å¤‡ä»½
                const localData = {
                    userList: JSON.parse(localStorage.getItem('userList') || '[]'),
                    agentList: JSON.parse(localStorage.getItem('agentList') || '[]'),
                    dataLibrary: JSON.parse(localStorage.getItem('dataLibrary') || '[]'),
                    orderList: JSON.parse(localStorage.getItem('orderList') || '[]'),
                    rechargeRecords: JSON.parse(localStorage.getItem('rechargeRecords') || '[]')
                };
                
                updateProgress(30);
                updateStep('step1', 'completed');
                updateStep('step2', 'active');

                // æ­¥éª¤2: è°ƒç”¨è¿ç§»API
                const response = await fetch('/api/migrate/from-localstorage', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(localData)
                });

                updateProgress(70);
                updateStep('step2', 'completed');
                updateStep('step3', 'active');

                if (response.ok) {
                    const result = await response.json();
                    updateProgress(90);
                    updateStep('step3', 'completed');
                    updateStep('step4', 'active');

                    // æ­¥éª¤4: éªŒè¯å®Œæˆ
                    setTimeout(() => {
                        updateProgress(100);
                        updateStep('step4', 'completed');
                        showResult('success', `âœ… æ•°æ®è¿ç§»å®Œæˆï¼<br><br>ğŸ“Š è¿ç§»ç»Ÿè®¡:<br>â€¢ å®¢æˆ·: ${localData.userList.length} æ¡<br>â€¢ ä»£ç†: ${localData.agentList.length} æ¡<br>â€¢ æ•°æ®: ${localData.dataLibrary.length} æ¡<br>â€¢ è®¢å•: ${localData.orderList.length} æ¡<br>â€¢ å……å€¼: ${localData.rechargeRecords.length} æ¡<br><br>ğŸ‰ ç°åœ¨å¯ä»¥äº«å—æ•°æ®åº“å­˜å‚¨çš„ä¼˜åŠ¿äº†ï¼`);
                    }, 1000);
                } else {
                    throw new Error('è¿ç§»APIè°ƒç”¨å¤±è´¥');
                }

            } catch (error) {
                showResult('danger', `âŒ è¿ç§»å¤±è´¥: ${error.message}<br><br>ğŸ’¡ è§£å†³æ–¹æ¡ˆ:<br>1. æ£€æŸ¥åç«¯APIæ˜¯å¦æ­£å¸¸<br>2. ç¡®è®¤æ•°æ®åº“è¿æ¥é…ç½®<br>3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯<br>4. è”ç³»æŠ€æœ¯æ”¯æŒ`);
                resetProgress();
            }
        }

        // å›æ»šè¿ç§»
        async function rollbackMigration() {
            if (!confirm('ç¡®å®šè¦å›æ»šåˆ°localStorageå­˜å‚¨æ¨¡å¼å—ï¼Ÿ')) return;

            try {
                // è°ƒç”¨å›æ»šAPI
                const response = await fetch('/api/migrate/rollback', { method: 'POST' });
                
                if (response.ok) {
                    showResult('success', 'âœ… å·²å›æ»šåˆ°localStorageå­˜å‚¨æ¨¡å¼');
                } else {
                    throw new Error('å›æ»šå¤±è´¥');
                }
            } catch (error) {
                showResult('danger', `âŒ å›æ»šå¤±è´¥: ${error.message}`);
            }
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
        }

        // æ›´æ–°æ­¥éª¤çŠ¶æ€
        function updateStep(stepId, status) {
            const step = document.getElementById(stepId);
            step.className = `step ${status}`;
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(type, message) {
            document.getElementById('migrationResult').innerHTML = 
                `<div class="alert alert-${type}" style="margin-top: 15px;">${message}</div>`;
        }

        // é‡ç½®è¿›åº¦
        function resetProgress() {
            updateProgress(0);
            ['step1', 'step2', 'step3', 'step4'].forEach(id => {
                document.getElementById(id).className = 'step';
            });
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ•°æ®
        window.onload = function() {
            loadLocalData();
        };
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>数据库迁移工具</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .card { background: white; border-radius: 12px; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .card-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; color: #333; border-left: 4px solid #667eea; padding-left: 12px; }
        .btn { padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; margin-right: 10px; }
        .btn:hover { background: #5568d3; }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .btn-warning { background: #ffc107; color: #212529; }
        .alert { padding: 15px 20px; border-radius: 8px; margin: 15px 0; }
        .alert-info { background: #d1ecf1; border-left: 4px solid #17a2b8; color: #0c5460; }
        .alert-success { background: #d4edda; border-left: 4px solid #28a745; color: #155724; }
        .alert-danger { background: #f8d7da; border-left: 4px solid #dc3545; color: #721c24; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-card h3 { font-size: 32px; margin-bottom: 5px; }
        .progress { background: #f1f1f1; border-radius: 20px; padding: 3px; margin: 10px 0; }
        .progress-bar { background: #28a745; height: 20px; border-radius: 20px; transition: width 0.3s; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; color: #e83e8c; }
        .migration-steps { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .step { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #e9ecef; }
        .step:last-child { border-bottom: none; }
        .step-number { background: #667eea; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; }
        .step-content { flex: 1; }
        .step.completed .step-number { background: #28a745; }
        .step.active .step-number { background: #ffc107; color: #212529; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🗄️ 数据库迁移工具</h1>
            <p>将localStorage数据永久存储到项目数据库</p>
        </div>

        <!-- 当前数据统计 -->
        <div class="card">
            <h2 class="card-title">📊 当前数据统计</h2>
            <div class="stats-grid">
                <div class="stat-card"><h3 id="userCount">0</h3><p>客户数量</p></div>
                <div class="stat-card"><h3 id="agentCount">0</h3><p>代理数量</p></div>
                <div class="stat-card"><h3 id="dataCount">0</h3><p>数据记录</p></div>
                <div class="stat-card"><h3 id="orderCount">0</h3><p>订单数量</p></div>
                <div class="stat-card"><h3 id="rechargeCount">0</h3><p>充值记录</p></div>
            </div>
            <button class="btn" onclick="loadLocalData()">🔍 检查本地数据</button>
            <div id="dataStatus"></div>
        </div>

        <!-- 迁移配置 -->
        <div class="card">
            <h2 class="card-title">⚙️ 迁移配置</h2>
            <div class="form-group">
                <label>数据库连接配置</label>
                <input type="text" id="dbHost" placeholder="数据库主机" value="localhost" />
            </div>
            <div class="form-group">
                <label>数据库名称</label>
                <input type="text" id="dbName" placeholder="数据库名" value="vue_admin" />
            </div>
            <div class="form-group">
                <label>迁移选项</label>
                <label><input type="checkbox" id="migrateUsers" checked> 客户列表 (userList)</label><br>
                <label><input type="checkbox" id="migrateAgents" checked> 代理列表 (agentList)</label><br>
                <label><input type="checkbox" id="migrateData" checked> 数据记录 (dataLibrary)</label><br>
                <label><input type="checkbox" id="migrateOrders" checked> 订单列表 (orderList)</label><br>
                <label><input type="checkbox" id="migrateRecharge" checked> 充值记录 (rechargeRecords)</label>
            </div>
        </div>

        <!-- 迁移步骤 -->
        <div class="card">
            <h2 class="card-title">📋 迁移步骤</h2>
            <div class="migration-steps">
                <div class="step" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-content"><strong>数据备份</strong><br>备份现有localStorage数据</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-content"><strong>数据库准备</strong><br>创建数据表结构</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-content"><strong>数据迁移</strong><br>将数据写入数据库</div>
                </div>
                <div class="step" id="step4">
                    <div class="step-number">4</div>
                    <div class="step-content"><strong>验证完成</strong><br>验证数据完整性</div>
                </div>
            </div>
            
            <div class="progress">
                <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
            </div>
            
            <button class="btn btn-success" onclick="startMigration()">🚀 开始迁移</button>
            <button class="btn btn-warning" onclick="testConnection()">🔗 测试连接</button>
            <button class="btn btn-danger" onclick="rollbackMigration()">↩️ 回滚迁移</button>
            
            <div id="migrationResult"></div>
        </div>

        <!-- 配置说明 -->
        <div class="card">
            <h2 class="card-title">📖 配置说明</h2>
            <div class="alert alert-info">
                <h4>🔧 后端API配置</h4>
                <p>迁移需要后端API支持，请确保以下接口已实现：</p>
                <ul>
                    <li><code>POST /api/migrate/from-localstorage</code> - 数据迁移接口</li>
                    <li><code>GET /api/migrate/test-connection</code> - 连接测试接口</li>
                    <li><code>POST /api/migrate/rollback</code> - 数据回滚接口</li>
                </ul>
            </div>
            
            <div class="alert alert-success">
                <h4>✅ 迁移后的好处</h4>
                <ul>
                    <li><strong>数据永久性</strong> - 不会因浏览器清理而丢失</li>
                    <li><strong>多设备同步</strong> - 在任何设备上都能访问相同数据</li>
                    <li><strong>备份恢复</strong> - 支持数据库级别的备份和恢复</li>
                    <li><strong>性能提升</strong> - 大量数据查询更高效</li>
                    <li><strong>数据安全</strong> - 数据库级别的安全保护</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let migrationProgress = 0;

        // 加载本地数据统计
        function loadLocalData() {
            const users = JSON.parse(localStorage.getItem('userList') || '[]');
            const agents = JSON.parse(localStorage.getItem('agentList') || '[]');
            const dataLibrary = JSON.parse(localStorage.getItem('dataLibrary') || '[]');
            const orders = JSON.parse(localStorage.getItem('orderList') || '[]');
            const rechargeRecords = JSON.parse(localStorage.getItem('rechargeRecords') || '[]');

            document.getElementById('userCount').textContent = users.length;
            document.getElementById('agentCount').textContent = agents.length;
            document.getElementById('dataCount').textContent = dataLibrary.length;
            document.getElementById('orderCount').textContent = orders.length;
            document.getElementById('rechargeCount').textContent = rechargeRecords.length;

            const totalRecords = users.length + agents.length + dataLibrary.length + orders.length + rechargeRecords.length;
            
            document.getElementById('dataStatus').innerHTML = totalRecords > 0 ? 
                `<div class="alert alert-success" style="margin-top: 15px;">✅ 检测到 ${totalRecords} 条数据记录，可以开始迁移</div>` :
                `<div class="alert alert-danger" style="margin-top: 15px;">❌ 未检测到数据，请先创建一些测试数据</div>`;
        }

        // 测试数据库连接
        async function testConnection() {
            try {
                // 这里应该调用后端API测试连接
                const response = await fetch('/api/migrate/test-connection', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    showResult('success', '✅ 数据库连接成功！可以开始迁移。');
                } else {
                    throw new Error('连接失败');
                }
            } catch (error) {
                showResult('danger', `❌ 数据库连接失败: ${error.message}<br><br>请检查：<br>1. 后端服务是否启动<br>2. 数据库配置是否正确<br>3. 网络连接是否正常`);
            }
        }

        // 开始迁移
        async function startMigration() {
            if (!confirm('确定开始数据迁移吗？此过程不可中断。')) return;

            try {
                showResult('info', '🚀 开始数据迁移...');
                updateProgress(10);
                updateStep('step1', 'active');

                // 步骤1: 数据备份
                const localData = {
                    userList: JSON.parse(localStorage.getItem('userList') || '[]'),
                    agentList: JSON.parse(localStorage.getItem('agentList') || '[]'),
                    dataLibrary: JSON.parse(localStorage.getItem('dataLibrary') || '[]'),
                    orderList: JSON.parse(localStorage.getItem('orderList') || '[]'),
                    rechargeRecords: JSON.parse(localStorage.getItem('rechargeRecords') || '[]')
                };
                
                updateProgress(30);
                updateStep('step1', 'completed');
                updateStep('step2', 'active');

                // 步骤2: 调用迁移API
                const response = await fetch('/api/migrate/from-localstorage', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(localData)
                });

                updateProgress(70);
                updateStep('step2', 'completed');
                updateStep('step3', 'active');

                if (response.ok) {
                    const result = await response.json();
                    updateProgress(90);
                    updateStep('step3', 'completed');
                    updateStep('step4', 'active');

                    // 步骤4: 验证完成
                    setTimeout(() => {
                        updateProgress(100);
                        updateStep('step4', 'completed');
                        showResult('success', `✅ 数据迁移完成！<br><br>📊 迁移统计:<br>• 客户: ${localData.userList.length} 条<br>• 代理: ${localData.agentList.length} 条<br>• 数据: ${localData.dataLibrary.length} 条<br>• 订单: ${localData.orderList.length} 条<br>• 充值: ${localData.rechargeRecords.length} 条<br><br>🎉 现在可以享受数据库存储的优势了！`);
                    }, 1000);
                } else {
                    throw new Error('迁移API调用失败');
                }

            } catch (error) {
                showResult('danger', `❌ 迁移失败: ${error.message}<br><br>💡 解决方案:<br>1. 检查后端API是否正常<br>2. 确认数据库连接配置<br>3. 查看浏览器控制台错误信息<br>4. 联系技术支持`);
                resetProgress();
            }
        }

        // 回滚迁移
        async function rollbackMigration() {
            if (!confirm('确定要回滚到localStorage存储模式吗？')) return;

            try {
                // 调用回滚API
                const response = await fetch('/api/migrate/rollback', { method: 'POST' });
                
                if (response.ok) {
                    showResult('success', '✅ 已回滚到localStorage存储模式');
                } else {
                    throw new Error('回滚失败');
                }
            } catch (error) {
                showResult('danger', `❌ 回滚失败: ${error.message}`);
            }
        }

        // 更新进度条
        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
        }

        // 更新步骤状态
        function updateStep(stepId, status) {
            const step = document.getElementById(stepId);
            step.className = `step ${status}`;
        }

        // 显示结果
        function showResult(type, message) {
            document.getElementById('migrationResult').innerHTML = 
                `<div class="alert alert-${type}" style="margin-top: 15px;">${message}</div>`;
        }

        // 重置进度
        function resetProgress() {
            updateProgress(0);
            ['step1', 'step2', 'step3', 'step4'].forEach(id => {
                document.getElementById(id).className = 'step';
            });
        }

        // 页面加载时检查数据
        window.onload = function() {
            loadLocalData();
        };
    </script>
</body>
</html><!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>数据库迁移工具</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .card { background: white; border-radius: 12px; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .card-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; color: #333; border-left: 4px solid #667eea; padding-left: 12px; }
        .btn { padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; margin-right: 10px; }
        .btn:hover { background: #5568d3; }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .btn-warning { background: #ffc107; color: #212529; }
        .alert { padding: 15px 20px; border-radius: 8px; margin: 15px 0; }
        .alert-info { background: #d1ecf1; border-left: 4px solid #17a2b8; color: #0c5460; }
        .alert-success { background: #d4edda; border-left: 4px solid #28a745; color: #155724; }
        .alert-danger { background: #f8d7da; border-left: 4px solid #dc3545; color: #721c24; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-card h3 { font-size: 32px; margin-bottom: 5px; }
        .progress { background: #f1f1f1; border-radius: 20px; padding: 3px; margin: 10px 0; }
        .progress-bar { background: #28a745; height: 20px; border-radius: 20px; transition: width 0.3s; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; color: #e83e8c; }
        .migration-steps { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .step { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #e9ecef; }
        .step:last-child { border-bottom: none; }
        .step-number { background: #667eea; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; }
        .step-content { flex: 1; }
        .step.completed .step-number { background: #28a745; }
        .step.active .step-number { background: #ffc107; color: #212529; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🗄️ 数据库迁移工具</h1>
            <p>将localStorage数据永久存储到项目数据库</p>
        </div>

        <!-- 当前数据统计 -->
        <div class="card">
            <h2 class="card-title">📊 当前数据统计</h2>
            <div class="stats-grid">
                <div class="stat-card"><h3 id="userCount">0</h3><p>客户数量</p></div>
                <div class="stat-card"><h3 id="agentCount">0</h3><p>代理数量</p></div>
                <div class="stat-card"><h3 id="dataCount">0</h3><p>数据记录</p></div>
                <div class="stat-card"><h3 id="orderCount">0</h3><p>订单数量</p></div>
                <div class="stat-card"><h3 id="rechargeCount">0</h3><p>充值记录</p></div>
            </div>
            <button class="btn" onclick="loadLocalData()">🔍 检查本地数据</button>
            <div id="dataStatus"></div>
        </div>

        <!-- 迁移配置 -->
        <div class="card">
            <h2 class="card-title">⚙️ 迁移配置</h2>
            <div class="form-group">
                <label>数据库连接配置</label>
                <input type="text" id="dbHost" placeholder="数据库主机" value="localhost" />
            </div>
            <div class="form-group">
                <label>数据库名称</label>
                <input type="text" id="dbName" placeholder="数据库名" value="vue_admin" />
            </div>
            <div class="form-group">
                <label>迁移选项</label>
                <label><input type="checkbox" id="migrateUsers" checked> 客户列表 (userList)</label><br>
                <label><input type="checkbox" id="migrateAgents" checked> 代理列表 (agentList)</label><br>
                <label><input type="checkbox" id="migrateData" checked> 数据记录 (dataLibrary)</label><br>
                <label><input type="checkbox" id="migrateOrders" checked> 订单列表 (orderList)</label><br>
                <label><input type="checkbox" id="migrateRecharge" checked> 充值记录 (rechargeRecords)</label>
            </div>
        </div>

        <!-- 迁移步骤 -->
        <div class="card">
            <h2 class="card-title">📋 迁移步骤</h2>
            <div class="migration-steps">
                <div class="step" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-content"><strong>数据备份</strong><br>备份现有localStorage数据</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-content"><strong>数据库准备</strong><br>创建数据表结构</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-content"><strong>数据迁移</strong><br>将数据写入数据库</div>
                </div>
                <div class="step" id="step4">
                    <div class="step-number">4</div>
                    <div class="step-content"><strong>验证完成</strong><br>验证数据完整性</div>
                </div>
            </div>
            
            <div class="progress">
                <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
            </div>
            
            <button class="btn btn-success" onclick="startMigration()">🚀 开始迁移</button>
            <button class="btn btn-warning" onclick="testConnection()">🔗 测试连接</button>
            <button class="btn btn-danger" onclick="rollbackMigration()">↩️ 回滚迁移</button>
            
            <div id="migrationResult"></div>
        </div>

        <!-- 配置说明 -->
        <div class="card">
            <h2 class="card-title">📖 配置说明</h2>
            <div class="alert alert-info">
                <h4>🔧 后端API配置</h4>
                <p>迁移需要后端API支持，请确保以下接口已实现：</p>
                <ul>
                    <li><code>POST /api/migrate/from-localstorage</code> - 数据迁移接口</li>
                    <li><code>GET /api/migrate/test-connection</code> - 连接测试接口</li>
                    <li><code>POST /api/migrate/rollback</code> - 数据回滚接口</li>
                </ul>
            </div>
            
            <div class="alert alert-success">
                <h4>✅ 迁移后的好处</h4>
                <ul>
                    <li><strong>数据永久性</strong> - 不会因浏览器清理而丢失</li>
                    <li><strong>多设备同步</strong> - 在任何设备上都能访问相同数据</li>
                    <li><strong>备份恢复</strong> - 支持数据库级别的备份和恢复</li>
                    <li><strong>性能提升</strong> - 大量数据查询更高效</li>
                    <li><strong>数据安全</strong> - 数据库级别的安全保护</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let migrationProgress = 0;

        // 加载本地数据统计
        function loadLocalData() {
            const users = JSON.parse(localStorage.getItem('userList') || '[]');
            const agents = JSON.parse(localStorage.getItem('agentList') || '[]');
            const dataLibrary = JSON.parse(localStorage.getItem('dataLibrary') || '[]');
            const orders = JSON.parse(localStorage.getItem('orderList') || '[]');
            const rechargeRecords = JSON.parse(localStorage.getItem('rechargeRecords') || '[]');

            document.getElementById('userCount').textContent = users.length;
            document.getElementById('agentCount').textContent = agents.length;
            document.getElementById('dataCount').textContent = dataLibrary.length;
            document.getElementById('orderCount').textContent = orders.length;
            document.getElementById('rechargeCount').textContent = rechargeRecords.length;

            const totalRecords = users.length + agents.length + dataLibrary.length + orders.length + rechargeRecords.length;
            
            document.getElementById('dataStatus').innerHTML = totalRecords > 0 ? 
                `<div class="alert alert-success" style="margin-top: 15px;">✅ 检测到 ${totalRecords} 条数据记录，可以开始迁移</div>` :
                `<div class="alert alert-danger" style="margin-top: 15px;">❌ 未检测到数据，请先创建一些测试数据</div>`;
        }

        // 测试数据库连接
        async function testConnection() {
            try {
                // 这里应该调用后端API测试连接
                const response = await fetch('/api/migrate/test-connection', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    showResult('success', '✅ 数据库连接成功！可以开始迁移。');
                } else {
                    throw new Error('连接失败');
                }
            } catch (error) {
                showResult('danger', `❌ 数据库连接失败: ${error.message}<br><br>请检查：<br>1. 后端服务是否启动<br>2. 数据库配置是否正确<br>3. 网络连接是否正常`);
            }
        }

        // 开始迁移
        async function startMigration() {
            if (!confirm('确定开始数据迁移吗？此过程不可中断。')) return;

            try {
                showResult('info', '🚀 开始数据迁移...');
                updateProgress(10);
                updateStep('step1', 'active');

                // 步骤1: 数据备份
                const localData = {
                    userList: JSON.parse(localStorage.getItem('userList') || '[]'),
                    agentList: JSON.parse(localStorage.getItem('agentList') || '[]'),
                    dataLibrary: JSON.parse(localStorage.getItem('dataLibrary') || '[]'),
                    orderList: JSON.parse(localStorage.getItem('orderList') || '[]'),
                    rechargeRecords: JSON.parse(localStorage.getItem('rechargeRecords') || '[]')
                };
                
                updateProgress(30);
                updateStep('step1', 'completed');
                updateStep('step2', 'active');

                // 步骤2: 调用迁移API
                const response = await fetch('/api/migrate/from-localstorage', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(localData)
                });

                updateProgress(70);
                updateStep('step2', 'completed');
                updateStep('step3', 'active');

                if (response.ok) {
                    const result = await response.json();
                    updateProgress(90);
                    updateStep('step3', 'completed');
                    updateStep('step4', 'active');

                    // 步骤4: 验证完成
                    setTimeout(() => {
                        updateProgress(100);
                        updateStep('step4', 'completed');
                        showResult('success', `✅ 数据迁移完成！<br><br>📊 迁移统计:<br>• 客户: ${localData.userList.length} 条<br>• 代理: ${localData.agentList.length} 条<br>• 数据: ${localData.dataLibrary.length} 条<br>• 订单: ${localData.orderList.length} 条<br>• 充值: ${localData.rechargeRecords.length} 条<br><br>🎉 现在可以享受数据库存储的优势了！`);
                    }, 1000);
                } else {
                    throw new Error('迁移API调用失败');
                }

            } catch (error) {
                showResult('danger', `❌ 迁移失败: ${error.message}<br><br>💡 解决方案:<br>1. 检查后端API是否正常<br>2. 确认数据库连接配置<br>3. 查看浏览器控制台错误信息<br>4. 联系技术支持`);
                resetProgress();
            }
        }

        // 回滚迁移
        async function rollbackMigration() {
            if (!confirm('确定要回滚到localStorage存储模式吗？')) return;

            try {
                // 调用回滚API
                const response = await fetch('/api/migrate/rollback', { method: 'POST' });
                
                if (response.ok) {
                    showResult('success', '✅ 已回滚到localStorage存储模式');
                } else {
                    throw new Error('回滚失败');
                }
            } catch (error) {
                showResult('danger', `❌ 回滚失败: ${error.message}`);
            }
        }

        // 更新进度条
        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
        }

        // 更新步骤状态
        function updateStep(stepId, status) {
            const step = document.getElementById(stepId);
            step.className = `step ${status}`;
        }

        // 显示结果
        function showResult(type, message) {
            document.getElementById('migrationResult').innerHTML = 
                `<div class="alert alert-${type}" style="margin-top: 15px;">${message}</div>`;
        }

        // 重置进度
        function resetProgress() {
            updateProgress(0);
            ['step1', 'step2', 'step3', 'step4'].forEach(id => {
                document.getElementById(id).className = 'step';
            });
        }

        // 页面加载时检查数据
        window.onload = function() {
            loadLocalData();
        };
    </script>
</body>
</html>